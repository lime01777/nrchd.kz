import{j as e,r as d,b as $}from"./app-DTe9R8TK.js";function D({title:n,isOpen:g,toggleOpen:h}){return e.jsxs("div",{className:"flex flex-row w-full items-center justify-between p-4 cursor-pointer rounded-lg transition-colors duration-200",onClick:h,children:[e.jsx("div",{className:"flex flex-grow",children:e.jsx("h1",{className:"sm:text-xl text-lg font-semibold title-font text-gray-900","data-translate":!0,children:n})}),e.jsx("div",{className:"flex",children:e.jsx("div",{className:"text-black inline-flex items-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",className:`transform transition-transform duration-300 ${g?"rotate-180":""}`,children:e.jsx("path",{d:"M12 19c-.39 0-.77-.15-1.06-.44l-7-7a1.5 1.5 0 0 1 2.12-2.12L12 15.88l5.94-5.94a1.5 1.5 0 0 1 2.12 2.12l-7 7c-.29.29-.67.44-1.06.44z"})})})})]})}function M({description:n,filetype:g,img:h,filesize:u="24 KB",date:L="27.03.2024",url:s="#",file:o,onVideoClick:b}){const[p,N]=d.useState({size:u,date:L}),[j,y]=d.useState(!1),[C,m]=d.useState(!1),[w,k]=d.useState(null),[r,l]=d.useState(null);d.useEffect(()=>{o&&(N({size:o.size||u,date:o.date||L}),n=o.description||n,g=o.filetype||g,h=o.img||h,s=o.url||s)},[o]),d.useEffect(()=>{s&&s!=="#"&&$.head(s).then(t=>{const i=t.headers["content-length"],x=t.headers["last-modified"];i&&N(c=>({...c,size:a(i)})),x&&N(c=>({...c,date:f(new Date(x))}))}).catch(t=>{console.error("Ошибка при получении информации о файле:",t)})},[s]);const a=t=>{if(!t)return u;const i=["B","KB","MB","GB"];let x=parseInt(t,10),c=0;for(;x>=1024&&c<i.length-1;)x/=1024,c++;return`${x.toFixed(1)} ${i[c]}`},f=t=>{if(!t)return p.date;const i=t.getDate().toString().padStart(2,"0"),x=(t.getMonth()+1).toString().padStart(2,"0"),c=t.getFullYear();return`${i}.${x}.${c}`},v=()=>{if(!s||s==="#")return null;const t=s.split(".").pop().toLowerCase();return["pdf"].includes(t)?"pdf":["jpg","jpeg","png","gif","webp"].includes(t)?"image":["doc","docx"].includes(t)?"word":["xls","xlsx"].includes(t)?"excel":["ppt","pptx"].includes(t)?"powerpoint":["txt"].includes(t)?"text":["mp4","avi","mov","webm"].includes(t)?"video":null},S=()=>!s||s==="#"?"":s.startsWith("http://")||s.startsWith("https://")?s:`${window.location.origin}${s.startsWith("/")?"":"/"}${s}`,U=()=>{if(!s||s==="#")return"1";const t=s.split(".").pop().toLowerCase();return["pdf"].includes(t)?"2":["xls","xlsx"].includes(t)?"3":["txt"].includes(t)?"4":["ppt","pptx"].includes(t)?"5":["doc","docx"].includes(t)?"1":["mp4","avi","mov","webm"].includes(t)?"6":["jpg","jpeg","png","gif","webp"].includes(t)?"7":"1"},z=()=>{if(!s||s==="#")return"";const t=s.split(".").pop().toLowerCase();switch(t){case"pdf":return"PDF";case"doc":case"docx":return"DOCX";case"xls":case"xlsx":return"XLSX";case"ppt":case"pptx":return"PPTX";case"txt":return"TXT";case"mp4":case"avi":case"mov":return"MP4";case"jpg":case"jpeg":case"png":return"JPG";default:return t.toUpperCase()}},B=t=>{try{m(!0),l(null);const i=S(),c=`https://docs.google.com/viewer?url=${encodeURIComponent(i)}&embedded=true`;return k(c),m(!1),c}catch(i){return console.error("Ошибка при конвертации документа:",i),l("Не удалось подготовить документ для просмотра"),m(!1),null}},P=t=>{t.preventDefault(),y(!0),document.body.style.overflow="hidden";const i=v();if(i==="video"&&typeof b=="function"){b(s,n),F();return}["word","excel","powerpoint"].includes(i)?B():k(null)},F=()=>{y(!1),document.body.style.overflow="auto",k(null),m(!1),l(null)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex flex-col h-[200px] bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsx("h2",{className:"font-medium leading-normal text-gray-800 line-clamp-6 mb-3","data-translate":!0,children:n})}),e.jsxs("div",{className:"flex mt-auto justify-between items-center",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:P,className:"cursor-pointer text-black inline-flex items-center border-gray-300 border rounded-lg px-3 py-2 text-sm hover:bg-gray-50 transition-colors duration-200",children:e.jsx("span",{"data-translate":!0,children:"Открыть"})}),e.jsx("a",{href:s,download:!0,className:"cursor-pointer text-black inline-flex items-center border-gray-300 border rounded-lg px-3 py-2 text-sm hover:bg-gray-50 transition-colors duration-200",children:e.jsx("span",{"data-translate":!0,children:"Скачать"})})]}),e.jsxs("div",{className:"flex flex-col text-sm",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx("img",{src:`/img/FileType/${U()}.png`,alt:"",className:"w-4 h-4"}),e.jsxs("p",{className:"ml-1 uppercase text-xs text-gray-600",children:[z(),", ",p.size]})]}),e.jsx("p",{className:"text-gray-400 text-xs text-right",children:p.date})]})]})]})}),j&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:F,children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] flex flex-col",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 truncate","data-translate":!0,children:n}),e.jsx("button",{onClick:F,className:"text-gray-500 hover:text-gray-700 focus:outline-none",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-grow p-4 overflow-auto",children:C?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-gray-900 mb-4"}),e.jsx("p",{className:"text-gray-600","data-translate":!0,children:"Подготовка документа к просмотру..."})]}):r?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("p",{className:"text-gray-600 mb-4","data-translate":!0,children:r}),e.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Скачать файл"})]}):v()==="image"?e.jsx("div",{className:"flex items-center justify-center h-[70vh]",children:e.jsx("img",{src:s,alt:n,className:"max-w-full max-h-[70vh] object-contain"})}):v()==="pdf"?e.jsx("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:e.jsx("div",{className:"w-full h-full",children:e.jsx("object",{data:s,type:"application/pdf",className:"w-full h-full min-h-[70vh]",children:e.jsxs("p",{children:["Ваш браузер не поддерживает встроенный просмотр PDF.",e.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",children:"Скачайте PDF"}),"."]})})})}):v()==="video"?e.jsx("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:e.jsx("div",{className:"w-full h-full",children:e.jsx("video",{src:s,className:"max-w-full max-h-[70vh]",controls:!0,autoPlay:!0})})}):["word","excel","powerpoint"].includes(v())&&w?e.jsx("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:e.jsx("div",{className:"w-full h-full",children:e.jsx("iframe",{src:w,className:"w-full h-full min-h-[70vh]",title:n,frameBorder:"0"})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:e.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Предпросмотр для этого типа файла недоступен"}),e.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Скачать файл"})]})}),e.jsxs("div",{className:"p-4 border-t flex justify-end",children:[e.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2 rounded-lg mr-2 transition-colors duration-200",children:"Открыть в новой вкладке"}),e.jsx("button",{onClick:F,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Закрыть"})]})]})})]})}function T({sections:n,bgColor:g="bg-green-100",folder:h="",title:u="",name:L="",onVideoClick:s,defaultOpen:o=!1}){const[b,p]=d.useState([]),[N,j]=d.useState(!1),[y,C]=d.useState(null),[m,w]=d.useState({});d.useEffect(()=>{if(n&&n.length>0){p(n);const r={};n.forEach((l,a)=>{r[a]=a===0?o:!1}),w(r),j(!1)}else{j(!0);const r=window.location.origin,l=new URLSearchParams;if(h){const a=h.replace(/\\/g,"/");l.append("folder",a)}u&&l.append("title",u),$.get(`${r}/api/files?${l.toString()}`).then(a=>{p(a.data);const f={};a.data.forEach((v,S)=>{f[S]=S===0?o:!1}),w(f),j(!1)}).catch(a=>{console.error("Ошибка при загрузке файлов:",a),C("Не удалось загрузить файлы. Пожалуйста, попробуйте позже."),j(!1)})}},[n,h,u,o]);const k=r=>{w(l=>({...l,[r]:!l[r]}))};return N?e.jsx("div",{className:"text-center py-4","data-translate":!0,children:"Загрузка файлов..."}):y?e.jsx("div",{className:"text-center py-4 text-red-500","data-translate":!0,children:y}):b.length===0?null:e.jsx("div",{className:"flex flex-wrap -mx-4",children:e.jsx("div",{className:"w-full px-4",children:e.jsx("div",{className:`rounded-lg overflow-hidden ${g}`,children:b.map((r,l)=>e.jsxs("div",{children:[e.jsx(D,{title:r.title,isOpen:m[l],toggleOpen:()=>k(l)}),m[l]&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.documents&&r.documents.map((a,f)=>e.jsx("div",{className:"bg-white rounded-lg shadow p-3",children:e.jsx(M,{...a,onVideoClick:s})},f)),r.files&&r.files.map((a,f)=>e.jsx("div",{className:"bg-white rounded-lg shadow p-3",children:e.jsx(M,{file:a,onVideoClick:s})},f))]})})]},l))})})})}export{T as F};

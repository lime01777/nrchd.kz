import{r as i,j as e,b as I}from"./app-DdbYp4sL.js";function Q({folder:y,title:h,bgColor:U="bg-white",onVideoClick:M,limit:b,singleColumn:E=!1,hideDownload:T=!1,searchTerm:f=""}){const[N,_]=i.useState([]),[W,k]=i.useState(!0),[C,A]=i.useState(null),[V,B]=i.useState(!1),[l,P]=i.useState(null),[X,g]=i.useState(!1),[z,F]=i.useState(null),[D,S]=i.useState(null),[G,R]=i.useState({}),j=r=>{if(!r||r==="NaN.NaN.NaN")return"";try{const t=new Date(r);if(isNaN(t.getTime()))return r;const a=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),o=t.getFullYear();return`${a}.${n}.${o}`}catch{return r}},L=r=>{if(!r||r===0)return"0 Bytes";if(typeof r=="string"){if(r.includes("KB")||r.includes("MB")||r.includes("GB"))return r;if(r=parseInt(r,10),isNaN(r))return"0 Bytes"}const t=1024,a=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(r)/Math.log(t));return parseFloat((r/Math.pow(t,n)).toFixed(1))+" "+a[n]};i.useEffect(()=>{(async()=>{try{k(!0);const t=window.location.origin,a=new URLSearchParams;if(y){const s=y.replace(/\\/g,"/");a.append("folder",s)}h&&a.append("title",h),console.log("Fetching files from:",`${t}/api/files?${a.toString()}`);const n=await I.get(`${t}/api/files?${a.toString()}`);console.log("API response:",n.data);let o=[];n.data&&Array.isArray(n.data)?n.data.forEach(s=>{s.files&&(o=[...o,...s.files]),s.documents&&(o=[...o,...s.documents])}):n.data&&n.data.files&&(o=n.data.files),console.log("Processed files data:",o);const m=o.map(s=>{if(!s.name&&s.url){const c=s.url.split("/"),x=c[c.length-1];return{...s,name:x}}return s}),u=b?m.slice(0,b):m;_(u);const v=u.map(s=>s.url&&s.url!=="#"?I.head(s.url).then(c=>{const x=c.headers["content-length"],p=c.headers["last-modified"];return{id:s.id||s.url,size:x?L(x):"0 Bytes",date:j(p?new Date(p):s.date||s.created_at||"")}}).catch(c=>(console.error("Error fetching file info:",c),{id:s.id||s.url,size:L(s.size||0),date:j(s.date||s.created_at||"")})):Promise.resolve({id:s.id||s.url,size:L(s.size||0),date:j(s.date||s.created_at||"")}));Promise.all(v).then(s=>{const c={};s.forEach((x,p)=>{c[u[p].id||u[p].url]=x}),R(c),k(!1)})}catch(t){console.error("Error fetching files:",t),A("Ошибка при загрузке файлов"),k(!1)}})()},[y,h,b]);const O=r=>{if(console.log("Getting icon for file:",r),!r||typeof r!="string")return"1";const t=r.split(".").pop().toLowerCase();switch(console.log("File extension:",t),t){case"pdf":return"2";case"xls":case"xlsx":return"3";case"txt":return"4";case"ppt":case"pptx":return"5";case"doc":case"docx":return"1";case"mp4":case"avi":case"mov":return"6";case"jpg":case"jpeg":case"png":case"gif":return"7";default:return"1"}},H=r=>{if(!r||typeof r!="string")return"";const t=r.split(".").pop().toLowerCase();switch(t){case"pdf":return"PDF";case"doc":case"docx":return"DOCX";case"xls":case"xlsx":return"XLSX";case"ppt":case"pptx":return"PPTX";case"txt":return"TXT";case"mp4":case"avi":case"mov":return"MP4";case"jpg":case"jpeg":case"png":return"JPG";default:return t.toUpperCase()}},d=r=>{if(!r||typeof r!="string")return null;const t=r.split(".").pop().toLowerCase();return["pdf"].includes(t)?"pdf":["jpg","jpeg","png","gif","webp"].includes(t)?"image":["doc","docx"].includes(t)?"word":["xls","xlsx"].includes(t)?"excel":["ppt","pptx"].includes(t)?"powerpoint":["txt"].includes(t)?"text":["mp4","avi","mov"].includes(t)?"video":null},K=r=>!r||r==="#"?"":r.startsWith("http://")||r.startsWith("https://")?r:`${window.location.origin}${r.startsWith("/")?"":"/"}${r}`,J=r=>{try{g(!0),S(null);const t=r.url||"",a=K(t),o=`https://docs.google.com/viewer?url=${encodeURIComponent(a)}&embedded=true`;return F(o),g(!1),o}catch(t){return console.error("Ошибка при конвертации документа:",t),S("Не удалось подготовить документ для просмотра"),g(!1),null}},Y=(r,t)=>{t&&t.preventDefault(),console.log("Opening file:",r),P(r),B(!0),document.body.style.overflow="hidden";const a=r.name||"";console.log("File name for determining type:",a);const n=d(a);console.log("Detected file type:",n),["word","excel","powerpoint"].includes(n)?J(r):n==="video"&&typeof M=="function"?(M(r.url,r.description||r.name||"Видео"),w()):F(null)},w=()=>{B(!1),document.body.style.overflow="auto",P(null),F(null),g(!1),S(null)},$=i.useMemo(()=>{if(!f||f.trim()==="")return N;const r=f.toLowerCase().trim();return N.filter(t=>{const a=(t.name||"").toLowerCase(),n=(t.description||"").toLowerCase();return a.includes(r)||n.includes(r)})},[N,f]);return W?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-500"}),e.jsx("p",{className:"mt-2","data-translate":!0,children:"Загрузка файлов..."})]}):C?e.jsx("div",{className:"py-8 text-center text-red-500",children:C}):e.jsxs("div",{className:`py-6 ${U}`,children:[h&&e.jsx("h2",{className:"text-2xl font-semibold mb-6 text-gray-800",children:h}),$.length===0?e.jsx("div",{className:"py-8 text-center text-gray-500 bg-white rounded-lg shadow border border-gray-200","data-translate":!0,children:"Нет доступных документов"}):e.jsx("div",{className:`grid ${E?"grid-cols-1":"grid-cols-1 md:grid-cols-2 lg:grid-cols-3"} gap-4`,children:$.map((r,t)=>{const a=r.name||"",n=r.description||r.name||"Файл",o=r.id||r.url,m=G[o]||{size:"0 Bytes",date:""},u=H(a),v=O(a);return console.log("Rendering file:",a,"Icon type:",v),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex flex-col h-[200px] bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 border border-gray-200",children:[e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsx("h2",{className:"font-medium leading-normal text-gray-800 line-clamp-6 mb-3",children:n})}),e.jsxs("div",{className:"flex mt-auto justify-between items-center",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:s=>Y(r,s),className:"cursor-pointer text-black inline-flex items-center border-gray-300 border rounded-lg px-3 py-2 text-sm hover:bg-gray-50 transition-colors duration-200",children:e.jsx("span",{"data-translate":!0,children:"Открыть"})}),!T&&e.jsx("a",{href:r.url,download:!0,className:"cursor-pointer text-black inline-flex items-center border-gray-300 border rounded-lg px-3 py-2 text-sm hover:bg-gray-50 transition-colors duration-200",children:e.jsx("span",{"data-translate":!0,children:"Скачать"})})]}),e.jsxs("div",{className:"flex flex-col text-sm",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx("img",{src:`/img/FileType/${v}.png`,alt:"",className:"w-4 h-4"}),e.jsxs("p",{className:"ml-1 uppercase text-xs text-gray-600",children:[u,", ",m.size]})]}),e.jsx("p",{className:"text-gray-400 text-xs text-right",children:m.date})]})]})]})},t)})}),V&&l&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:w,children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] flex flex-col",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 truncate",children:l.description||l.name||"Файл"}),e.jsx("button",{onClick:w,className:"text-gray-500 hover:text-gray-700 focus:outline-none",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-grow p-4 overflow-auto",children:X?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-gray-900 mb-4"}),e.jsx("p",{className:"text-gray-600","data-translate":!0,children:"Подготовка документа к просмотру..."})]}):D?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("p",{className:"text-gray-600 mb-4",children:D}),e.jsx("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Скачать файл"})]}):d(l.name)==="image"?e.jsx("div",{className:"flex items-center justify-center h-[70vh]",children:e.jsx("img",{src:l.url,alt:l.description||l.name,className:"max-w-full max-h-[70vh] object-contain"})}):d(l.name)==="pdf"?e.jsx("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:e.jsx("div",{className:"w-full h-full",children:e.jsx("object",{data:l.url,type:"application/pdf",className:"w-full h-full min-h-[70vh]",children:e.jsxs("p",{children:["Ваш браузер не поддерживает встроенный просмотр PDF.",e.jsx("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",children:"Скачайте PDF"}),"."]})})})}):d(l.name)==="video"?e.jsx("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:e.jsx("div",{className:"w-full h-full",children:e.jsx("video",{src:l.url,className:"max-w-full max-h-[70vh]",controls:!0,autoPlay:!0})})}):["word","excel","powerpoint"].includes(d(l.name))&&z?e.jsx("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:e.jsx("div",{className:"w-full h-full",children:e.jsx("iframe",{src:z,className:"w-full h-full min-h-[70vh]",title:l.description||l.name,frameBorder:"0"})})}):["word","excel","powerpoint"].includes(d(l.name))?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[e.jsx("div",{className:"text-blue-500 mb-4",children:e.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Предпросмотр для этого типа файла недоступен"}),e.jsx("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Скачать файл"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:e.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Предпросмотр для этого типа файла недоступен"}),e.jsx("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Скачать файл"})]})}),e.jsxs("div",{className:"p-4 border-t flex justify-end",children:[e.jsx("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",className:"bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2 rounded-lg mr-2 transition-colors duration-200",children:"Открыть в новой вкладке"}),e.jsx("button",{onClick:w,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Закрыть"})]})]})})]})}export{Q as S};

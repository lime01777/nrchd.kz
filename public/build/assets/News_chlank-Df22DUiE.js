import{r as o,R as S,j as t,a as W}from"./app-BQ3qogJL.js";import{S as L}from"./SafeImage-DOdWYvV0.js";import{i as z}from"./mediaUtils-oRnee45q.js";import{t as E}from"./TranslationService-6o6muFbl.js";function C({images:u=[],className:m="",height:f="160px",showDots:b=!0,showCounter:x=!1,autoPlay:w=!0,interval:v=3e3}){const[n,j]=o.useState(0),[i,g]=o.useState(new Set),[c,h]=o.useState(new Set),[p,d]=o.useState(!0),l="news-slider:go-to",y=o.useCallback(r=>{if(!r||typeof r!="string")return r;const e=r.trim();return e.startsWith("http")||e.startsWith("/storage/")||e.startsWith("/img/news/")?e:e.startsWith("/")&&!e.startsWith("/storage/")&&!e.startsWith("/img/")?`/img/news${e}`:e.startsWith("/")?e:`/img/news/${e}`},[]),s=S.useMemo(()=>!Array.isArray(u)||u.length===0?[]:u.filter(e=>e?typeof e=="string"?e.trim()!==""&&(e.startsWith("http")||e.startsWith("blob:")||e.startsWith("/")):e instanceof File?e.size>0&&e.type.startsWith("image/"):!1:!1).map(e=>y(e)).filter(e=>e&&e.trim()!==""),[u,y]),N=o.useCallback(r=>{g(e=>{const a=new Set(e);return a.add(r),a.size>=s.length&&d(!1),a})},[s.length]),k=o.useCallback(r=>{console.warn("Ошибка загрузки изображения:",s[r]),h(e=>{const a=new Set(e);return a.add(r),a}),g(e=>{const a=new Set(e);return a.add(r),a.size>=s.length&&d(!1),a})},[s.length]);if(o.useEffect(()=>{g(new Set),h(new Set),d(!0),j(0)},[s]),o.useEffect(()=>{if(!w||s.length<=1||!i.has(0)&&!c.has(0))return;const r=setInterval(()=>{j(e=>{const a=(e+1)%s.length;return!i.has(a)&&!c.has(a)&&d(!0),a})},v);return()=>clearInterval(r)},[s.length,w,v,i,c]),o.useEffect(()=>{const r=e=>{const a=Number(e.detail);!Number.isNaN(a)&&a>=0&&a<s.length&&j(a)};return window.addEventListener(l,r),()=>{window.removeEventListener(l,r)}},[s.length]),!Array.isArray(s)||s.length===0)return t.jsx("div",{className:`relative overflow-hidden rounded-lg bg-gray-200 flex items-center justify-center ${m}`,style:{height:f},children:t.jsxs("div",{className:"text-gray-400 text-center",children:[t.jsx("svg",{className:"w-12 h-12 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),t.jsx("p",{className:"text-sm",children:"Нет изображений"})]})});if(s.length===1)return t.jsxs("div",{className:`relative overflow-hidden rounded-lg ${m}`,style:{height:f},children:[p&&t.jsx("div",{className:"absolute inset-0 bg-gray-200 flex items-center justify-center z-10",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),t.jsx(L,{src:s[0],alt:"Изображение новости",className:`w-full h-full object-cover transition-opacity duration-300 ${i.has(0)?"opacity-100":"opacity-0"}`,fallbackSrc:"",onLoad:()=>N(0),onError:()=>k(0)}),x&&!p&&t.jsx("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded",children:"1 / 1"}),b&&!p&&t.jsx("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1",children:t.jsx("div",{className:"w-2 h-2 bg-white rounded-full opacity-100"})})]});const I=r=>{j(r)};return t.jsxs("div",{className:`relative overflow-hidden rounded-lg ${m}`,style:{height:f},children:[t.jsxs("div",{className:"relative w-full h-full bg-gray-200",children:[n>0&&i.has(n-1)&&!c.has(n-1)&&!i.has(n)&&t.jsx(L,{src:s[n-1],alt:"Предыдущее изображение",className:"absolute inset-0 w-full h-full object-cover opacity-30",fallbackSrc:"",style:{minHeight:"100%",minWidth:"100%",objectFit:"cover"}}),c.has(n)?t.jsx("div",{className:"absolute inset-0 bg-gray-200 flex items-center justify-center z-20",children:t.jsxs("div",{className:"text-center text-gray-400",children:[t.jsx("svg",{className:"w-12 h-12 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),t.jsx("p",{className:"text-xs",children:"Изображение недоступно"})]})}):t.jsx(L,{src:s[n],alt:`Изображение ${n+1}`,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ${i.has(n)?"opacity-100 z-10":"opacity-0 z-0"}`,fallbackSrc:"",onLoad:()=>N(n),onError:()=>k(n),style:{minHeight:"100%",minWidth:"100%",objectFit:"cover"}}),s.map((r,e)=>e!==n&&t.jsx("img",{src:r,alt:"",className:"hidden",onLoad:()=>N(e),onError:()=>k(e)},e)),!i.has(n)&&!c.has(n)&&t.jsx("div",{className:"absolute inset-0 bg-gray-200 flex items-center justify-center z-10",children:t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})})]}),x&&s.length>1&&t.jsxs("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded z-10",children:[n+1," / ",s.length]}),b&&s.length>1&&t.jsx("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1 z-10",children:s.map((r,e)=>t.jsx("button",{onClick:()=>I(e),className:`w-2 h-2 rounded-full transition-all duration-200 ${e===n?"bg-white opacity-100":"bg-white opacity-50 hover:opacity-75"}`,"aria-label":`Перейти к изображению ${e+1}`},e))})]})}function V({date:u,description:m,slug:f,image:b,images:x=[],external_url:w,type:v}){const n=(l,y="")=>E.t(l,y),g=(x&&x.length>0?x:b?[b]:[]).map(l=>l?typeof l=="string"?l:typeof l=="object"&&(l.url||l.path)||null:null).filter(Boolean).filter(l=>!z(l)),c=v==="media"&&w,h=c?w:f?route("news.show",f):null,p=()=>{const l=t.jsxs("span",{className:"mt-auto text-black inline-flex items-center border-gray-300 border rounded-lg px-4 py-2 text-sm hover:bg-gray-50 transition-colors duration-200 pointer-events-none",children:[n("common.readNews","Читать новость"),t.jsx("svg",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"w-4 h-4 ml-2",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})]});return l},d=t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"h-40 overflow-hidden rounded-t-lg bg-gray-100",children:g.length>0?t.jsx(C,{images:g,className:"h-40",height:"160px",showDots:!0,showCounter:!1,autoPlay:!0,interval:3e3}):t.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-200",children:t.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),t.jsx("div",{className:"flex flex-col p-6 h-full",children:t.jsxs("div",{className:"flex-grow",children:[t.jsx("p",{className:"text-gray-500 text-sm mb-2",children:u}),t.jsx("h2",{className:"text-gray-900 text-lg font-medium mb-4 line-clamp-3 h-[4.5rem]",title:m,children:m}),t.jsx(p,{})]})})]});return h?c?t.jsx("a",{href:h,target:"_blank",rel:"noopener noreferrer",className:"bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 h-full block cursor-pointer",children:d}):t.jsx(W,{href:h,className:"bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 h-full block",children:d}):t.jsx("div",{className:"bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 h-full",children:d})}export{V as N};

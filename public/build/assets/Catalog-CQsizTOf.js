import{r as a,a as R,j as l,Y as _}from"./app-CZOK16ls.js";import{L as z}from"./LayoutFolderChlank-CJ7b4w7o.js";import{S as H}from"./SimpleFileDisplay-Cdl_DKxL.js";import{t as s}from"./TranslationService-BITGx9l6.js";import{D as I,a as U}from"./clinicalFilters-BmX3Pc2t.js";import"./Footer-aENe6JCY.js";function V(){const o=(e,u="")=>s.t(e,u);console.log("Catalog component rendering...");const[r,g]=a.useState(""),[i,m]=a.useState(""),[n,b]=a.useState(""),[t,h]=a.useState("protocols"),[P,d]=a.useState(!1),[p,c]=a.useState(null);a.useState([]);const[j,x]=a.useState([]),[w,v]=a.useState([]),[S,y]=a.useState(0);a.useEffect(()=>(console.log("Catalog component mounted"),k(),()=>{console.log("Catalog component unmounted")}),[]);const k=()=>{d(!0),R.get("/api/clinical-protocols/filters").then(({data:e})=>{x(e.medicine_categories||[]),v(e.mkb_categories||[])}).catch(()=>{x(I),v(U)}).finally(()=>d(!1))},N=[{value:"",label:o("directionsPages.clinicalProtocolsSubpages.catalog.allSections")},...j.map(e=>({value:e,label:e}))],C=[{value:"",label:o("directionsPages.clinicalProtocolsSubpages.catalog.allMkbCategories")},...w.map(e=>({value:e.code||e,label:e.label||e}))],L=[{value:"protocols",label:o("directionsPages.clinicalProtocolsSubpages.catalog.types.protocols")},{value:"guidelines",label:o("directionsPages.clinicalProtocolsSubpages.catalog.types.guidelines")},{value:"archive",label:o("directionsPages.clinicalProtocolsSubpages.catalog.types.archive")}],F=e=>{g(e.target.value)},M=e=>{m(e.target.value)},T=e=>{b(e.target.value)},B=e=>{h(e.target.value)},E=()=>{g(""),m(""),b(""),h("protocols"),c(null)},A=async()=>{try{d(!0),c(null);const e=new URLSearchParams,u=f();u&&e.append("folder",u),r&&e.append("search",r),i&&e.append("medicine",i),n&&e.append("mkb",n),t&&e.append("type",t);const O=`/api/clinical-protocols/download-archive?${e.toString()}`;window.location.href=O}catch(e){console.error("Ошибка при скачивании архива:",e),c("Не удалось скачать архив. Попробуйте позже.")}finally{d(!1)}},D=()=>r.trim(),f=()=>{let e="";switch(t){case"protocols":e="Клинические протоколы/Поток клинические протоколы";break;case"guidelines":e="Клинические протоколы/Клинические руководства МЗ РК";break;case"archive":e="Клинические протоколы/Архив клинических протоколов МЗ РК";break}return console.log("getFolderPath called:",{selectedType:t,path:e}),e};return l.jsxs(l.Fragment,{children:[l.jsx(_,{title:o("directionsPages.clinicalProtocolsSubpages.catalog.title","Каталог")}),l.jsx("section",{className:"text-gray-600 body-font",children:l.jsx("div",{className:"container px-5 mx-auto",children:l.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[l.jsxs("div",{className:"mb-6",children:[l.jsx("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:l.jsxs("div",{className:"flex-grow",children:[l.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-1",children:o("directionsPages.clinicalProtocolsSubpages.catalog.searchLabel")}),l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:l.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:l.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})}),l.jsx("input",{type:"text",id:"search",name:"search",value:r,onChange:F,className:"pl-10 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:o("directionsPages.clinicalProtocolsSubpages.catalog.searchPlaceholder")})]})]})}),l.jsx("div",{className:"flex flex-col space-y-4",children:l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700 mb-1",children:o("directionsPages.clinicalProtocolsSubpages.catalog.typeLabel")}),l.jsx("select",{id:"type",name:"type",value:t,onChange:B,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:L.map(e=>l.jsx("option",{value:e.value,children:e.label},e.value))})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"medicine",className:"block text-sm font-medium text-gray-700 mb-1",children:o("directionsPages.clinicalProtocolsSubpages.catalog.medicineSectionLabel")}),l.jsx("select",{id:"medicine",name:"medicine",value:i,onChange:M,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:N.map(e=>l.jsx("option",{value:e.value,children:e.label},e.value))})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"mkb",className:"block text-sm font-medium text-gray-700 mb-1",children:o("directionsPages.clinicalProtocolsSubpages.catalog.mkbCategoryLabel")}),l.jsx("select",{id:"mkb",name:"mkb",value:n,onChange:T,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:C.map(e=>l.jsx("option",{value:e.value,children:e.label},e.value))})]})]})}),l.jsxs("div",{className:"mt-4 flex justify-center gap-4",children:[l.jsxs("button",{onClick:E,className:"px-6 py-2.5 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors duration-200 flex items-center shadow-md",children:[l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),o("directionsPages.clinicalProtocolsSubpages.catalog.resetFiltersButton")]}),l.jsxs("button",{onClick:A,disabled:P||S===0,className:"px-6 py-2.5 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors duration-200 flex items-center shadow-md disabled:opacity-50 disabled:cursor-not-allowed",children:[l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),o("directionsPages.clinicalProtocolsSubpages.catalog.downloadAllButton","Скачать все протоколы")]})]})]}),p&&l.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:[l.jsx("strong",{className:"font-bold",children:o("directionsPages.clinicalProtocolsSubpages.catalog.errorTitle")}),l.jsxs("span",{className:"block sm:inline",children:[" ",p]}),l.jsx("button",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",onClick:()=>c(null),children:l.jsxs("svg",{className:"fill-current h-6 w-6 text-red-500",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:[l.jsx("title",{children:o("directionsPages.clinicalProtocolsSubpages.catalog.closeButton")}),l.jsx("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]}),l.jsx(H,{folder:f(),bgColor:"bg-white",useClinicalProtocols:!0,searchTerm:D(),medicine:i,mkb:n,onFilesLoaded:e=>y(e),onError:e=>c(e)})]})})})]})}V.layout=o=>l.jsx(z,{bgColor:"bg-white",h1:s.t("directionsPages.clinicalProtocolsSubpages.catalog.h1"),parentRoute:"/clinical-protocols",parentName:s.t("directionsPages.clinicalProtocolsSubpages.catalog.parentName"),heroBgColor:"bg-blue-100",buttonBgColor:"bg-blue-100",buttonHoverBgColor:"hover:bg-blue-200",breadcrumbs:[{name:s.t("directionsPages.clinicalProtocolsSubpages.catalog.breadcrumbDirections"),route:"directions"},{name:s.t("directionsPages.clinicalProtocolsSubpages.catalog.breadcrumbClinicalProtocols"),route:"clinical.protocols"},{name:s.t("directionsPages.clinicalProtocolsSubpages.catalog.h1"),route:null}],children:o});export{V as default};

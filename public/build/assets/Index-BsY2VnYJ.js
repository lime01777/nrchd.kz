import{r as n,j as e,b as o}from"./app-GecTM2_-.js";import{A as P}from"./AdminLayout-Bl8bfea0.js";import"./transition-DX40ixyY.js";import"./use-is-mounted-Du34VN7H.js";function E(){const[c,g]=n.useState(""),[h,y]=n.useState([]),[d,b]=n.useState(null),[N,x]=n.useState(!1),[p,m]=n.useState(null),[a,u]=n.useState(null),i=(s="")=>{x(!0),m(null),o.get("/admin/storage/list",{params:{path:s}}).then(t=>{y(t.data.items),g(t.data.current),b(t.data.parent)}).catch(t=>{var l,r;return m(((r=(l=t.response)==null?void 0:l.data)==null?void 0:r.error)||t.message)}).finally(()=>x(!1))};n.useEffect(()=>{i("")},[]);const v=s=>{i(s)},w=()=>{d!==null&&d!=="."&&i(d===""?"":d)},S=s=>{window.confirm(`Удалить ${s.type==="folder"?"папку":"файл"}: ${s.name}?`)&&o.delete("/admin/storage/delete",{params:{path:s.path}}).then(()=>i(c)).catch(t=>{var l,r;return alert("Ошибка удаления: "+(((r=(l=t.response)==null?void 0:l.data)==null?void 0:r.error)||t.message))})},k=s=>{const t=s.target.files[0];if(!t)return;const l=new FormData;l.append("file",t),l.append("path",c),o.post("/admin/storage/upload",l).then(()=>i(c)).catch(r=>{var f,j;return alert("Ошибка загрузки: "+(((j=(f=r.response)==null?void 0:f.data)==null?void 0:j.error)||r.message))})},C=s=>{s.type==="file"&&u({type:s.name.match(/\.(jpg|jpeg|png|gif|webp)$/i)?"image":s.name.match(/\.pdf$/i)?"pdf":"other",url:s.url,name:s.name})},D=()=>u(null);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6 flex items-center justify-between",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Файловый менеджер: public/storage"})}),e.jsxs("div",{className:"mb-4 flex items-center space-x-2",children:[e.jsx("button",{className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300",onClick:w,disabled:!d||d===".",children:"⬆️ Вверх"}),e.jsxs("span",{className:"text-gray-500",children:["/",c]}),e.jsxs("label",{className:"ml-auto px-3 py-1 bg-blue-600 text-white rounded cursor-pointer hover:bg-blue-700",children:["+ Загрузить файл",e.jsx("input",{type:"file",className:"hidden",onChange:k})]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded shadow-lg p-6 max-w-2xl w-full relative",children:[e.jsx("button",{onClick:D,className:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-2xl",children:"×"}),e.jsxs("div",{className:"mb-2 font-semibold",children:["Предпросмотр: ",a.name]}),a.type==="image"&&e.jsx("img",{src:a.url,alt:a.name,className:"max-w-full max-h-[70vh] mx-auto"}),a.type==="pdf"&&e.jsx("iframe",{src:a.url,title:a.name,className:"w-full h-[70vh]"}),a.type==="other"&&e.jsx("div",{className:"text-gray-500",children:"Нет предпросмотра для этого типа файла."})]})}),p&&e.jsxs("div",{className:"text-red-500 mb-4",children:["Ошибка: ",p]}),N?e.jsx("div",{children:"Загрузка..."}):e.jsx("div",{className:"bg-white shadow rounded p-4",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2",children:"Имя"}),e.jsx("th",{className:"text-left py-2",children:"Тип"}),e.jsx("th",{className:"text-left py-2",children:"Размер"}),e.jsx("th",{className:"text-left py-2",children:"Изменён"}),e.jsx("th",{className:"text-left py-2",children:"Действия"})]})}),e.jsxs("tbody",{children:[h.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center text-gray-400 py-8",children:"Папка пуста"})}),h.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-2",children:s.type==="folder"?e.jsxs("button",{className:"text-blue-600 hover:underline",onClick:()=>v(s.path),children:["📁 ",s.name]}):e.jsxs("span",{className:"cursor-pointer",onClick:()=>C(s),children:["📄 ",s.name]})}),e.jsx("td",{className:"py-2",children:s.type==="folder"?"Папка":"Файл"}),e.jsx("td",{className:"py-2",children:s.type==="file"?(s.size/1024).toFixed(1)+" KB":""}),e.jsx("td",{className:"py-2",children:s.type==="file"?new Date(s.modified*1e3).toLocaleString():""}),e.jsxs("td",{className:"py-2 space-x-2",children:[s.type==="file"&&e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:underline",children:"Скачать"}),e.jsx("button",{onClick:()=>S(s),className:"text-red-600 hover:underline",children:"Удалить"})]})]},s.path))]})]})})]})}E.layout=c=>e.jsx(P,{title:"Файловый менеджер: public/storage",children:c});export{E as default};

import{r as m,W as O,j as e,a as _}from"./app-BWGDeSKA.js";import{A as $}from"./AdminLayout-DLUDKrFp.js";import{C as W,M as q}from"./ModernContentEditor-DOd9n2C4.js";import"./transition-DkQVzhh_.js";import"./use-is-mounted-B8xqia3W.js";const z=["Общие","Аккредитация","Обучение","Конференции","Методические материалы","Исследования","Анонсы"];function B(){const[p,i]=m.useState(!1),{data:s,setData:n,post:N,processing:f,errors:c}=O({title:"",category:[],content:"",images:[],status:"Черновик",publishDate:new Date().toISOString().substr(0,10)}),[x,w]=m.useState(z),[d,h]=m.useState([]),[g,y]=m.useState(""),[b,j]=m.useState(!1),[v,C]=m.useState([]),k=t=>{console.log("Create - изменение изображений:",t),C(t);const l=[],o=[];t.forEach(r=>{r instanceof File?l.push(r):typeof r=="string"&&o.push(r)}),n("images",o),n("image_files",l)},S=x.map(t=>({value:t,label:t})),D=(t,l)=>{let o;l?o=[...d,t]:o=d.filter(r=>r!==t),h(o),n("category",o)},E=()=>{const t=x.map(l=>l);h(t),n("category",t)},F=()=>{h([]),n("category",[])},I=()=>{const t=x.filter(l=>!d.includes(l));h(t),n("category",t)},L=()=>{if(g&&!x.includes(g)){w([...x,g]);const t=[...d,g];h(t),n("category",t),y("")}};useEffect(()=>{const t=l=>{b&&!l.target.closest(".category-dropdown")&&j(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[b]);const A=t=>{t.preventDefault(),i(!0);try{const l=s.category||[];if(!s.title||s.title.trim().length===0){alert("Заполните заголовок"),i(!1);return}typeof s.content!="string"&&n("content",String(s.content||"")),["Черновик","Опубликовано","Запланировано"].includes(s.status)||n("status","Черновик");const o=v.filter(a=>a&&(typeof a=="string"||a instanceof File&&a.size>0));if(n("images",o),!s.content||s.content.replace(/<[^>]*?>/g,"").trim().length<10){alert("Содержимое должно содержать минимум 10 символов"),i(!1);return}if(l.length===0){alert("Выберите хотя бы одну категорию"),i(!1);return}const r=new FormData;r.append("title",s.title),r.append("content",s.content),r.append("status",s.status),r.append("publishDate",s.publishDate||""),l.forEach((a,u)=>{r.append(`category[${u}]`,a)}),o.forEach((a,u)=>{a instanceof File?r.append(`image_files[${u}]`,a):typeof a=="string"&&r.append(`images[${u}]`,a)}),console.log("Отправка формы с данными:",{title:s.title,content_length:s.content?s.content.length:0,categories:l,images_count:o.length,status:s.status}),N(route("admin.news.store"),r,{forceFormData:!0,preserveScroll:!0,timeout:6e4,onStart:()=>{console.log("Начинаем отправку формы...")},onProgress:a=>{console.log("Прогресс загрузки:",a)},onSuccess:a=>{console.log("Успешная отправка:",a),i(!1)},onError:a=>{if(console.error("Ошибки валидации:",a),i(!1),a.error)alert("Ошибка сохранения: "+a.error);else{const u=Object.values(a).flat();u.length>0&&alert(`Ошибки валидации:
`+u.join(`
`))}},onFinish:()=>{console.log("Завершение отправки формы"),i(!1)}})}catch(l){console.error("Ошибка при отправке формы:",l),i(!1)}},M=t=>{n("content",t)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Создание новости"}),e.jsxs(_,{href:route("admin.news"),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Назад к списку"]})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:e.jsxs("form",{onSubmit:A,className:"min-h-full",children:[e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Заголовок *"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"text",name:"title",id:"title",value:s.title,onChange:t=>n("title",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0,placeholder:"Введите заголовок новости"})}),c.title&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:c.title})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Категории *"}),e.jsxs("div",{className:"relative category-dropdown",children:[e.jsxs("button",{type:"button",onClick:()=>j(!b),className:"w-full flex items-center justify-between px-3 py-2 border border-gray-300 rounded-md bg-white text-left text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("span",{className:d.length>0?"text-gray-900":"text-gray-500",children:d.length>0?`Выбрано: ${d.length} категорий`:"Выберите категории..."}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),b&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex gap-2 mb-3 pb-2 border-b border-gray-200",children:[e.jsx("button",{type:"button",onClick:E,className:"px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600",children:"Выбрать все"}),e.jsx("button",{type:"button",onClick:F,className:"px-2 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700",children:"Снять выбор"}),e.jsx("button",{type:"button",onClick:I,className:"px-2 py-1 text-xs bg-purple-500 text-white rounded hover:bg-purple-600",children:"Инвертировать"})]}),e.jsx("div",{className:"space-y-1",children:S.map(t=>e.jsxs("label",{className:"flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.includes(t.value),onChange:l=>D(t.value,l.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:t.label})]},t.value))}),e.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:g,onChange:t=>y(t.target.value),placeholder:"Новая категория",className:"flex-1 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("button",{type:"button",onClick:L,className:"px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600",children:"Добавить"})]})})]})})]}),c.category&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:c.category})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Статус *"}),e.jsx("div",{className:"mt-1",children:e.jsxs("select",{id:"status",name:"status",value:s.status,onChange:t=>n("status",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0,children:[e.jsx("option",{value:"Черновик",children:"Черновик"}),e.jsx("option",{value:"Опубликовано",children:"Опубликовано"}),e.jsx("option",{value:"Запланировано",children:"Запланировано"})]})}),c.status&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:c.status})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"publishDate",className:"block text-sm font-medium text-gray-700",children:"Дата публикации"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"date",name:"publishDate",id:"publishDate",value:s.publishDate,onChange:t=>n("publishDate",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md"})}),c.publishDate&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:c.publishDate})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["Галерея изображений",e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"- Добавьте до 10 изображений для слайдера"})]}),e.jsx(W,{images:v,setImages:k,maxImages:10})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Содержимое *"}),e.jsx(q,{value:s.content,onChange:M,placeholder:"Начните писать содержимое новости...",minHeight:"320px"}),c.content&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:c.content}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Минимум 10 символов"})]})]})}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 text-right sm:px-6",children:e.jsx("button",{type:"submit",className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:f||p,children:f||p?"Создание...":"Создать новость"})})]})})]})}B.layout=p=>e.jsx($,{title:"Создание новости",children:p});export{B as default};

import{r as h,W as F,j as e,a as j}from"./app-BO3zHGDT.js";import{A}from"./AdminLayout-DFbPzyc4.js";import{M as E}from"./MediaManager-TZXg2mro.js";import"./transition-fCPjGxgF.js";import"./use-is-mounted-_oJVFRYN.js";import"./SafeImage-jjCHI5gQ.js";const b=["Общие","Аккредитация","Обучение","Конференции","Методические материалы","Исследования","Анонсы"];function q({news:r}){const[y,c]=h.useState(!1),[d,f]=h.useState(r.images?r.images.map((s,l)=>({id:l,path:s,name:`Изображение ${l+1}`})):[]),{data:t,setData:a,put:N,processing:p,errors:o}=F({title:r.title||"",content:r.content||"",category:r.category||[],status:r.status||"Черновик",publish_date:r.publish_date||new Date().toISOString().substr(0,10),images:r.images||[],image_files:[]}),[g,x]=h.useState(r.category||[]),v=(s,l)=>{let i;l?i=[...g,s]:i=g.filter(n=>n!==s),x(i),a("category",i)},w=()=>{x(b),a("category",b)},k=()=>{x([]),a("category",[])},_=s=>{if((t.image_files?t.image_files.length:0)+s.length>15){alert(`Максимальное количество изображений: 15. У вас уже ${t.image_files?t.image_files.length:0} загруженных файлов.`);return}const i=s.map(n=>n.path);f(s),a("images",i)},C=s=>{const l=Array.from(s.target.files);if((t.images?t.images.length:0)+(t.image_files?t.image_files.length:0)+l.length>15){alert(`Максимальное количество изображений: 15. У вас уже ${t.images?t.images.length:0} изображений из библиотеки и ${t.image_files?t.image_files.length:0} загруженных файлов.`);return}const n=10*1024*1024,m=l.filter(u=>u.size>n);if(m.length>0){const u=m.map(I=>I.name).join(", ");alert(`Следующие файлы превышают лимит 10MB: ${u}`);return}a("image_files",l)},S=s=>{const l=d.filter((n,m)=>m!==s),i=l.map(n=>n.path);f(l),a("images",i)},M=s=>{const l=t.image_files.filter((i,n)=>n!==s);a("image_files",l)},L=s=>{if(s.preventDefault(),!t.title.trim()){alert("Заполните заголовок");return}if(!t.content.trim()||t.content.replace(/<[^>]*?>/g,"").trim().length<10){alert("Содержимое должно содержать минимум 10 символов");return}if(t.category.length===0){alert("Выберите хотя бы одну категорию");return}console.log("Отправка данных:",{title:t.title,content_length:t.content.length,categories:t.category,images_count:t.images.length,files_count:t.image_files.length,status:t.status}),N(route("admin.news.update",r.id))};return e.jsxs(A,{children:[e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Редактирование новости"}),e.jsxs(j,{href:route("admin.news"),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Назад к списку"]})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:e.jsx("form",{onSubmit:L,className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Заголовок *"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"text",name:"title",id:"title",value:t.title,onChange:s=>a("title",s.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0,placeholder:"Введите заголовок новости"})}),o.title&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:o.title})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Категории *"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{type:"button",onClick:w,className:"px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200",children:"Выбрать все"}),e.jsx("button",{type:"button",onClick:k,className:"px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200",children:"Снять выбор"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:b.map(s=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:g.includes(s),onChange:l=>v(s,l.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:s})]},s))}),o.category&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:o.category})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700",children:"Содержимое *"}),e.jsx("div",{className:"mt-1",children:e.jsx("textarea",{name:"content",id:"content",rows:10,value:t.content,onChange:s=>a("content",s.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0,placeholder:"Введите содержимое новости"})}),o.content&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:o.content})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Статус"}),e.jsx("div",{className:"mt-1",children:e.jsxs("select",{name:"status",id:"status",value:t.status,onChange:s=>a("status",s.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",children:[e.jsx("option",{value:"Черновик",children:"Черновик"}),e.jsx("option",{value:"Опубликовано",children:"Опубликовано"}),e.jsx("option",{value:"Запланировано",children:"Запланировано"})]})})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"publish_date",className:"block text-sm font-medium text-gray-700",children:"Дата публикации"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"date",name:"publish_date",id:"publish_date",value:t.publish_date,onChange:s=>a("publish_date",s.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md"})})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Изображения (до 15 файлов)",e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:[(t.images?t.images.length:0)+(t.image_files?t.image_files.length:0),"/15"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Загрузить файлы (до 15 изображений, максимум 10MB каждое):"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:C,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),t.image_files&&t.image_files.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Загруженные файлы:"}),e.jsx("div",{className:"space-y-1",children:t.image_files.map((s,l)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm text-gray-700",children:s.name}),e.jsx("button",{type:"button",onClick:()=>M(l),className:"text-red-600 hover:text-red-800",children:"Удалить"})]},l))})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("button",{type:"button",onClick:()=>c(!0),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Выбрать из библиотеки"]}),d.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Выбранные изображения:"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:d.map((s,l)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:s.path,alt:s.name,className:"w-full h-24 object-cover rounded border"}),e.jsx("button",{type:"button",onClick:()=>S(l),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity",children:"×"})]},l))})]})]})]}),e.jsxs("div",{className:"sm:col-span-6 flex justify-end space-x-3",children:[e.jsx(j,{href:route("admin.news"),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Отмена"}),e.jsx("button",{type:"submit",disabled:p,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:p?"Сохранение...":"Сохранить"})]})]})})})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Библиотека изображений"}),e.jsx("button",{onClick:()=>c(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx(E,{onSelect:_,onClose:()=>c(!1),multiple:!0})]})})]})}export{q as default};

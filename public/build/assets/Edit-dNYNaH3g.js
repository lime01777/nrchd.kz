import{r as o,W as N,j as e,Y as v,a as w}from"./app-Y-8A9vy4.js";import{A as _}from"./AdminLayout-D2Uust3B.js";import"./transition-Bl_UznXh.js";function C({vacancy:r}){const p=t=>!t||!Array.isArray(t)?"":t.map(s=>s.type==="paragraph"&&s.data&&s.data.text?s.data.text:"").join(`

`),[S,m]=o.useState(!1),[u,b]=o.useState(p(r.body)||""),{data:a,setData:d,put:h,processing:x,errors:l}=N({title:r.title||"",slug:r.slug||"",excerpt:r.excerpt||"",body:Array.isArray(r.body)?r.body:[],city:r.city||"",department:r.department||"",employment_type:r.employment_type||"",status:r.status||"draft",published_at:r.published_at?new Date(r.published_at).toISOString().substr(0,10):""}),c=t=>{const n=t.split(`
`).filter(i=>i.trim()!=="").map(i=>({type:"paragraph",data:{text:i.trim()}}));d("body",n),b(t)};o.useEffect(()=>{a.status==="published"&&!a.published_at&&d("published_at",new Date().toISOString().substr(0,10))},[a.status]);const[F,g]=o.useState("");o.useEffect(()=>{if(r.body&&r.body.blocks){const t=r.body.blocks.map(s=>{if(s.type==="paragraph")return`<p>${s.data.text}</p>`;if(s.type==="header")return`<h${s.data.level}>${s.data.text}</h${s.data.level}>`;if(s.type==="list"){const n=s.data.style==="ordered"?"ol":"ul",i=s.data.items.map(j=>`<li>${j}</li>`).join("");return`<${n}>${i}</${n}>`}return""}).join("");g(t)}},[r]);const y=["Полная занятость","Частичная занятость","Проектная работа","Стажировка","Удаленная работа"],f=t=>{t.preventDefault(),m(!0);try{a.body.length===0&&u.trim()!==""&&c(u);const s=a.status==="published"&&!a.published_at?new Date().toISOString().substr(0,10):a.published_at;h(route("vacancies.update",r.id),{...a,published_at:s})}catch(s){console.error("Ошибка при отправке формы:",s),m(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"Редактирование вакансии"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6 bg-white border-b border-gray-200",children:[e.jsxs("div",{className:"mb-6 flex justify-between",children:[e.jsxs("h1",{className:"text-2xl font-semibold text-gray-900",children:["Редактирование вакансии: ",r.title]}),e.jsx(w,{href:route("vacancies.index"),className:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400",children:"Назад к списку"})]}),e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Название *"}),e.jsx("input",{type:"text",id:"title",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-200",value:a.title,onChange:t=>d("title",t.target.value),required:!0}),l.title&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:l.title})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"slug",className:"block text-sm font-medium text-gray-700 mb-1",children:"URL slug (опционально)"}),e.jsx("input",{type:"text",id:"slug",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-200",value:a.slug,onChange:t=>d("slug",t.target.value),placeholder:"Оставьте пустым для автоматической генерации"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Если оставить пустым, slug будет сгенерирован автоматически из названия"}),l.slug&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:l.slug})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"excerpt",className:"block text-sm font-medium text-gray-700 mb-1",children:"Краткое описание"}),e.jsx("textarea",{id:"excerpt",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-200",rows:"3",value:a.excerpt,onChange:t=>d("excerpt",t.target.value)}),l.excerpt&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:l.excerpt})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700 mb-1",children:"Город *"}),e.jsx("input",{type:"text",id:"city",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-200",value:a.city,onChange:t=>d("city",t.target.value),required:!0}),l.city&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:l.city})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"department",className:"block text-sm font-medium text-gray-700 mb-1",children:"Департамент *"}),e.jsx("input",{type:"text",id:"department",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-200",value:a.department,onChange:t=>d("department",t.target.value),required:!0}),l.department&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:l.department})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"employment_type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Тип занятости *"}),e.jsxs("select",{id:"employment_type",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-200",value:a.employment_type,onChange:t=>d("employment_type",t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Выберите тип занятости"}),y.map((t,s)=>e.jsx("option",{value:t,children:t},s))]}),l.employment_type&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:l.employment_type})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Статус *"}),e.jsxs("select",{id:"status",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-200",value:a.status,onChange:t=>d("status",t.target.value),required:!0,children:[e.jsx("option",{value:"draft",children:"Черновик"}),e.jsx("option",{value:"published",children:"Опубликовано"})]}),l.status&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:l.status})]})]}),a.status==="published"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"published_at",className:"block text-sm font-medium text-gray-700 mb-1",children:"Дата публикации"}),e.jsx("input",{type:"date",id:"published_at",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-200",value:a.published_at,onChange:t=>d("published_at",t.target.value)}),l.published_at&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:l.published_at})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"body",className:"block text-sm font-medium text-gray-700 mb-1",children:"Описание вакансии *"}),e.jsx("textarea",{id:"body",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-200",value:u,rows:"10",onChange:t=>c(t.target.value),placeholder:"Введите описание вакансии. Каждый абзац будет отображаться отдельно.",required:!0}),l.body&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:l.body})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-end",children:[e.jsx("button",{type:"button",className:"mr-3 px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",onClick:()=>window.history.back(),children:"Отмена"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:x,children:x?"Сохранение...":"Сохранить изменения"})]})]})]})})})})]})}C.layout=r=>e.jsx(_,{title:"Редактирование вакансии",children:r});export{C as default};

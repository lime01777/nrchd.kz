import{r as i,R as S,j as e,a as _}from"./app-glZY-ooV.js";import{S as L}from"./SafeImage-B-q1e-oD.js";import{S as W}from"./SafeVideo-DiwRhwTt.js";import{i as I}from"./mediaUtils-oRnee45q.js";import"./TranslationService-YZakzCnB.js";function M({images:w=[],className:m="",height:h="160px",showDots:u=!0,showCounter:d=!1,autoPlay:j=!0,interval:y=3e3}){const[l,x]=i.useState(0),[b,p]=i.useState(new Set),[f,g]=i.useState(new Set),[v,n]=i.useState(!0),c="news-slider:go-to",r=i.useCallback(a=>{if(!a||typeof a!="string")return a;const t=a.trim();return t.startsWith("http")||t.startsWith("/storage/")||t.startsWith("/img/news/")?t:t.startsWith("/")&&!t.startsWith("/storage/")&&!t.startsWith("/img/")?`/img/news${t}`:t.startsWith("/")?t:`/img/news/${t}`},[]),s=S.useMemo(()=>!Array.isArray(w)||w.length===0?[]:w.filter(t=>t?typeof t=="string"?t.trim()!==""&&(t.startsWith("http")||t.startsWith("blob:")||t.startsWith("/")):t instanceof File?t.size>0&&t.type.startsWith("image/"):!1:!1).map(t=>r(t)).filter(t=>t&&t.trim()!==""),[w,r]),N=i.useCallback(a=>{p(t=>{const o=new Set(t);return o.add(a),o.size>=s.length&&n(!1),o})},[s.length]),k=i.useCallback(a=>{console.warn("Ошибка загрузки изображения:",s[a]),g(t=>{const o=new Set(t);return o.add(a),o}),p(t=>{const o=new Set(t);return o.add(a),o.size>=s.length&&n(!1),o})},[s.length]);if(i.useEffect(()=>{p(new Set),g(new Set),n(!0),x(0)},[s]),i.useEffect(()=>{if(!j||s.length<=1||!b.has(0)&&!f.has(0))return;const a=setInterval(()=>{x(t=>(t+1)%s.length)},y);return()=>clearInterval(a)},[s.length,j,y,b,f]),i.useEffect(()=>{const a=t=>{const o=Number(t.detail);!Number.isNaN(o)&&o>=0&&o<s.length&&x(o)};return window.addEventListener(c,a),()=>{window.removeEventListener(c,a)}},[s.length]),!Array.isArray(s)||s.length===0)return e.jsx("div",{className:`relative overflow-hidden rounded-lg bg-gray-200 flex items-center justify-center ${m}`,style:{height:h},children:e.jsxs("div",{className:"text-gray-400 text-center",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"text-sm",children:"Нет изображений"})]})});if(s.length===1)return e.jsxs("div",{className:`relative overflow-hidden ${m}`,style:h==="100%"?{height:"100%"}:{height:h},children:[v&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 flex items-center justify-center z-10",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),e.jsx(L,{src:s[0],alt:"Изображение новости",className:`w-full h-full object-contain transition-opacity duration-300 ${b.has(0)?"opacity-100":"opacity-0"}`,fallbackSrc:"",onLoad:()=>N(0),onError:()=>k(0),style:{position:"relative",zIndex:1}}),d&&!v&&e.jsx("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded z-20",children:"1 / 1"}),u&&!v&&e.jsx("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1 z-20",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full opacity-100"})})]});const z=a=>{x(a)};return e.jsxs("div",{className:`relative overflow-hidden ${m}`,style:h==="100%"?{height:"100%"}:{height:h},children:[e.jsxs("div",{className:"relative w-full h-full bg-gray-200",children:[f.has(l)?e.jsx("div",{className:"absolute inset-0 bg-gray-200 flex items-center justify-center z-20",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"text-xs",children:"Изображение недоступно"})]})}):e.jsx(L,{src:s[l],alt:`Изображение ${l+1}`,className:`w-full h-full object-contain transition-opacity duration-500 ${b.has(l)?"opacity-100":"opacity-0"}`,fallbackSrc:"",onLoad:()=>N(l),onError:()=>k(l),style:{position:"relative",zIndex:10}}),s.map((a,t)=>t!==l&&e.jsx("img",{src:a,alt:"",className:"hidden",onLoad:()=>N(t),onError:()=>k(t)},t)),!b.has(l)&&!f.has(l)&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 flex items-center justify-center z-30",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})})]}),d&&s.length>1&&e.jsxs("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded z-10",children:[l+1," / ",s.length]}),u&&s.length>1&&e.jsx("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1 z-10",children:s.map((a,t)=>e.jsx("button",{onClick:()=>z(t),className:`w-2 h-2 rounded-full transition-all duration-200 ${t===l?"bg-white opacity-100":"bg-white opacity-50 hover:opacity-75"}`,"aria-label":`Перейти к изображению ${t+1}`},t))})]})}const E=S.memo(({date:w,description:m,slug:h,image:u,images:d=[],external_url:j,type:y})=>{const l=i.useMemo(()=>(d&&d.length>0?d:u?[u]:[]).map(r=>r?typeof r=="string"?r:typeof r=="object"&&(r.url||r.path)||null:null).filter(Boolean).filter(r=>!I(r)),[d,u]),x=i.useMemo(()=>(d&&d.length>0?d:u?[u]:[]).map(r=>{if(!r)return null;if(typeof r=="string")return I(r)?{src:r,url:r,embed_url:null,is_external:r.startsWith("http"),is_embed:!1}:null;if(typeof r=="object"){const s=r.url||r.path||null;if(!s)return null;if(r.type==="video"||I(s))return{src:r.embed_url||s,url:s,embed_url:r.embed_url||null,is_external:!!(r.is_external||s.startsWith("http")),is_embed:!!(r.is_embed||r.embed_url),thumbnail:r.thumbnail||null}}return null}).filter(Boolean),[d,u]),b=i.useMemo(()=>l.join("|"),[l]),p=y==="media"&&j,f=p?j:h?route("news.show",h):null,g=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"aspect-[4/3] overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200 relative group",children:[x.length>0?(()=>{const n=x[0];return n.is_external&&n.is_embed&&n.embed_url?e.jsx("div",{className:"w-full h-full relative",children:e.jsx("iframe",{src:n.embed_url,title:m,className:"w-full h-full object-contain",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0,frameBorder:"0"})}):e.jsxs("div",{className:"w-full h-full relative",children:[e.jsx(W,{src:n.src||n.url,className:"w-full h-full object-contain",controls:!1,muted:!0,playsInline:!0,poster:n.thumbnail}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"bg-black bg-opacity-60 rounded-full p-4 transform group-hover:scale-110 transition-transform duration-300",children:e.jsx("svg",{className:"w-10 h-10 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})})]})})():l.length>0?e.jsx("div",{className:"w-full h-full",children:e.jsx(M,{images:l,className:"w-full h-full",height:"100%",showDots:!0,showCounter:!1,autoPlay:!0,interval:3e3},b)}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-200 to-gray-300",children:e.jsx("svg",{className:"w-16 h-16 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),e.jsx("div",{className:"flex flex-col p-4 bg-white flex-shrink-0",children:e.jsx("div",{className:"flex flex-col",children:e.jsx("h2",{className:"text-gray-900 text-sm font-semibold line-clamp-3",title:m,children:m})})})]}),v=S.useCallback(n=>{const c=n.target;if(c.tagName==="BUTTON"||c.closest("button")||c.closest("a")||c.tagName==="IFRAME"||c.tagName==="VIDEO"||c.closest("iframe")||c.closest("video")){n.stopPropagation();return}},[]);return f?p?e.jsx("a",{href:f,target:"_blank",rel:"noopener noreferrer",className:"bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 h-full flex flex-col cursor-pointer group overflow-hidden border border-gray-100 hover:border-blue-200 transform hover:-translate-y-1",onClick:v,children:g}):e.jsx(_,{href:f,className:"bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 h-full flex flex-col group overflow-hidden border border-gray-100 hover:border-blue-200 transform hover:-translate-y-1",onClick:v,preserveScroll:!0,children:g}):e.jsx("div",{className:"bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 h-full flex flex-col group overflow-hidden border border-gray-100",children:g})});E.displayName="News_chlank";export{E as N};

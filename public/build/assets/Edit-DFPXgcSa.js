import{W as R,r as o,j as e,a as O}from"./app-PA0ZTPqP.js";import{A as P}from"./AdminLayout-C5vOnNAG.js";import{E as T}from"./Editor-eg61GYoN.js";import{S as U}from"./react-select.esm-CeRxWwZT.js";import"./transition-C59dnKcY.js";const N=["Общие","Аккредитация","Обучение","Конференции","Методические материалы","Исследования","Анонсы"];function _({news:s=null}){const i=!!s,{data:r,setData:l,post:k,put:C,processing:D,errors:a}=R({title:(s==null?void 0:s.title)||"",slug:(s==null?void 0:s.slug)||"",category:Array.isArray(s==null?void 0:s.category)?s.category:s!=null&&s.category?[s.category]:[],content:(s==null?void 0:s.content)||"",image:null,status:(s==null?void 0:s.status)||"Черновик",publishDate:(s==null?void 0:s.publishDate)||new Date().toISOString().substr(0,10)}),[g,x]=o.useState(null),[f,m]=o.useState(null),[h,S]=o.useState(()=>{if(s!=null&&s.category){const t=Array.isArray(s.category)?s.category:[s.category];return Array.from(new Set([...N,...t]))}return N}),[p,b]=o.useState(Array.isArray(r.category)?r.category:r.category?[r.category]:[]),[d,y]=o.useState("");o.useState(null);const L=t=>{t.preventDefault(),t.dataTransfer.files&&t.dataTransfer.files[0]&&(l("image",t.dataTransfer.files[0]),x(t.dataTransfer.files[0]))},A=t=>{t.target.files&&t.target.files[0]&&(l("image",t.target.files[0]),x(t.target.files[0]))},E=()=>{l("image",null),x(null),m(null)};o.useEffect(()=>{if(g){const t=URL.createObjectURL(g);return m(t),()=>URL.revokeObjectURL(t)}else i&&s.image?m(s.image):m(null)},[g,i,s]),o.useEffect(()=>{if(!i&&r.title){const t=r.title.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-");l("slug",t)}},[r.title,i]);const F=(t,n)=>{l("content",t)},w=()=>{if(d&&!h.includes(d)){S([...h,d]);const t=[...p,d];b(t),l("category",t),y("")}},j=h.map(t=>({value:t,label:t})),I=t=>{const n=t?t.map(u=>u.value):[];b(n),l("category",n)},M=t=>{t.preventDefault(),l("category",p),i?C(route("admin.news.update",s.id),{forceFormData:!0}):k(route("admin.news.store"),{forceFormData:!0})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:i?"Редактирование новости":"Создание новости"}),e.jsxs(O,{href:route("admin.news"),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Назад к списку"]})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:e.jsxs("form",{onSubmit:M,children:[e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Заголовок"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"text",name:"title",id:"title",value:r.title,onChange:t=>l("title",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0})}),a.title&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:a.title})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Категории"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start sm:items-center mb-2",children:[e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(U,{isMulti:!0,options:j,value:j.filter(t=>p.includes(t.value)),onChange:I,classNamePrefix:"react-select",placeholder:"Выберите категории...",styles:{control:t=>({...t,minHeight:"42px",borderRadius:"8px",borderColor:"#cbd5e1",boxShadow:"none"}),multiValue:t=>({...t,background:"#e0e7ff",color:"#3730a3"}),option:(t,n)=>({...t,background:n.isFocused?"#f3f4f6":"white",color:"#1e293b"})}})}),e.jsxs("div",{className:"flex gap-2 items-center w-full sm:w-auto",children:[e.jsx("input",{type:"text",value:d,onChange:t=>y(t.target.value),placeholder:"Новая категория",className:"border rounded px-2 py-1 text-sm"}),e.jsx("button",{type:"button",onClick:w,className:"px-2 py-1 bg-blue-500 text-white rounded text-sm",children:"Добавить"})]})]}),a.category&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:a.category})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Статус"}),e.jsx("div",{className:"mt-1",children:e.jsxs("select",{id:"status",name:"status",value:r.status,onChange:t=>l("status",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0,children:[e.jsx("option",{value:"Черновик",children:"Черновик"}),e.jsx("option",{value:"Опубликовано",children:"Опубликовано"}),e.jsx("option",{value:"Запланировано",children:"Запланировано"})]})}),a.status&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:a.status})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"publishDate",className:"block text-sm font-medium text-gray-700",children:"Дата публикации"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"date",name:"publishDate",id:"publishDate",value:r.publishDate,onChange:t=>l("publishDate",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0})}),a.publishDate&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:a.publishDate})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Изображение"}),e.jsxs("div",{className:"flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-lg p-4 bg-gray-50 hover:bg-gray-100 transition cursor-pointer relative",onDrop:L,onDragOver:t=>t.preventDefault(),onClick:()=>document.getElementById("image-upload-input").click(),style:{minHeight:"120px"},children:[f?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:f,alt:"Превью",className:"h-32 w-32 object-cover rounded-lg shadow"}),e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),E()},className:"absolute top-1 right-1 bg-white bg-opacity-80 rounded-full p-1 shadow hover:bg-red-100 transition",title:"Удалить изображение",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("svg",{className:"h-10 w-10 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 48 48",children:e.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-blue-600 font-medium cursor-pointer",children:"Загрузить файл"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["или перетащите сюда",e.jsx("br",{}),"PNG, JPG, GIF до 10MB"]})]}),e.jsx("input",{id:"image-upload-input",type:"file",accept:"image/*",className:"hidden",onChange:A})]}),a.image&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:a.image})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Содержимое"}),e.jsx("div",{className:"bg-white border-2 border-blue-200 rounded-lg shadow-sm p-2 min-h-[220px] focus-within:ring-2 focus-within:ring-blue-400 transition-all",style:{boxShadow:"0 2px 8px 0 #e0e7ff"},children:e.jsx(T,{apiKey:"ckt2ux657iu8ehiz8mhzuy8zxnec6kv9bra5dtuif75nwdoq",value:r.content,init:{height:350,menubar:!0,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount"],toolbar:"undo redo | formatselect | bold italic backcolor |                         alignleft aligncenter alignright alignjustify |                         bullist numlist outdent indent | removeformat | help | image link",content_style:"body { font-family:Inter,Arial,sans-serif; font-size:16px }",language:"ru",images_upload_url:"/api/editor-upload",images_upload_handler:function(t,n,u){const v=new FormData;v.append("image",t.blob()),fetch("/api/editor-upload",{method:"POST",body:v}).then(c=>c.json()).then(c=>{c.success&&c.file&&c.file.url?n(c.file.url):u("Ошибка загрузки")}).catch(()=>u("Ошибка загрузки"))}},onEditorChange:F})}),a.content&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:a.content})]})]})}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 text-right sm:px-6",children:e.jsx("button",{type:"submit",className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:D,children:i?"Сохранить изменения":"Создать новость"})})]})})]})}_.layout=s=>e.jsx(P,{title:"Редактирование новости",children:s});export{_ as default};

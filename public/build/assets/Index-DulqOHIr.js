import{r as f,W as S,j as e,a as z,y as D}from"./app-B7NIE5fM.js";import{A as I}from"./AdminLayout-D7uE_d47.js";import{I as C}from"./InputLabel-Cd22mnWr.js";import{P as L}from"./PrimaryButton-DG1_PJ96.js";import"./transition-C5NUuQRQ.js";import"./use-is-mounted-oAftLR9C.js";function T({algorithmSteps:x=[],algorithmIndicators:h=[],algorithmImage:p=null}){const[a,i]=f.useState(x.length>0?x.map((t,n)=>({id:n,content_ru:t,content_kz:"",content_en:""})):[{id:0,content_ru:"",content_kz:"",content_en:""}]),[l,d]=f.useState(h.length>0?h.map((t,n)=>({id:n,content_ru:t,content_kz:"",content_en:""})):[{id:0,content_ru:"",content_kz:"",content_en:""}]),{data:c,setData:b,post:E,processing:g}=S({algorithm_steps:a,algorithm_indicators:l,image:null}),j=()=>{i([...a,{id:Date.now(),content_ru:"",content_kz:"",content_en:""}])},_=t=>{i(a.filter(n=>n.id!==t))},v=(t,n,r)=>{i(a.map(o=>o.id===t?{...o,[n]:r}:o))},y=()=>{d([...l,{id:Date.now(),content_ru:"",content_kz:"",content_en:""}])},N=t=>{d(l.filter(n=>n.id!==t))},w=(t,n,r)=>{d(l.map(o=>o.id===t?{...o,[n]:r}:o))},k=t=>{t.preventDefault();const n=a.filter(s=>s.content_ru&&s.content_ru.trim()),r=l.filter(s=>s.content_ru&&s.content_ru.trim());console.log("Отправка данных:",{steps:n,indicators:r,hasImage:!!c.image});const o={algorithm_steps:n,algorithm_indicators:r};c.image&&(o.image=c.image),D.post(route("admin.medtech.content.store"),o,{forceFormData:!0,preserveScroll:!0,onSuccess:s=>{console.log("Контент успешно сохранен"),s.props.algorithmSteps&&i(s.props.algorithmSteps.length>0?s.props.algorithmSteps.map((m,u)=>({id:Date.now()+u,content_ru:m,content_kz:"",content_en:""})):[{id:Date.now(),content_ru:"",content_kz:"",content_en:""}]),s.props.algorithmIndicators&&d(s.props.algorithmIndicators.length>0?s.props.algorithmIndicators.map((m,u)=>({id:Date.now()+u,content_ru:m,content_kz:"",content_en:""})):[{id:Date.now(),content_ru:"",content_kz:"",content_en:""}]),b("image",null)},onError:s=>{console.error("Ошибки при сохранении:",s),alert("Произошла ошибка при сохранении. Проверьте консоль для деталей.")}})};return e.jsx(I,{title:"Управление контентом MedTech",children:e.jsx("div",{className:"py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-4",children:e.jsxs(z,{href:route("admin.medtech.index"),className:"text-blue-600 hover:text-blue-800 inline-flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Назад к платформе MedTech"]})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Управление контентом платформы"}),e.jsxs("form",{onSubmit:k,className:"space-y-8",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Изображение алгоритма внедрения"}),p&&e.jsx("div",{className:"mb-4",children:e.jsx("img",{src:p,alt:"Алгоритм внедрения",className:"max-w-full h-auto rounded-lg border border-gray-200"})}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"image",value:"Загрузить новое изображение"}),e.jsx("input",{id:"image",type:"file",accept:"image/*",onChange:t=>b("image",t.target.files[0]),className:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Этапы алгоритма"}),e.jsx("button",{type:"button",onClick:j,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Добавить этап"})]}),e.jsx("div",{className:"space-y-4",children:a.map((t,n)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Этап ",n+1]}),a.length>1&&e.jsx("button",{type:"button",onClick:()=>_(t.id),className:"text-red-600 hover:text-red-800 text-sm",children:"Удалить"})]}),e.jsx("textarea",{value:t.content_ru||"",onChange:r=>v(t.id,"content_ru",r.target.value),rows:3,className:"w-full border-gray-300 rounded-md shadow-sm",placeholder:"Описание этапа на русском *",required:!0})]},t.id))})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Ключевые индикаторы"}),e.jsx("button",{type:"button",onClick:y,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Добавить индикатор"})]}),e.jsx("div",{className:"space-y-4",children:l.map((t,n)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Индикатор ",n+1]}),l.length>1&&e.jsx("button",{type:"button",onClick:()=>N(t.id),className:"text-red-600 hover:text-red-800 text-sm",children:"Удалить"})]}),e.jsx("textarea",{value:t.content_ru||"",onChange:r=>w(t.id,"content_ru",r.target.value),rows:2,className:"w-full border-gray-300 rounded-md shadow-sm",placeholder:"Описание индикатора на русском *",required:!0})]},t.id))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(L,{type:"submit",disabled:g,children:g?"Сохранение...":"Сохранить контент"})})]})]})})})}export{T as default};

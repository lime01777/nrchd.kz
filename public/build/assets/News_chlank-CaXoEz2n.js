import{r as c,R as L,j as e,b as M}from"./app-B885_QiX.js";import{S as _}from"./SafeImage-DxKnZFBh.js";import{S as C}from"./SafeVideo-Dw93mf4u.js";import{i as S}from"./mediaUtils-oRnee45q.js";import"./TranslationService-CKsrIfHs.js";function E({images:w=[],className:b="",height:h="160px",showDots:u=!0,showCounter:d=!1,autoPlay:j=!0,interval:N=3e3,objectFit:g="contain"}){const[o,v]=c.useState(0),[f,p]=c.useState(new Set),[m,y]=c.useState(new Set),[a,i]=c.useState(!0),r="news-slider:go-to",x=c.useCallback(l=>{if(!l||typeof l!="string")return l;const t=l.trim();return t.startsWith("http")||t.startsWith("/storage/")||t.startsWith("/img/news/")?t:t.startsWith("/")&&!t.startsWith("/storage/")&&!t.startsWith("/img/")?`/img/news${t}`:t.startsWith("/")?t:`/img/news/${t}`},[]),s=L.useMemo(()=>!Array.isArray(w)||w.length===0?[]:w.filter(t=>t?typeof t=="string"?t.trim()!==""&&(t.startsWith("http")||t.startsWith("blob:")||t.startsWith("/")):t instanceof File?t.size>0&&t.type.startsWith("image/"):!1:!1).map(t=>x(t)).filter(t=>t&&t.trim()!==""),[w,x]),k=c.useCallback(l=>{p(t=>{const n=new Set(t);return n.add(l),n.size>=s.length&&i(!1),n})},[s.length]),I=c.useCallback(l=>{console.warn("Ошибка загрузки изображения:",s[l]),y(t=>{const n=new Set(t);return n.add(l),n}),p(t=>{const n=new Set(t);return n.add(l),n.size>=s.length&&i(!1),n})},[s.length]);if(c.useEffect(()=>{p(new Set),y(new Set),i(!0),v(0)},[s]),c.useEffect(()=>{if(!j||s.length<=1||!f.has(0)&&!m.has(0))return;const l=setInterval(()=>{v(t=>(t+1)%s.length)},N);return()=>clearInterval(l)},[s.length,j,N,f,m]),c.useEffect(()=>{const l=t=>{const n=Number(t.detail);!Number.isNaN(n)&&n>=0&&n<s.length&&v(n)};return window.addEventListener(r,l),()=>{window.removeEventListener(r,l)}},[s.length]),!Array.isArray(s)||s.length===0)return e.jsx("div",{className:`relative overflow-hidden rounded-lg bg-gray-200 flex items-center justify-center ${b}`,style:{height:h},children:e.jsxs("div",{className:"text-gray-400 text-center",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"text-sm",children:"Нет изображений"})]})});const z=g==="cover"?"object-cover":"object-contain";if(s.length===1)return e.jsxs("div",{className:`relative overflow-hidden ${b}`,style:h==="100%"?{height:"100%"}:{height:h},children:[a&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 flex items-center justify-center z-10",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),e.jsx(_,{src:s[0],alt:"Изображение новости",className:`w-full h-full ${z} transition-opacity duration-300 ${f.has(0)?"opacity-100":"opacity-0"}`,fallbackSrc:"",onLoad:()=>k(0),onError:()=>I(0),style:{position:"relative",zIndex:1}}),d&&!a&&e.jsx("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded z-20",children:"1 / 1"}),u&&!a&&e.jsx("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1 z-20",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full opacity-100"})})]});const W=l=>{v(l)};return e.jsxs("div",{className:`relative overflow-hidden ${b}`,style:h==="100%"?{height:"100%"}:{height:h},children:[e.jsxs("div",{className:"relative w-full h-full bg-gray-200",children:[m.has(o)?e.jsx("div",{className:"absolute inset-0 bg-gray-200 flex items-center justify-center z-20",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"text-xs",children:"Изображение недоступно"})]})}):e.jsx(_,{src:s[o],alt:`Изображение ${o+1}`,className:`w-full h-full ${z} transition-opacity duration-500 ${f.has(o)?"opacity-100":"opacity-0"}`,fallbackSrc:"",onLoad:()=>k(o),onError:()=>I(o),style:{position:"relative",zIndex:10}}),s.map((l,t)=>t!==o&&e.jsx("img",{src:l,alt:"",className:"hidden",onLoad:()=>k(t),onError:()=>I(t)},t)),!f.has(o)&&!m.has(o)&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 flex items-center justify-center z-30",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})})]}),d&&s.length>1&&e.jsxs("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded z-10",children:[o+1," / ",s.length]}),u&&s.length>1&&e.jsx("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1 z-10",children:s.map((l,t)=>e.jsx("button",{onClick:()=>W(t),className:`w-2 h-2 rounded-full transition-all duration-200 ${t===o?"bg-white opacity-100":"bg-white opacity-50 hover:opacity-75"}`,"aria-label":`Перейти к изображению ${t+1}`},t))})]})}const $=L.memo(({date:w,description:b,slug:h,image:u,images:d=[],external_url:j,type:N})=>{const g=c.useMemo(()=>(d&&d.length>0?d:u?[u]:[]).map(r=>r?typeof r=="string"?r:typeof r=="object"&&(r.url||r.path)||null:null).filter(Boolean).filter(r=>!S(r)),[d,u]),o=c.useMemo(()=>(d&&d.length>0?d:u?[u]:[]).map(r=>{if(!r)return null;if(typeof r=="string")return S(r)?{src:r,url:r,embed_url:null,is_external:r.startsWith("http"),is_embed:!1}:null;if(typeof r=="object"){const x=r.url||r.path||null;if(!x)return null;if(r.type==="video"||S(x))return{src:r.embed_url||x,url:x,embed_url:r.embed_url||null,is_external:!!(r.is_external||x.startsWith("http")),is_embed:!!(r.is_embed||r.embed_url),thumbnail:r.thumbnail||null}}return null}).filter(Boolean),[d,u]),v=c.useMemo(()=>g.join("|"),[g]),f=N==="media"&&j,p=f?j:h?route("news.show",h):null,m=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"aspect-[4/3] overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200 relative group",children:[o.length>0?(()=>{const a=o[0];return a.is_external&&a.is_embed&&a.embed_url?e.jsx("div",{className:"w-full h-full relative",children:e.jsx("iframe",{src:a.embed_url,title:b,className:"w-full h-full object-contain",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0,frameBorder:"0"})}):e.jsxs("div",{className:"w-full h-full relative",children:[e.jsx(C,{src:a.src||a.url,className:"w-full h-full object-contain",controls:!1,muted:!0,playsInline:!0,poster:a.thumbnail}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"bg-black bg-opacity-60 rounded-full p-4 transform group-hover:scale-110 transition-transform duration-300",children:e.jsx("svg",{className:"w-10 h-10 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})})]})})():g.length>0?e.jsx("div",{className:"w-full h-full",children:e.jsx(E,{images:g,className:"w-full h-full",height:"100%",showDots:!1,showCounter:!1,autoPlay:!1,interval:3e3,objectFit:"cover"},v)}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-200 to-gray-300",children:e.jsx("svg",{className:"w-16 h-16 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),e.jsx("div",{className:"flex flex-col p-5 bg-white flex-shrink-0",children:e.jsx("div",{className:"flex flex-col",children:e.jsx("h2",{className:"text-gray-900 text-base font-semibold line-clamp-3 h-[4.5rem]",title:b,children:b})})})]}),y=L.useCallback(a=>{const i=a.target;if(i.tagName==="BUTTON"||i.closest("button")||i.closest("a")||i.tagName==="IFRAME"||i.tagName==="VIDEO"||i.closest("iframe")||i.closest("video")){a.stopPropagation();return}},[]);return p?f?e.jsx("a",{href:p,target:"_blank",rel:"noopener noreferrer",className:"bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 h-full flex flex-col cursor-pointer group overflow-hidden border border-gray-100 hover:border-blue-200 transform hover:-translate-y-1",onClick:y,children:m}):e.jsx(M,{href:p,className:"bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 h-full flex flex-col group overflow-hidden border border-gray-100 hover:border-blue-200 transform hover:-translate-y-1",onClick:y,preserveScroll:!0,children:m}):e.jsx("div",{className:"bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 h-full flex flex-col group overflow-hidden border border-gray-100",children:m})});$.displayName="News_chlank";export{$ as N};

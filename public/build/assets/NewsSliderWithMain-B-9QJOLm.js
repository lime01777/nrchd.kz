import{r as l,R as S,j as r}from"./app-JJnr8YSF.js";function I({images:o=[],className:c="",height:d="160px",showDots:p=!0,showCounter:b=!1,autoPlay:j=!0,interval:w=3e3}){const[a,u]=l.useState(0),[i,h]=l.useState(new Set),[N,v]=l.useState(new Set),[g,m]=l.useState(!0),y=l.useCallback(t=>{if(!t||typeof t!="string")return t;const e=t.trim();return e.startsWith("http")?e:e.startsWith("/storage/news/")?e.replace("/storage/news/","/img/news/"):e.startsWith("/img/news/")?e:e.startsWith("/")&&!e.startsWith("/storage/")&&!e.startsWith("/img/")?`/img/news${e}`:e.startsWith("/")?e:`/img/news/${e}`},[]),s=S.useMemo(()=>{if(!Array.isArray(o)||o.length===0)return[];const t=o.filter(e=>e&&(typeof e=="string"||e instanceof File)).map(e=>y(e));return console.log("NewsSliderWithMain - обработка изображений:",{images:o,validImages:t,imagesLength:o.length,validLength:t.length}),t},[o,y]),f=l.useCallback(t=>{h(e=>{const n=new Set(e);return n.add(t),n.size>=s.length&&m(!1),n})},[s.length]),x=l.useCallback(t=>{v(e=>{const n=new Set(e);return n.add(t),n}),h(e=>{const n=new Set(e);return n.add(t),n.size>=s.length&&m(!1),n})},[s.length]);if(l.useEffect(()=>{h(new Set),v(new Set),m(!1),u(0)},[s]),l.useEffect(()=>{if(!j||s.length<=1||!i.has(0))return;const t=setInterval(()=>{u(e=>(e+1)%s.length)},w);return()=>clearInterval(t)},[s.length,j,w,i]),!Array.isArray(s)||s.length===0)return r.jsx("div",{className:`relative overflow-hidden rounded-lg bg-gray-200 flex items-center justify-center ${c}`,style:{height:d},children:r.jsxs("div",{className:"text-gray-400 text-center",children:[r.jsx("svg",{className:"w-12 h-12 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),r.jsx("p",{className:"text-sm",children:"Нет изображений"})]})});if(s.length===1)return r.jsxs("div",{className:`relative overflow-hidden rounded-lg ${c}`,style:{height:d},children:[g&&r.jsx("div",{className:"absolute inset-0 bg-gray-200 flex items-center justify-center z-10",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),r.jsx("img",{src:s[0],alt:"Изображение новости",className:`w-full h-full object-cover transition-opacity duration-300 ${i.has(0)?"opacity-100":"opacity-0"}`,onLoad:()=>f(0),onError:t=>{console.error("Ошибка загрузки изображения:",s[0]),x(0),t.target.onerror=null,t.target.src="/img/placeholder.jpg"}}),b&&!g&&r.jsx("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded",children:"1 / 1"}),p&&!g&&r.jsx("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1",children:r.jsx("div",{className:"w-2 h-2 bg-white rounded-full opacity-100"})})]});const L=t=>{u(t)};return r.jsxs("div",{className:`relative overflow-hidden rounded-lg ${c}`,style:{height:d},children:[r.jsxs("div",{className:"relative w-full h-full",children:[r.jsx("img",{src:s[a],alt:`Изображение ${a+1}`,className:`w-full h-full object-cover transition-opacity duration-500 ${i.has(a)?"opacity-100":"opacity-0"}`,onLoad:()=>f(a),onError:t=>{console.error("Ошибка загрузки изображения:",s[a]),x(a),t.target.onerror=null,t.target.src="/img/news/placeholder.jpg"}}),s.map((t,e)=>e!==a&&r.jsx("img",{src:t,alt:"",className:"hidden",onLoad:()=>f(e),onError:()=>x(e)},e)),N.has(a)&&r.jsx("div",{className:"absolute inset-0 bg-gray-100 flex items-center justify-center",children:r.jsxs("div",{className:"text-center text-gray-500",children:[r.jsx("svg",{className:"w-6 h-6 mx-auto mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.314 16.5c-.77.833.192 2.5 1.732 2.5z"})}),r.jsx("p",{className:"text-xs",children:"Ошибка"})]})})]}),b&&s.length>1&&r.jsxs("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded z-10",children:[a+1," / ",s.length]}),p&&s.length>1&&r.jsx("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1 z-10",children:s.map((t,e)=>r.jsx("button",{onClick:()=>L(e),className:`w-2 h-2 rounded-full transition-all duration-200 ${e===a?"bg-white opacity-100":"bg-white opacity-50 hover:opacity-75"}`,"aria-label":`Перейти к изображению ${e+1}`},e))})]})}export{I as N};

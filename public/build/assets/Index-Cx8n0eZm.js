import{r as n,b as i,j as s}from"./app-Dx0pQLKn.js";import{A as P}from"./AdminLayout-Dtb4iCn7.js";import{D as q,a as H}from"./clinicalFilters-BmX3Pc2t.js";import"./transition-Dabao_dA.js";import"./use-is-mounted-DzbNDF9D.js";function J(){const p="documents/ÐšÐ»Ð¸Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ñ€Ð¾Ñ‚Ð¾ÐºÐ¾Ð»Ñ‹",[h,E]=n.useState(p),[g,M]=n.useState([]),[c,O]=n.useState(null),[A,f]=n.useState(!1),[b,j]=n.useState(null),[r,y]=n.useState(null),[D,x]=n.useState({}),[F,m]=n.useState([]),[I,N]=n.useState([]),[v,C]=n.useState({}),[w,k]=n.useState(null),o=(e="")=>{f(!0),j(null),i.get("/admin/storage/list",{params:{path:e}}).then(t=>{M(t.data.items),E(t.data.current),O(t.data.parent);const a={};t.data.items.forEach(l=>{l.type==="file"&&(a[l.path]={medicineCategories:l.medicine_categories||[],mkbCodes:l.mkb_codes||[]})}),x(a)}).catch(t=>{var a,l;return j(((l=(a=t.response)==null?void 0:a.data)==null?void 0:l.error)||t.message)}).finally(()=>f(!1))};n.useEffect(()=>{o(p)},[]),n.useEffect(()=>{i.get("/api/clinical-protocols/filters").then(({data:e})=>{m(e.medicine_categories||[]),N(e.mkb_categories||[])}).catch(()=>{m(q),N(H)})},[]);const L=e=>{o(e)},T=()=>{c!==null&&c!=="."&&o(c===""?"":c)},U=e=>{window.confirm(`Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ${e.type==="folder"?"Ð¿Ð°Ð¿ÐºÑƒ":"Ñ„Ð°Ð¹Ð»"}: ${e.name}?`)&&i.delete("/admin/storage/delete",{params:{path:e.path}}).then(()=>o(h)).catch(t=>{var a,l;return alert("ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ: "+(((l=(a=t.response)==null?void 0:a.data)==null?void 0:l.error)||t.message))})},$=e=>{const t=e.target.files[0];if(!t)return;const a=new FormData;a.append("file",t),a.append("path",h),i.post("/admin/storage/upload",a).then(()=>o(h)).catch(l=>{var d,_;return alert("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸: "+(((_=(d=l.response)==null?void 0:d.data)==null?void 0:_.error)||l.message))})},z=e=>{e.type==="file"&&y({type:e.name.match(/\.(jpg|jpeg|png|gif|webp)$/i)?"image":e.name.match(/\.pdf$/i)?"pdf":"other",url:e.url,name:e.name})},u=e=>D[e]||{medicineCategories:[],mkbCodes:[]},S=(e,t)=>{x(a=>{var l;return{...a,[e]:{medicineCategories:t,mkbCodes:((l=a[e])==null?void 0:l.mkbCodes)||[]}}})},B=e=>{const t=(v[e]||"").trim();if(!t)return;m(l=>l.includes(t)?l:[...l,t]);const a=u(e).medicineCategories;S(e,Array.from(new Set([...a,t]))),C(l=>({...l,[e]:""}))},G=(e,t)=>{x(a=>{var l;return{...a,[e]:{medicineCategories:((l=a[e])==null?void 0:l.medicineCategories)||[],mkbCodes:t}}})},K=e=>{const t=u(e);k(e),i.post("/admin/storage/metadata",{path:e,medicine_categories:t.medicineCategories,mkb_codes:t.mkbCodes}).then(({data:a})=>{x(l=>({...l,[e]:{medicineCategories:a.medicine_categories||[],mkbCodes:a.mkb_codes||[]}})),a.available_categories&&m(a.available_categories)}).catch(a=>{var l,d;return alert("ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ñ…: "+(((d=(l=a.response)==null?void 0:l.data)==null?void 0:d.error)||a.message))}).finally(()=>k(null))},R=()=>y(null);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mb-6 flex items-center justify-between",children:s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Ð¤Ð°Ð¹Ð»Ð¾Ð²Ñ‹Ð¹ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€: public/storage"})}),s.jsxs("div",{className:"mb-4 flex items-center space-x-2",children:[s.jsx("button",{className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300",onClick:T,disabled:!c||c===".",children:"â¬†ï¸ Ð’Ð²ÐµÑ€Ñ…"}),s.jsxs("span",{className:"text-gray-500",children:["/",h]}),s.jsxs("label",{className:"ml-auto px-3 py-1 bg-blue-600 text-white rounded cursor-pointer hover:bg-blue-700",children:["+ Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»",s.jsx("input",{type:"file",className:"hidden",onChange:$})]})]}),r&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded shadow-lg p-6 max-w-2xl w-full relative",children:[s.jsx("button",{onClick:R,className:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-2xl",children:"Ã—"}),s.jsxs("div",{className:"mb-2 font-semibold",children:["ÐŸÑ€ÐµÐ´Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€: ",r.name]}),r.type==="image"&&s.jsx("img",{src:r.url,alt:r.name,className:"max-w-full max-h-[70vh] mx-auto"}),r.type==="pdf"&&s.jsx("iframe",{src:r.url,title:r.name,className:"w-full h-[70vh]"}),r.type==="other"&&s.jsx("div",{className:"text-gray-500",children:"ÐÐµÑ‚ Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ Ñ‚Ð¸Ð¿Ð° Ñ„Ð°Ð¹Ð»Ð°."})]})}),b&&s.jsxs("div",{className:"text-red-500 mb-4",children:["ÐžÑˆÐ¸Ð±ÐºÐ°: ",b]}),A?s.jsx("div",{children:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°..."}):s.jsx("div",{className:"bg-white shadow rounded p-4",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b",children:[s.jsx("th",{className:"text-left py-2",children:"Ð˜Ð¼Ñ"}),s.jsx("th",{className:"text-left py-2",children:"ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ (Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½Ð°)"}),s.jsx("th",{className:"text-left py-2",children:"ÐœÐšÐ‘-10"}),s.jsx("th",{className:"text-left py-2",children:"Ð¢Ð¸Ð¿"}),s.jsx("th",{className:"text-left py-2",children:"Ð Ð°Ð·Ð¼ÐµÑ€"}),s.jsx("th",{className:"text-left py-2",children:"Ð˜Ð·Ð¼ÐµÐ½Ñ‘Ð½"}),s.jsx("th",{className:"text-left py-2",children:"Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ"})]})}),s.jsxs("tbody",{children:[g.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"text-center text-gray-400 py-8",children:"ÐŸÐ°Ð¿ÐºÐ° Ð¿ÑƒÑÑ‚Ð°"})}),g.map(e=>s.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[s.jsx("td",{className:"py-2",children:e.type==="folder"?s.jsxs("button",{className:"text-blue-600 hover:underline",onClick:()=>L(e.path),children:["ðŸ“ ",e.name]}):s.jsxs("span",{className:"cursor-pointer",onClick:()=>z(e),children:["ðŸ“„ ",e.name]})}),s.jsx("td",{className:"py-2 align-top",children:e.type==="file"?s.jsxs("div",{className:"space-y-2",children:[s.jsx("select",{multiple:!0,className:"w-full border rounded p-1 text-xs min-h-[80px]",value:u(e.path).medicineCategories,onChange:t=>S(e.path,Array.from(t.target.selectedOptions).map(a=>a.value)),children:F.map(t=>s.jsx("option",{value:t,children:t},t))}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",className:"flex-1 border rounded px-2 py-1 text-xs",placeholder:"ÐÐ¾Ð²Ð°Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ",value:v[e.path]||"",onChange:t=>C(a=>({...a,[e.path]:t.target.value}))}),s.jsx("button",{type:"button",className:"px-2 py-1 bg-blue-500 text-white text-xs rounded",onClick:()=>B(e.path),children:"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ"})]})]}):"â€”"}),s.jsx("td",{className:"py-2 align-top",children:e.type==="file"?s.jsx("select",{multiple:!0,className:"w-full border rounded p-1 text-xs min-h-[80px]",value:u(e.path).mkbCodes,onChange:t=>G(e.path,Array.from(t.target.selectedOptions).map(a=>a.value)),children:I.map(t=>s.jsx("option",{value:t.code,children:t.label},t.code))}):"â€”"}),s.jsx("td",{className:"py-2",children:e.type==="folder"?"ÐŸÐ°Ð¿ÐºÐ°":"Ð¤Ð°Ð¹Ð»"}),s.jsx("td",{className:"py-2",children:e.type==="file"?(e.size/1024).toFixed(1)+" KB":""}),s.jsx("td",{className:"py-2",children:e.type==="file"?new Date(e.modified*1e3).toLocaleString():""}),s.jsxs("td",{className:"py-2 space-x-2",children:[e.type==="file"&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>K(e.path),className:"text-blue-600 hover:underline mr-2",disabled:w===e.path,children:w===e.path?"Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµâ€¦":"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ"}),s.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:underline mr-2",children:"Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ"})]}),s.jsx("button",{onClick:()=>U(e),className:"text-red-600 hover:underline",children:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"})]})]},e.path))]})]})})]})}J.layout=p=>s.jsx(P,{title:"Ð¤Ð°Ð¹Ð»Ð¾Ð²Ñ‹Ð¹ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€: public/storage",children:p});export{J as default};

import{r as u,j as e,W as C,Y as S}from"./app-s9vilKbc.js";import{A}from"./AdminLayout-IWDzujdd.js";import{N as M}from"./NewsSliderWithMain-4-k9oyLU.js";import"./transition-Csp-WBJt.js";import"./use-is-mounted-rkOK5dvU.js";function W({onSelect:l,onClose:h,multiple:n=!1}){const[x,a]=u.useState([]),[g,b]=u.useState(!0),[m,j]=u.useState(null),[o,c]=u.useState([]),[f,w]=u.useState("");u.useEffect(()=>{v()},[]);const v=async()=>{try{b(!0);const t=await fetch("/admin/images/news");if(!t.ok)throw new Error(`Ошибка HTTP: ${t.status}`);const r=await t.json();a(r),j(null)}catch(t){console.error("Ошибка при загрузке изображений:",t),j("Не удалось загрузить изображения. Пожалуйста, попробуйте позже.")}finally{b(!1)}},y=t=>{n?o.some(r=>r.url===t.url)?c(o.filter(r=>r.url!==t.url)):c([...o,t]):c([t])},p=()=>{o.length>0&&l(n?o:o[0]),h()},s=f?x.filter(t=>t.name.toLowerCase().includes(f.toLowerCase())):x;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Библиотека изображений"}),e.jsx("button",{onClick:h,className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("input",{type:"text",placeholder:"Поиск изображений...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:f,onChange:t=>w(t.target.value)})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:g?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):m?e.jsx("div",{className:"text-center text-red-500 p-4",children:m}):s.length===0?e.jsx("div",{className:"text-center text-gray-500 p-4",children:f?"Изображения не найдены":"Нет доступных изображений"}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:s.map((t,r)=>e.jsxs("div",{className:`relative border rounded-lg overflow-hidden cursor-pointer transition-all duration-200 ${o.some(i=>i.url===t.url)?"ring-2 ring-blue-500 shadow-lg":"hover:shadow-md"}`,onClick:()=>y(t),children:[e.jsx("img",{src:t.url,alt:t.name,className:"w-full h-32 object-cover"}),o.some(i=>i.url===t.url)&&e.jsx("div",{className:"absolute top-2 right-2 bg-blue-500 rounded-full p-1",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("div",{className:"p-2 bg-white text-xs truncate",children:t.name})]},r))})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex justify-between",children:[e.jsx("div",{className:"text-sm text-gray-500",children:o.length>0?`Выбрано: ${o.length}`:"Выберите изображения"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100",children:"Отмена"}),e.jsx("button",{onClick:p,disabled:o.length===0,className:`px-4 py-2 rounded-lg ${o.length>0?"bg-blue-500 hover:bg-blue-600 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Выбрать"})]})]})]})})}function B({images:l,setImages:h,mainImage:n,setMainImage:x,max:a=18}){const g=u.useRef(),[b,m]=u.useState(!1);u.useEffect(()=>{l&&h(l)},[l]),u.useEffect(()=>{n&&x(n)},[n]);const j=s=>{s.preventDefault();const t=Array.from(s.dataTransfer.files).filter(r=>r.type.startsWith("image/"));t.length&&c(t)},o=s=>{const t=Array.from(s.target.files).filter(r=>r.type.startsWith("image/"));t.length&&c(t)},c=s=>{const t=Array.isArray(l)?l:[],r=s.slice(0,a-t.length),i=[...t,...r];h(i),!n&&r.length>0&&x(r[0])},f=s=>{const t=Array.isArray(l)?l:[],r=t.filter((i,d)=>d!==s);h(r),n===t[s]&&x(r[0]||null)},w=s=>{x(s)},v=()=>{m(!0)},y=s=>{const t=Array.isArray(s)?s:[s],r=Array.isArray(l)?l:[],d=t.filter(N=>!r.some(k=>typeof k=="string"&&k===N.url)).map(N=>N.url),L=[...r,...d];h(L),!n&&d.length>0&&x(d[0])},p=Array.isArray(l)?l:[];return console.log("ImageGalleryUpload - текущее состояние:",{images:l,currentImages:p,mainImage:n,currentImagesLength:p.length}),e.jsxs("div",{children:[b&&e.jsx(W,{onSelect:y,onClose:()=>m(!1),multiple:!0}),e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Изображения"}),e.jsxs("button",{type:"button",onClick:v,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Выбрать из библиотеки"]})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 bg-gray-50 hover:bg-gray-100 transition cursor-pointer mb-4",onDrop:j,onDragOver:s=>s.preventDefault(),onClick:()=>g.current.click(),style:{minHeight:"120px"},children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("svg",{className:"h-10 w-10 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 48 48",children:e.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsxs("span",{className:"text-blue-600 font-medium cursor-pointer",children:["Перетащите или выберите до ",a," изображений"]}),e.jsx("span",{className:"text-xs text-gray-400",children:"PNG, JPG, GIF, WEBP"})]}),e.jsx("input",{ref:g,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:o})]}),p.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Предварительный просмотр слайдера:"}),e.jsx("div",{className:"h-48 rounded-lg overflow-hidden",children:e.jsx(M,{images:p,mainImage:n,className:"h-48",height:"192px",showDots:!0,showCounter:!0,autoPlay:!0,interval:3e3})})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:p.map((s,t)=>{console.log("Обработка изображения:",{img:s,type:typeof s,isString:typeof s=="string",isFile:s instanceof File,name:s==null?void 0:s.name,url:typeof s=="string"?s:null});const r=typeof s=="string"?s:URL.createObjectURL(s),i=n===s;return console.log("Созданный URL:",r),e.jsxs("div",{className:`relative group border rounded-lg overflow-hidden shadow bg-white ${i?"ring-2 ring-blue-500":""}`,children:[e.jsx("img",{src:r,alt:typeof s=="string"?"Загруженное":s.name,className:"w-full h-32 object-cover",onError:d=>{console.error("Ошибка загрузки изображения:",r),d.target.onerror=null,d.target.src="/img/placeholder.jpg"},onLoad:()=>{console.log("Изображение успешно загружено:",r)}}),e.jsx("button",{type:"button",className:"absolute top-1 right-1 bg-white bg-opacity-80 rounded-full p-1 shadow hover:bg-red-100 transition",title:"Удалить изображение",onClick:d=>{d.stopPropagation(),f(t)},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("button",{type:"button",className:`absolute bottom-1 left-1 bg-white bg-opacity-90 rounded-full p-1.5 shadow hover:bg-blue-100 transition ${i?"bg-blue-500 text-white":"hover:bg-blue-50"}`,title:i?"Главное изображение":"Сделать главным",onClick:d=>{d.stopPropagation(),w(s)},children:i?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),i&&e.jsx("div",{className:"absolute top-1 left-1 bg-blue-500 text-white text-xs px-2 py-1 rounded-full",children:"Главное"}),e.jsx("div",{className:"absolute bottom-1 right-1 bg-black bg-opacity-50 text-white text-xs px-1.5 py-0.5 rounded",children:t+1}),e.jsx("div",{className:"absolute top-1 left-1 bg-black bg-opacity-75 text-white text-xs px-1 py-0.5 rounded",children:typeof s=="string"?"URL":"File"})]},t)})}),n&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-500 mr-2",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-blue-700",children:"Главное изображение выбрано. Оно будет отображаться первым в слайдере."})]})})]})}function E(){const[l,h]=u.useState([]),[n,x]=u.useState(null),{data:a,setData:g,post:b,processing:m,errors:j}=C({title:"",content:"",images:[],main_image:null}),o=c=>{c.preventDefault(),console.log("Отправляем данные:",{title:a.title,content:a.content,images:a.images,main_image:a.main_image}),b("/admin/news/test-upload")};return e.jsxs(e.Fragment,{children:[e.jsx(S,{title:"Тест загрузки изображений"}),e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Тест загрузки изображений"}),e.jsxs("form",{onSubmit:o,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Заголовок"}),e.jsx("input",{type:"text",value:a.title,onChange:c=>g("title",c.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"Введите заголовок"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Содержимое"}),e.jsx("textarea",{value:a.content,onChange:c=>g("content",c.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 h-32",placeholder:"Введите содержимое"})]}),e.jsx("div",{children:e.jsx(B,{images:l,setImages:h,mainImage:n,setMainImage:x,max:5})}),e.jsxs("div",{className:"bg-gray-100 p-4 rounded",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Отладочная информация:"}),e.jsx("pre",{className:"text-sm",children:JSON.stringify({images:l,mainImage:n,data_images:a.images,data_main_image:a.main_image},null,2)})]}),e.jsx("button",{type:"submit",disabled:m,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:bg-gray-400",children:m?"Отправка...":"Отправить тест"})]})]})]})}E.layout=l=>e.jsx(A,{title:"Тест загрузки изображений",children:l});export{E as default};

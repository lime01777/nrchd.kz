import{r as o,R as S,j as t,a as W}from"./app-UG9l2vBo.js";import{S as k}from"./SafeImage-B7SW2FCv.js";import{i as E}from"./mediaUtils-oRnee45q.js";import{t as z}from"./TranslationService-BIPkk7bE.js";function $({images:i=[],className:c="",height:d="160px",showDots:m=!0,showCounter:h=!1,autoPlay:x=!0,interval:g=3e3}){const[l,u]=o.useState(0),[a,f]=o.useState(new Set),[I,v]=o.useState(new Set),[p,w]=o.useState(!0),y="news-slider:go-to",N=o.useCallback(s=>{if(!s||typeof s!="string")return s;const e=s.trim();return e.startsWith("http")||e.startsWith("/storage/")||e.startsWith("/img/news/")?e:e.startsWith("/")&&!e.startsWith("/storage/")&&!e.startsWith("/img/")?`/img/news${e}`:e.startsWith("/")?e:`/img/news/${e}`},[]),r=S.useMemo(()=>!Array.isArray(i)||i.length===0?[]:i.filter(e=>e?typeof e=="string"?e.trim()!==""&&(e.startsWith("http")||e.startsWith("blob:")||e.startsWith("/")):e instanceof File?e.size>0&&e.type.startsWith("image/"):!1:!1).map(e=>N(e)).filter(e=>e&&e.trim()!==""),[i,N]),b=o.useCallback(s=>{f(e=>{const n=new Set(e);return n.add(s),n.size>=r.length&&w(!1),n})},[r.length]),j=o.useCallback(s=>{console.warn("Ошибка загрузки изображения:",r[s]),v(e=>{const n=new Set(e);return n.add(s),n}),f(e=>{const n=new Set(e);return n.add(s),n.size>=r.length&&w(!1),n})},[r.length]);if(o.useEffect(()=>{f(new Set),v(new Set),w(!1),u(0)},[r]),o.useEffect(()=>{if(!x||r.length<=1||!a.has(0))return;const s=setInterval(()=>{u(e=>(e+1)%r.length)},g);return()=>clearInterval(s)},[r.length,x,g,a]),o.useEffect(()=>{const s=e=>{const n=Number(e.detail);!Number.isNaN(n)&&n>=0&&n<r.length&&u(n)};return window.addEventListener(y,s),()=>{window.removeEventListener(y,s)}},[r.length]),!Array.isArray(r)||r.length===0)return t.jsx("div",{className:`relative overflow-hidden rounded-lg bg-gray-200 flex items-center justify-center ${c}`,style:{height:d},children:t.jsxs("div",{className:"text-gray-400 text-center",children:[t.jsx("svg",{className:"w-12 h-12 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),t.jsx("p",{className:"text-sm",children:"Нет изображений"})]})});if(r.length===1)return t.jsxs("div",{className:`relative overflow-hidden rounded-lg ${c}`,style:{height:d},children:[p&&t.jsx("div",{className:"absolute inset-0 bg-gray-200 flex items-center justify-center z-10",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),t.jsx(k,{src:r[0],alt:"Изображение новости",className:`w-full h-full object-cover transition-opacity duration-300 ${a.has(0)?"opacity-100":"opacity-0"}`,fallbackSrc:"/img/placeholder.jpg",onLoad:()=>b(0),onError:()=>j(0)}),h&&!p&&t.jsx("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded",children:"1 / 1"}),m&&!p&&t.jsx("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1",children:t.jsx("div",{className:"w-2 h-2 bg-white rounded-full opacity-100"})})]});const L=s=>{u(s)};return t.jsxs("div",{className:`relative overflow-hidden rounded-lg ${c}`,style:{height:d},children:[t.jsxs("div",{className:"relative w-full h-full",children:[t.jsx(k,{src:r[l],alt:`Изображение ${l+1}`,className:`w-full h-full object-cover transition-opacity duration-500 ${a.has(l)?"opacity-100":"opacity-0"}`,fallbackSrc:"/img/news/placeholder.jpg",onLoad:()=>b(l),onError:()=>j(l)}),r.map((s,e)=>e!==l&&t.jsx("img",{src:s,alt:"",className:"hidden",onLoad:()=>b(e),onError:()=>j(e)},e)),I.has(l)&&t.jsx("div",{className:"absolute inset-0 bg-gray-100 flex items-center justify-center",children:t.jsxs("div",{className:"text-center text-gray-500",children:[t.jsx("svg",{className:"w-6 h-6 mx-auto mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.314 16.5c-.77.833.192 2.5 1.732 2.5z"})}),t.jsx("p",{className:"text-xs",children:"Ошибка"})]})})]}),h&&r.length>1&&t.jsxs("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded z-10",children:[l+1," / ",r.length]}),m&&r.length>1&&t.jsx("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1 z-10",children:r.map((s,e)=>t.jsx("button",{onClick:()=>L(e),className:`w-2 h-2 rounded-full transition-all duration-200 ${e===l?"bg-white opacity-100":"bg-white opacity-50 hover:opacity-75"}`,"aria-label":`Перейти к изображению ${e+1}`},e))})]})}function R({date:i,description:c,slug:d,image:m,images:h=[]}){const x=(a,f="")=>z.t(a,f),u=(h&&h.length>0?h:m?[m]:[]).map(a=>a?typeof a=="string"?a:typeof a=="object"&&(a.url||a.path)||null:null).filter(Boolean).filter(a=>!E(a));return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 h-full",children:[t.jsx("div",{className:"h-40 overflow-hidden rounded-t-lg",children:t.jsx($,{images:u,className:"h-40",height:"160px",showDots:!0,showCounter:!1,autoPlay:!0,interval:3e3})}),t.jsx("div",{className:"flex flex-col p-6 h-full",children:t.jsxs("div",{className:"flex-grow",children:[t.jsx("p",{className:"text-gray-500 text-sm mb-2",children:i}),t.jsx("h2",{className:"text-gray-900 text-lg font-medium mb-4 line-clamp-3 h-[4.5rem]",title:c,children:c}),d?t.jsxs(W,{href:route("news.show",d),className:"mt-auto text-black inline-flex items-center border-gray-300 border rounded-lg px-4 py-2 text-sm hover:bg-gray-50 transition-colors duration-200",children:[x("common.readNews"),t.jsx("svg",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"w-4 h-4 ml-2",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})]}):t.jsxs("a",{className:"mt-auto text-black inline-flex items-center border-gray-300 border rounded-lg px-4 py-2 text-sm hover:bg-gray-50 transition-colors duration-200",children:["Читать новость",t.jsx("svg",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"w-4 h-4 ml-2",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})]})]})})]})}export{R as N};

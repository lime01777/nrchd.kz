import{r as n,j as e,Y as A}from"./app-BD1vUruF.js";import{A as z}from"./AuthenticatedLayout-COT2oLSy.js";import"./ApplicationLogo-NQ0VieUy.js";import"./transition-B1mQ05IJ.js";class C{constructor(){this.API_KEY=null,this.CLIENT_ID=null,this.SCOPES="https://www.googleapis.com/auth/drive.readonly",this.isInitialized=!1,this.isLoading=!1}init(s,l){return this.API_KEY=s,this.CLIENT_ID=l,!this.isLoading&&!this.isInitialized?(this.isLoading=!0,this.loadGoogleDriveAPI()):Promise.resolve()}loadGoogleDriveAPI(){return new Promise((s,l)=>{if(typeof gapi<"u"){this.initClient().then(s).catch(l);return}const t=document.createElement("script");t.src="https://apis.google.com/js/api.js",t.async=!0,t.defer=!0,t.onload=()=>{gapi.load("client:auth2",()=>{this.initClient().then(s).catch(l)})},t.onerror=d=>{l(new Error("Failed to load Google API script"))},document.body.appendChild(t)})}initClient(){return gapi.client.init({apiKey:this.API_KEY,clientId:this.CLIENT_ID,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],scope:this.SCOPES}).then(()=>{this.isInitialized=!0,this.isLoading=!1}).catch(s=>{throw this.isLoading=!1,console.error("Error initializing Google Drive API client",s),s})}checkAuth(){if(!this.isInitialized)return Promise.reject(new Error("Google Drive API not initialized"));const s=gapi.auth2.getAuthInstance();return s.isSignedIn.get()?Promise.resolve():s.signIn()}listFiles(s,l=100){return this.isInitialized?this.checkAuth().then(()=>gapi.client.drive.files.list({q:`'${s}' in parents and trashed = false`,pageSize:l,fields:"files(id, name, mimeType, size, modifiedTime, webViewLink, webContentLink)"})).then(t=>t.result.files):Promise.reject(new Error("Google Drive API not initialized"))}getFileMetadata(s){return this.isInitialized?this.checkAuth().then(()=>gapi.client.drive.files.get({fileId:s,fields:"id, name, mimeType, size, modifiedTime, webViewLink, webContentLink"})).then(l=>l.result):Promise.reject(new Error("Google Drive API not initialized"))}getFileViewUrl(s){return`https://drive.google.com/file/d/${s}/view`}getFileDownloadUrl(s){return`https://drive.google.com/uc?export=download&id=${s}`}}const p=new C;function b({folderId:a,title:s,className:l="",apiKey:t,clientId:d}){const[c,m]=n.useState([]),[h,o]=n.useState(!0),[u,r]=n.useState(null),[x,f]=n.useState(!1),j=i=>i.includes("pdf")?e.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z",clipRule:"evenodd"})}):i.includes("spreadsheet")?e.jsx("svg",{className:"w-5 h-5 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fillRule:"evenodd",d:"M5 4a3 3 0 00-3 3v6a3 3 0 003 3h10a3 3 0 003-3V7a3 3 0 00-3-3H5zm-1 9v-1h5v2H5a1 1 0 01-1-1zm7 1h4a1 1 0 001-1v-1h-5v2zm0-4h5V8h-5v2zM9 8H4v2h5V8z",clipRule:"evenodd"})}):i.includes("document")?e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})}):i.includes("presentation")?e.jsx("svg",{className:"w-5 h-5 text-yellow-500",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fillRule:"evenodd",d:"M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11 4a1 1 0 10-2 0v4a1 1 0 102 0V7zm-3 1a1 1 0 10-2 0v3a1 1 0 102 0V8zM8 9a1 1 0 00-2 0v2a1 1 0 102 0V9z",clipRule:"evenodd"})}):e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z",clipRule:"evenodd"})}),y=i=>{if(!i)return"0 Bytes";const g=parseInt(i,10);if(g===0)return"0 Bytes";const v=1024,D=["Bytes","KB","MB","GB"],w=Math.floor(Math.log(g)/Math.log(v));return parseFloat((g/Math.pow(v,w)).toFixed(2))+" "+D[w]},N=i=>new Date(i).toLocaleDateString("ru-RU");n.useEffect(()=>{if(!t||!d){f(!1),o(!1);return}p.init(t,d).then(()=>{f(!0)}).catch(i=>{console.error("Failed to initialize Google Drive API:",i),r("Не удалось инициализировать Google Drive API"),o(!1)})},[t,d]),n.useEffect(()=>{if(!x||!a){const i=[{id:"1",name:"МР по оформлению и утверждению НИР",mimeType:"application/pdf",size:"1.4 MB",modifiedTime:"2024-03-27T10:30:00.000Z",webViewLink:"#"},{id:"2",name:"О проведении НМЭ",mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",size:"4.7 MB",modifiedTime:"2024-03-27T11:45:00.000Z",webViewLink:"#"},{id:"3",name:"Приказ о научно-медицинской экспертизе",mimeType:"application/pdf",size:"2.3 MB",modifiedTime:"2024-03-27T09:15:00.000Z",webViewLink:"#"},{id:"4",name:"Приказ о рабочем органе",mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",size:"5.4 MB",modifiedTime:"2024-03-27T14:20:00.000Z",webViewLink:"#"}];setTimeout(()=>{m(i),o(!1)},1e3);return}o(!0),p.listFiles(a).then(i=>{m(i),o(!1)}).catch(i=>{console.error("Failed to load files from Google Drive:",i),r("Не удалось загрузить файлы из Google Drive"),o(!1)})},[a,x]);const I=i=>{x?window.open(i.webViewLink||p.getFileViewUrl(i.id),"_blank"):console.log(`Открываем документ с ID: ${i.id}`)};return e.jsxs("div",{className:`w-full ${l}`,children:[s&&e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:s}),e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 15l7-7 7 7"})})})]}),h?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsxs("svg",{className:"animate-spin h-8 w-8 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}):u?e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:e.jsxs("p",{children:["Ошибка при загрузке документов: ",u]})}):e.jsx("div",{className:"bg-blue-50 rounded-lg p-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map(i=>e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:i.name}),e.jsxs("div",{className:"flex items-center mt-4",children:[e.jsxs("div",{className:"flex items-center",children:[j(i.mimeType),e.jsxs("span",{className:"text-xs ml-1 mr-2",children:[i.mimeType.includes("pdf")?"PDF":i.mimeType.includes("word")||i.mimeType.includes("document")?"DOC":"Файл",",",typeof i.size=="string"?i.size:y(i.size)]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:N(i.modifiedTime)})]}),e.jsx("button",{onClick:()=>I(i),className:"mt-2 text-gray-700 border border-gray-300 px-3 py-1 rounded text-sm hover:bg-gray-100 transition-colors",children:"Открыть"})]},i.id))})})]})}function V({auth:a}){const[s,l]=n.useState(""),[t,d]=n.useState(""),[c,m]=n.useState(""),[h,o]=n.useState(!1),u=r=>{r.preventDefault(),o(!0)};return e.jsxs(z,{user:a.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Пример интеграции с Google Drive"}),children:[e.jsx(A,{title:"Google Drive Example",meta:[{name:"description",content:"Пример интеграции Google Drive для документов."}]}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6 text-gray-900",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Интеграция с Google Drive"}),h?e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Настройки подключения"}),e.jsx("button",{onClick:()=>o(!1),className:"text-sm text-indigo-600 hover:text-indigo-800",children:"Изменить настройки"})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md mb-6",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"API Key:"})," ",s.substring(0,6),"...",s.substring(s.length-4)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Client ID:"})," ",t.substring(0,6),"...",t.substring(t.length-10)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Folder ID:"})," ",c]})]})]}):e.jsxs("div",{className:"mb-8",children:[e.jsx("p",{className:"mb-4",children:"Для работы с Google Drive API необходимо настроить ключи API. Следуйте инструкциям ниже:"}),e.jsxs("ol",{className:"list-decimal list-inside mb-6",children:[e.jsxs("li",{className:"mb-2",children:["Перейдите в ",e.jsx("a",{href:"https://console.cloud.google.com/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Google Cloud Console"})]}),e.jsx("li",{className:"mb-2",children:"Создайте новый проект или выберите существующий"}),e.jsx("li",{className:"mb-2",children:'Перейдите в раздел "API и сервисы" и активируйте Google Drive API'}),e.jsx("li",{className:"mb-2",children:"Создайте учетные данные (API Key и OAuth 2.0 Client ID)"}),e.jsx("li",{className:"mb-2",children:"Укажите разрешенные домены для редиректа (включая ваш домен)"}),e.jsx("li",{className:"mb-2",children:"Скопируйте API Key и Client ID в форму ниже"})]}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"apiKey",className:"block text-sm font-medium text-gray-700",children:"API Key"}),e.jsx("input",{type:"text",id:"apiKey",value:s,onChange:r=>l(r.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"AIzaSyA...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"clientId",className:"block text-sm font-medium text-gray-700",children:"Client ID"}),e.jsx("input",{type:"text",id:"clientId",value:t,onChange:r=>d(r.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"123456789-abcdefg.apps.googleusercontent.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"folderId",className:"block text-sm font-medium text-gray-700",children:"ID папки Google Drive"}),e.jsx("input",{type:"text",id:"folderId",value:c,onChange:r=>m(r.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"1a2b3c4d5e6f7g8h9i",required:!0}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:'ID папки можно найти в URL после "folders/" при открытии папки в Google Drive'})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Применить настройки"})})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Пример компонента с моковыми данными"}),e.jsx("p",{className:"mb-4",children:"Ниже представлен пример компонента с моковыми данными (без реального подключения к Google Drive):"}),e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsx(b,{title:"Документы из Google Drive (Моковые данные)",folderId:"mock_folder_id"})})]}),h&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Пример компонента с реальными данными"}),e.jsx("p",{className:"mb-4",children:"Ниже представлен пример компонента с реальным подключением к Google Drive:"}),e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsx(b,{title:"Документы из Google Drive",folderId:c,apiKey:s,clientId:t})})]}),e.jsxs("div",{className:"mt-8 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"Важное примечание"}),e.jsx("p",{className:"text-yellow-700",children:"В реальном приложении не рекомендуется хранить API ключи на клиентской стороне. Лучшей практикой является создание серверного API-прокси, который будет взаимодействовать с Google Drive API. Это позволит защитить ваши ключи API и обеспечить более безопасное взаимодействие с Google Drive."})]})]})})})})]})}export{V as default};

import{r as d,W as P,j as e,a as v}from"./app-CJ21qSIO.js";import{A as T}from"./AdminLayout-C29-nbXz.js";import{M as $}from"./MediaManager-Dy9huwpQ.js";import{M as B}from"./MediaSlider-5rYLU3NV.js";import"./transition-B1RxGcjJ.js";import"./use-is-mounted-CRNQNW5H.js";import"./SafeImage-Cg2XRqNt.js";import"./SafeVideo-CDsygpPf.js";const p=["Общие","Аккредитация","Обучение","Конференции","Методические материалы","Исследования","Анонсы"];function q(){const[j,m]=d.useState(!1),[y,x]=d.useState(!1),{data:s,setData:i,post:N,processing:b,errors:n}=P({title:"",content:"",category:[],status:"Черновик",publish_date:new Date().toISOString().substr(0,10),media:[],media_files:[]}),[u,h]=d.useState([]),w=(t,r)=>{let l;r?l=[...u,t]:l=u.filter(a=>a!==t),h(l),i("category",l)},k=()=>{h(p),i("category",p)},M=()=>{h([]),i("category",[])},_=t=>{if((s.media?s.media.length:0)+(s.media_files?s.media_files.length:0)+t.length>15){alert(`Максимальное количество медиа-файлов: 15. У вас уже ${s.media?s.media.length:0} файлов из библиотеки и ${s.media_files?s.media_files.length:0} загруженных файлов.`);return}const l=t.map(a=>({path:a.path,type:a.type||(a.path.includes(".mp4")||a.path.includes(".avi")||a.path.includes(".mov")?"video":"image"),name:a.name||a.path.split("/").pop(),source:"library"}));i("media",[...s.media||[],...l])},C=t=>{const r=Array.from(t.target.files);f(r)},g=d.useCallback(t=>{t.preventDefault(),t.stopPropagation(),t.type==="dragenter"||t.type==="dragover"?x(!0):t.type==="dragleave"&&x(!1)},[]),L=d.useCallback(t=>{if(t.preventDefault(),t.stopPropagation(),x(!1),t.dataTransfer.files&&t.dataTransfer.files[0]){const r=Array.from(t.dataTransfer.files);f(r)}},[]),f=t=>{if((s.media?s.media.length:0)+(s.media_files?s.media_files.length:0)+t.length>15){alert(`Максимальное количество медиа-файлов: 15. У вас уже ${s.media?s.media.length:0} файлов из библиотеки и ${s.media_files?s.media_files.length:0} загруженных файлов.`);return}const l=t.filter(a=>{const F=["image/jpeg","image/png","image/gif","image/webp"],W=["video/mp4","video/avi","video/mov","video/wmv","video/flv","video/webm"];return a.size>52428800?(alert(`Файл ${a.name} превышает лимит 50MB`),!1):!F.includes(a.type)&&!W.includes(a.type)?(alert(`Файл ${a.name} имеет неподдерживаемый тип`),!1):!0});l.length>0&&i("media_files",[...s.media_files||[],...l])},S=(t,r)=>{if(r==="library"){const l=s.media.filter((a,c)=>c!==t);i("media",l)}else{const l=s.media_files.filter((a,c)=>c!==t);i("media_files",l)}},D=()=>{const t=s.media||[],r=(s.media_files||[]).map((l,a)=>({path:URL.createObjectURL(l),type:l.type.startsWith("video/")?"video":"image",name:l.name,source:"file",fileIndex:a}));return[...t,...r]},A=t=>{if(t.preventDefault(),!s.title.trim()){alert("Заполните заголовок");return}if(!s.content.trim()||s.content.replace(/<[^>]*?>/g,"").trim().length<10){alert("Содержимое должно содержать минимум 10 символов");return}if(s.category.length===0){alert("Выберите хотя бы одну категорию");return}console.log("Отправка данных:",{title:s.title,content_length:s.content.length,categories:s.category,media_count:s.media.length,files_count:s.media_files.length,status:s.status}),N(route("admin.news.store"))},o=D();return e.jsxs(T,{children:[e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Создание новости"}),e.jsxs(v,{href:route("admin.news"),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Назад к списку"]})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:e.jsx("form",{onSubmit:A,className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Заголовок *"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"text",name:"title",id:"title",value:s.title,onChange:t=>i("title",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0,placeholder:"Введите заголовок новости"})}),n.title&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.title})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Категории *"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{type:"button",onClick:k,className:"px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200",children:"Выбрать все"}),e.jsx("button",{type:"button",onClick:M,className:"px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200",children:"Снять выбор"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:p.map(t=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:u.includes(t),onChange:r=>w(t,r.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:t})]},t))}),n.category&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.category})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700",children:"Содержимое *"}),e.jsx("div",{className:"mt-1",children:e.jsx("textarea",{name:"content",id:"content",rows:10,value:s.content,onChange:t=>i("content",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0,placeholder:"Введите содержимое новости"})}),n.content&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.content})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Статус"}),e.jsx("div",{className:"mt-1",children:e.jsxs("select",{name:"status",id:"status",value:s.status,onChange:t=>i("status",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",children:[e.jsx("option",{value:"Черновик",children:"Черновик"}),e.jsx("option",{value:"Опубликовано",children:"Опубликовано"}),e.jsx("option",{value:"Запланировано",children:"Запланировано"})]})})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"publish_date",className:"block text-sm font-medium text-gray-700",children:"Дата публикации"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"date",name:"publish_date",id:"publish_date",value:s.publish_date,onChange:t=>i("publish_date",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md"})})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Медиа-файлы (до 15 файлов)",e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:[o.length,"/15"]})]}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${y?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:g,onDragLeave:g,onDragOver:g,onDrop:L,children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:e.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Перетащите файлы сюда или"," ",e.jsxs("label",{className:"text-blue-600 hover:text-blue-500 cursor-pointer",children:["выберите файлы",e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:C,className:"hidden"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Поддерживаются изображения (JPG, PNG, GIF, WebP) и видео (MP4, AVI, MOV, WMV, FLV, WebM) до 50MB"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{type:"button",onClick:()=>m(!0),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Выбрать из библиотеки"]})}),o.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Предварительный просмотр слайдера:"}),e.jsx(B,{media:o,className:"w-full",autoPlay:!1,interval:5e3})]}),o.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Загруженные файлы:"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:o.map((t,r)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden",children:t.type==="video"?e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"🎥"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Видео"})]})}):e.jsx("img",{src:t.path,alt:t.name,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"absolute top-1 left-1 bg-black bg-opacity-75 text-white text-xs px-1 py-0.5 rounded",children:t.type==="video"?"🎥":"🖼️"}),e.jsx("button",{type:"button",onClick:()=>S(r,t.source),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity",children:"×"}),e.jsx("div",{className:"mt-1 text-xs text-gray-600 truncate",children:t.name})]},r))})]})]}),e.jsxs("div",{className:"sm:col-span-6 flex justify-end space-x-3",children:[e.jsx(v,{href:route("admin.news"),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Отмена"}),e.jsx("button",{type:"submit",disabled:b,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:b?"Сохранение...":"Сохранить"})]})]})})})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Библиотека медиа-файлов"}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx($,{onSelect:_,onClose:()=>m(!1),multiple:!0})]})})]})}export{q as default};

import{r as l,j as e,b as R}from"./app-BFkpbt5u.js";const J=({tabs:n=[],defaultTab:w=0,folder:x="",api:y=!1})=>{var z,A,M,E;const[p,N]=l.useState(w),[S,f]=l.useState(!1),[m,D]=l.useState(null),[c,U]=l.useState(n),[T,h]=l.useState(!1),[B,b]=l.useState(null),[$,u]=l.useState(!1),[I,L]=l.useState(null),[C,k]=l.useState(null);l.useEffect(()=>{(async()=>{if(!y||!x){U(n);return}try{f(!0),console.log("Fetching documents from API, folder:",x);const s=new URLSearchParams,r=x.replace(/\\/g,"/");s.append("folder",r);const a=await R.get(`/api/files?${s.toString()}`);if(console.log("API response:",a.data),a.data&&Array.isArray(a.data)){const i={};a.data.filter(o=>!o.isDirectory).forEach(o=>{let g=new Date().getFullYear().toString();const v=o.name&&o.name.match(/^(\d{4})/);v&&(g=v[1]),i[g]||(i[g]={year:`${g} год`,documents:[]}),i[g].documents.push({title:P(o.name),fileType:V(o.name),url:`/storage/documents/${x}/${o.name}`})});const d=[{title:"Документы",years:Object.values(i).sort((o,g)=>{const v=parseInt(o.year);return parseInt(g.year)-v})}];U(d)}else console.error("Invalid API response format:",a.data),D("Получен неверный формат данных от сервера")}catch(s){console.error("Error fetching documents from API:",s),D("Не удалось загрузить документы. Пожалуйста, попробуйте позже.")}finally{f(!1)}})()},[y,x,n]);const P=t=>{if(!t)return"";let s=t.replace(/^\d{4}_/,"");const r=s.split(".");return r.length>1?(r.pop(),r.join(".")):s},V=t=>{if(!t)return"";const s=t.split(".");return s.length>1?s[s.length-1].toLowerCase():""},W=t=>{try{return t?new Date(t).toLocaleDateString("ru-RU"):""}catch{return t}},_=async t=>{try{let s=t;if(t.includes("C:/xampp/htdocs/public/storage/documents/")||t.includes("C:\\xampp\\htdocs\\public\\storage\\documents\\")){const o=t.split("public/storage/documents/");o.length>1&&(s="/storage/documents/"+o[1])}if(t.includes("C:/xampp/htdocs/public/")||t.includes("C:\\xampp\\htdocs\\public\\")){const o=t.split("public/");o.length>1&&(s="/"+o[1])}const r=encodeURI(s);console.log("Fetching file info for URL:",r);const a=await R.head(r);console.log("HEAD response headers:",a.headers);const i=a.headers["content-length"],j=a.headers["last-modified"];let d={};return i?d.fileSize=G(i):d.fileSize="∼ MB",j?d.date=W(j):d.date=new Date().toLocaleDateString("ru-RU"),d}catch(s){return console.error("Ошибка при получении информации о файле:",s,"URL:",t),{fileSize:"∼ MB",date:new Date().toLocaleDateString("ru-RU")}}},G=t=>{if(!t)return"";t=parseInt(t);const s=["B","KB","MB","GB"];let r=t,a=0;for(;r>=1024&&a<s.length-1;)r/=1024,a++;return`${r.toFixed(1)} ${s[a]}`},H=t=>{if(!t)return"/icons/document.svg";switch(t.toLowerCase()){case"pdf":return"/icons/pdf.svg";case"doc":case"docx":return"/icons/word.svg";case"xls":case"xlsx":return"/icons/excel.svg";case"ppt":case"pptx":return"/icons/powerpoint.svg";case"txt":return"/icons/text.svg";case"jpg":case"jpeg":case"png":return"/icons/image.svg";case"mp4":case"avi":case"mov":return"/icons/video.svg";default:return"/icons/document.svg"}},K=t=>{var a;if(!t||!t.url){console.error("Попытка открыть документ с пустым URL");return}u(!0),L(null),k(t);const s=t.url,r=(a=t.fileType)==null?void 0:a.toLowerCase();if(r==="pdf")b(s),h(!0),u(!1);else if(["jpg","jpeg","png","gif"].includes(r))b(s),h(!0),u(!1);else if(["doc","docx","xls","xlsx","ppt","pptx"].includes(r))try{const i=s.startsWith("http")?s:window.location.origin+s,d=`https://docs.google.com/viewer?url=${encodeURIComponent(i)}&embedded=true`;b(d),h(!0),u(!1)}catch(i){console.error("Ошибка при подготовке просмотра документа:",i),L("Не удалось подготовить документ для просмотра"),h(!0),u(!1)}else window.open(s,"_blank"),u(!1)},F=()=>{h(!1),k(null),b(null),u(!1),L(null)};return S?e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-500"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Загрузка документов..."})]}):m?e.jsx("div",{className:"text-center p-4 text-red-600",children:m}):!c||c.length===0?e.jsx("div",{className:"text-center p-4 text-gray-600",children:"Документы не найдены"}):e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-100",children:[e.jsx("div",{className:"flex flex-wrap mb-6",children:c.map((t,s)=>e.jsx("button",{onClick:()=>N(s),className:`py-3 px-6 focus:outline-none transition-colors ${p===s?"bg-white text-gray-800 font-medium border-b-2 border-green-500":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:t.title},s))}),e.jsxs("div",{className:"py-2",children:[(A=(z=c[p])==null?void 0:z.years)==null?void 0:A.map((t,s)=>e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-4 px-2",children:t.year}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.documents.map((r,a)=>e.jsx(O,{document:r,openDocument:K,fetchFileInfo:_,getFileTypeIcon:H},a))})]},s)),!((E=(M=c[p])==null?void 0:M.years)!=null&&E.length)&&e.jsx("div",{className:"text-center p-8 text-gray-500",children:"В данной категории нет документов"})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",onClick:F,children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-6xl p-2 max-h-[90vh]",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:C?C.title:"Просмотр документа"}),e.jsx("button",{onClick:F,className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),$?e.jsx("div",{className:"flex justify-center items-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})}):I?e.jsx("div",{className:"text-red-600 p-4 text-center",children:I}):e.jsx("iframe",{src:B,className:"w-full h-[80vh]",title:"Document Viewer"})]})})]})},O=({document:n,openDocument:w,fetchFileInfo:x,getFileTypeIcon:y})=>{var m;const[p,N]=l.useState({fileSize:n.fileSize||"",date:n.date||""}),[S,f]=l.useState(!n.fileSize);return l.useEffect(()=>{!n.fileSize&&n.url&&(async()=>{try{f(!0);const c=await x(n.url);N(c)}catch(c){console.error("Ошибка при получении информации о файле:",c)}finally{f(!1)}})()},[n,x]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex flex-col h-[200px] bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 border border-gray-200",children:[e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsx("h2",{className:"font-medium leading-normal text-gray-800 line-clamp-6 mb-3",children:n.title})}),e.jsxs("div",{className:"flex mt-auto justify-between items-center",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>w(n),className:"cursor-pointer text-black inline-flex items-center border-gray-300 border rounded-lg px-3 py-2 text-sm hover:bg-gray-50 transition-colors duration-200",children:"Открыть"}),e.jsx("a",{href:n.url,download:!0,className:"cursor-pointer text-black inline-flex items-center border-gray-300 border rounded-lg px-3 py-2 text-sm hover:bg-gray-50 transition-colors duration-200",children:"Скачать"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:y(n.fileType),alt:n.fileType,className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:(m=n.fileType)==null?void 0:m.toUpperCase()})]}),S?e.jsx("span",{className:"text-xs text-gray-400",children:"Загрузка..."}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-500",children:p.fileSize}),e.jsx("p",{className:"text-xs text-gray-500",children:p.date})]})]})]})]})})};export{J as T};

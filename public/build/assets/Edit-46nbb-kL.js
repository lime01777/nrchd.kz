import{r as d,W as B,j as e,a as O}from"./app-Sx1rMr3q.js";import{A as R}from"./AdminLayout-DML6YmuF.js";import{A as T,S as U}from"./SimpleRichEditor-BJOLodZX.js";import"./transition-Cn2n7II_.js";import"./use-is-mounted-B0gQEa8T.js";import"./NewsSliderWithMain-BLG6-028.js";const h=["Общие","Аккредитация","Обучение","Конференции","Методические материалы","Исследования","Филиалы","Анонсы событий"];function G({news:s=null}){const b=!!s,[p,m]=d.useState(!1),{data:a,setData:l,post:A,put:D,processing:f,errors:n}=B({title:(s==null?void 0:s.title)||"",category:Array.isArray(s==null?void 0:s.category)?s.category:s!=null&&s.category?[s.category]:[],content:typeof(s==null?void 0:s.content)=="string"?s.content:"",images:(s==null?void 0:s.images)||[],main_image:(s==null?void 0:s.main_image)||null,status:(s==null?void 0:s.status)||"Черновик",publishDate:(s==null?void 0:s.publishDate)||new Date().toISOString().substr(0,10)});d.useEffect(()=>{s&&console.log("Загруженные данные новости:",{title:s.title,images:s.images,main_image:s.main_image})},[s]);const[c,y]=d.useState(()=>{if(s!=null&&s.category){const t=Array.isArray(s.category)?s.category:[s.category];return Array.from(new Set([...h,...t]))}return h}),[u,g]=d.useState(Array.isArray(a.category)?a.category:a.category?[a.category]:[]),[x,j]=d.useState(""),[N,v]=d.useState(a.images||[]),[k,C]=d.useState(a.main_image||null);d.useState(!1),console.log("NewsEdit - данные новости:",{news:s,data:a,images:a.images,main_image:a.main_image,imagesType:typeof a.images,mainImageType:typeof a.main_image}),d.useEffect(()=>{a.images&&a.images.length>0&&v(a.images),a.main_image&&C(a.main_image)},[]);const E=t=>{console.log("Изменение изображений:",t),v(t);const r=[],i=[];t.forEach(o=>{o instanceof File?r.push(o):typeof o=="string"&&i.push(o)}),l("images",i),l("image_files",r)},I=t=>{console.log("Изменение главного изображения:",t),C(t),l("main_image",t)},S=(t,r)=>{let i;r?i=[...u,t]:i=u.filter(o=>o!==t),g(i),l("category",i)},_=()=>{const t=x.trim();if(!t){alert("Введите название категории");return}if(c.includes(t)){alert("Такая категория уже существует");return}if(t.length<2){alert("Название категории должно содержать минимум 2 символа");return}if(t.length>50){alert("Название категории не должно превышать 50 символов");return}const r=[...c,t];y(r);const i=[...u,t];g(i),l("category",i),j("")},F=t=>{if(!confirm(`Вы уверены, что хотите удалить категорию "${t}"?`))return;const r=u.filter(o=>o!==t);g(r),l("category",r);const i=c.filter(o=>o!==t);y(i)},L=()=>{g([...c]),l("category",[...c])},$=()=>{g([]),l("category",[])},M=()=>{const t=c.filter(r=>!u.includes(r));g(t),l("category",t)},W=t=>{t.preventDefault(),m(!0);try{const r=a.category||[];if(console.log("Изображения перед отправкой:",{images:N,mainImage:k,data_images:a.images,data_main_image:a.main_image}),!a.title||a.title.trim().length===0){alert("Заполните заголовок"),m(!1);return}if(Array.isArray(a.category)||l("category",typeof a.category=="string"?[a.category]:[]),typeof a.content!="string"&&l("content",String(a.content||"")),["Черновик","Опубликовано","Запланировано"].includes(a.status)||l("status","Черновик"),!a.content||a.content.replace(/<[^>]*?>/g,"").trim().length<10){alert("Содержимое должно содержать минимум 10 символов"),m(!1);return}if(r.length===0){alert("Выберите хотя бы одну категорию"),m(!1);return}console.log("Финальные данные для отправки:",{title:a.title,content:a.content,category:a.category,status:a.status,publishDate:a.publishDate,images:a.images,main_image:a.main_image});const i={preserveScroll:!0,onSuccess:()=>{m(!1)},onError:o=>{console.error("Ошибки валидации:",o),m(!1)},onFinish:()=>{m(!1)}};b?D(route("admin.news.update",s.id),i):A(route("admin.news.store"),i)}catch(r){console.error("Ошибка при отправке формы:",r),m(!1),alert("Произошла ошибка при отправке формы")}},q=t=>{l("content",t)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:b?"Редактирование новости":"Создание новости"}),e.jsxs(O,{href:route("admin.news"),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Назад к списку"]})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:e.jsxs("form",{onSubmit:W,children:[e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Заголовок *"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"text",name:"title",id:"title",value:a.title,onChange:t=>l("title",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0,placeholder:"Введите заголовок новости"})}),n.title&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.title})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Категории *"}),e.jsx("div",{className:"mb-3 p-2 bg-blue-50 rounded-md",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-blue-700",children:["Выбрано: ",u.length," из ",c.length," категорий"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:L,className:"text-xs px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Выбрать все"}),e.jsx("button",{type:"button",onClick:$,className:"text-xs px-2 py-1 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Снять выбор"}),e.jsx("button",{type:"button",onClick:M,className:"text-xs px-2 py-1 bg-purple-500 text-white rounded hover:bg-purple-600",children:"Инвертировать"})]})]})}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50 mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Существующие категории"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-600 mb-2 uppercase tracking-wide",children:"Стандартные категории"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:c.filter(t=>h.includes(t)).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded border hover:border-blue-300 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[e.jsx("input",{type:"checkbox",id:`category-${t}`,checked:u.includes(t),onChange:r=>S(t,r.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:`category-${t}`,className:"text-sm text-gray-700 flex-1 cursor-pointer",children:t})]}),e.jsx("span",{className:"text-xs text-gray-400 px-2 py-1 bg-gray-100 rounded",children:"Стандартная"})]},t))})]}),c.filter(t=>!h.includes(t)).length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-gray-600 mb-2 uppercase tracking-wide",children:"Пользовательские категории"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:c.filter(t=>!h.includes(t)).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded border hover:border-blue-300 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[e.jsx("input",{type:"checkbox",id:`category-${t}`,checked:u.includes(t),onChange:r=>S(t,r.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:`category-${t}`,className:"text-sm text-gray-700 flex-1 cursor-pointer",children:t})]}),e.jsx("button",{type:"button",onClick:()=>F(t),className:"text-red-500 hover:text-red-700 p-1 rounded hover:bg-red-50 transition-colors",title:"Удалить категорию",children:e.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]},t))})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Добавить новую категорию"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:t=>j(t.target.value),placeholder:"Введите название новой категории",className:"flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-blue-500 focus:border-blue-500",onKeyPress:t=>{t.key==="Enter"&&(t.preventDefault(),_())}}),e.jsx("button",{type:"button",onClick:_,disabled:!x.trim(),className:"px-4 py-2 bg-blue-500 text-white rounded-md text-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-300 disabled:cursor-not-allowed disabled:text-gray-500",children:"Добавить"})]}),x.trim()&&e.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:['Нажмите Enter или кнопку "Добавить" для создания категории "',x,'"']})]}),n.category&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.category})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Статус *"}),e.jsx("div",{className:"mt-1",children:e.jsxs("select",{id:"status",name:"status",value:a.status,onChange:t=>l("status",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0,children:[e.jsx("option",{value:"Черновик",children:"Черновик"}),e.jsx("option",{value:"Опубликовано",children:"Опубликовано"}),e.jsx("option",{value:"Запланировано",children:"Запланировано"})]})}),n.status&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.status})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"publishDate",className:"block text-sm font-medium text-gray-700",children:"Дата публикации"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"date",name:"publishDate",id:"publishDate",value:a.publishDate,onChange:t=>l("publishDate",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md"})}),n.publishDate&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.publishDate})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Галерея изображений",e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"- Перетащите изображения или выберите из папки"})]}),e.jsx(T,{images:N,setImages:E,mainImage:k,setMainImage:I,maxImages:18})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Содержимое *"}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm min-h-[220px] transition-all",children:e.jsx(U,{value:a.content,onChange:q,placeholder:"Введите текст новости...",minHeight:"180px"})}),n.content&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.content}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Минимум 10 символов"})]})]})}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 text-right sm:px-6",children:e.jsx("button",{type:"submit",className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-blue-300 disabled:cursor-not-allowed",disabled:f||p,children:f||p?"Сохранение...":b?"Сохранить изменения":"Создать новость"})})]})})]})}G.layout=s=>e.jsx(R,{title:"Редактирование новости",children:s});export{G as default};

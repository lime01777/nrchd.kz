import{r as c,W as R,y as A,j as e,a as T}from"./app-D9UqLXqU.js";import{A as $}from"./AdminLayout-CVYppt0Q.js";import{T as v,I as n}from"./TextInput-BGMiMmzM.js";import{I as p}from"./InputLabel-mWVt5qaP.js";import{P as I}from"./PrimaryButton-DJIcxYJN.js";import{M as q}from"./ModernMediaUploader-ZP3j_cUC.js";import{u as H,j as J,n as K,o as W,l as X}from"./index-DDSc-Hbe.js";import"./transition-CZy1n6xQ.js";import"./use-is-mounted-D3sC-ehO.js";function ae({news:t=null,media:N=[],section:s=null,type:U="news"}){var M;const i=!!t,f=c.useMemo(()=>Array.isArray(t==null?void 0:t.media)?t.media:Array.isArray(N)?N:[],[t==null?void 0:t.media,N]),_=((M=document.querySelector('meta[name="csrf-token"]'))==null?void 0:M.getAttribute("content"))??"",h=U||(s==null?void 0:s.type)||(t==null?void 0:t.type)||"news",{data:o,setData:r,processing:C,errors:m,reset:E}=R({title:(t==null?void 0:t.title)||"",slug:(t==null?void 0:t.slug)||"",excerpt:(t==null?void 0:t.excerpt)||"",body:(t==null?void 0:t.body)||"",seo_title:(t==null?void 0:t.seo_title)||"",seo_description:(t==null?void 0:t.seo_description)||"",status:(t==null?void 0:t.status)||"draft",published_at:(t==null?void 0:t.published_at)||"",media:f,type:h}),[b,y]=c.useState(f),[k,L]=c.useState(!1),l=H({extensions:[J.configure({bulletList:!0,orderedList:!0,link:!1}),K.configure({inline:!1,allowBase64:!0}),W.configure({openOnClick:!1})],content:o.body,onUpdate:({editor:a})=>{r("body",a.getHTML())}});c.useEffect(()=>{l&&i&&(t!=null&&t.body)&&l.commands.setContent(t.body)},[l,i,t==null?void 0:t.body]),c.useEffect(()=>{var a;i||(a=l==null?void 0:l.commands)==null||a.setContent(o.body||"")},[l]),c.useEffect(()=>{!i&&!(t!=null&&t.id)||(y(f),r("media",f))},[i,t==null?void 0:t.id,f]);const B=()=>{const a=o.title.toLowerCase().replace(/[^-\uFFFF\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim();r("slug",a)},D=c.useCallback(a=>{!a||a.length===0||y(d=>{const u=a.map((g,j)=>({...g,position:g.position??d.length+j})),x=[...d,...u];return r("media",x),x})},[r]),O=c.useCallback(async a=>{const d=b.find(u=>u.id===a);if(y(u=>{const x=u.filter(g=>g.id!==a);return r("media",x),x}),!(!_||!(d!=null&&d.path)||d!=null&&d.is_external||(d==null?void 0:d.source)==="external"))try{await fetch("/admin/news/media/temp",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":_},body:JSON.stringify({path:d.path})})}catch(u){console.error("Ошибка удаления медиа файла",u)}},[b,_,r]),F=c.useCallback((a=null,d=null)=>{a&&a.preventDefault();const u=d??o.status;r("status",u);const x={...o,status:u,media:b,body:l?l.getHTML():o.body,type:h};delete x.cover;const g=()=>{L(!1)},j=()=>{var S;i||(E(),y([]),r("media",[]),(S=l==null?void 0:l.commands)==null||S.clearContent(!0))};i?A.post(route("admin.news.update",{news:t.id,type:h}),{...x,_method:"PUT"},{forceFormData:!0,onFinish:g,onSuccess:j}):A.post(route("admin.news.store",{type:h}),x,{forceFormData:!0,onFinish:g,onSuccess:j})},[o,b,i,t==null?void 0:t.id,l,E,r,h]),P=c.useCallback(()=>{L(!0),F(null,"published")},[F]);return e.jsx($,{title:s==null?void 0:s.title,children:e.jsx("div",{className:"py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:i?(s==null?void 0:s.editLabel)||"Редактировать новость":(s==null?void 0:s.createLabel)||"Создать новость"}),(s==null?void 0:s.subtitle)&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:s.subtitle}),e.jsxs(T,{href:route("admin.news.index",{type:h}),className:"mt-2 inline-flex items-center text-sm text-blue-600 hover:text-blue-800",children:[e.jsx("span",{className:"mr-2",children:"←"}),(s==null?void 0:s.returnLabel)||"Вернуться к списку"]})]}),e.jsxs("form",{onSubmit:a=>F(a),className:"space-y-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"title",value:"Заголовок *"}),e.jsx(v,{id:"title",type:"text",value:o.title,onChange:a=>r("title",a.target.value),className:"mt-1 block w-full",required:!0}),e.jsx(n,{message:m.title,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{htmlFor:"slug",value:"URL-адрес (slug)"}),e.jsx("button",{type:"button",onClick:B,className:"text-sm text-blue-600 hover:text-blue-800",children:"Обновить из заголовка"})]}),e.jsx(v,{id:"slug",type:"text",value:o.slug,onChange:a=>r("slug",a.target.value),className:"mt-1 block w-full",placeholder:"Автоматически генерируется из заголовка"}),e.jsx(n,{message:m.slug,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"excerpt",value:"Краткое описание"}),e.jsx("textarea",{id:"excerpt",value:o.excerpt,onChange:a=>r("excerpt",a.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",rows:3,placeholder:"Краткое описание новости для превью..."}),e.jsx(n,{message:m.excerpt,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"body",value:"Текст новости *"}),e.jsxs("div",{className:"mt-1 border border-gray-300 rounded-md",children:[l&&e.jsxs("div",{className:"border-b border-gray-200 p-2 flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>l.chain().focus().toggleBold().run(),className:`px-3 py-1 rounded text-sm ${l.isActive("bold")?"bg-gray-200 font-semibold":"hover:bg-gray-100"}`,children:"Жирный"}),e.jsx("button",{type:"button",onClick:()=>l.chain().focus().toggleItalic().run(),className:`px-3 py-1 rounded text-sm italic ${l.isActive("italic")?"bg-gray-200":"hover:bg-gray-100"}`,children:"Курсив"}),e.jsx("button",{type:"button",onClick:()=>l.chain().focus().toggleBulletList().run(),className:`px-3 py-1 rounded text-sm ${l.isActive("bulletList")?"bg-gray-200":"hover:bg-gray-100"}`,children:"Список"}),e.jsx("button",{type:"button",onClick:()=>l.chain().focus().setParagraph().run(),className:"px-3 py-1 rounded text-sm hover:bg-gray-100",children:"Абзац"})]}),e.jsx(X,{editor:l,className:"prose max-w-none p-4 min-h-[320px] focus:outline-none"})]}),e.jsx(n,{message:m.body,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"seo_title",value:"SEO заголовок"}),e.jsx(v,{id:"seo_title",type:"text",value:o.seo_title,onChange:a=>r("seo_title",a.target.value),className:"mt-1 block w-full",placeholder:"Если не указано — используется основной заголовок"}),e.jsx(n,{message:m.seo_title,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"seo_description",value:"SEO описание"}),e.jsx("textarea",{id:"seo_description",value:o.seo_description,onChange:a=>r("seo_description",a.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",rows:2,placeholder:"Если не указано — используется краткое описание"}),e.jsx(n,{message:m.seo_description,className:"mt-2"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"status",value:"Статус *"}),e.jsxs("select",{id:"status",value:o.status,onChange:a=>r("status",a.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"draft",children:"Черновик"}),e.jsx("option",{value:"published",children:"Опубликовано"})]}),e.jsx(n,{message:m.status,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"published_at",value:"Дата и время публикации"}),e.jsx(v,{id:"published_at",type:"datetime-local",value:o.published_at,onChange:a=>r("published_at",a.target.value),className:"mt-1 block w-full"}),e.jsx(n,{message:m.published_at,className:"mt-2"})]})]})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Галерея"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Загрузите дополнительные изображения или видео (поддерживаются форматы jpg, png, webp, mp4 и др.)."})]}),e.jsxs("span",{className:"text-sm text-gray-400",children:["Файлов: ",b.length]})]}),e.jsx(q,{existingMedia:b,onMediaUploaded:D,onMediaRemoved:O,maxFiles:30}),e.jsx(n,{message:m.media,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-4",children:[e.jsx(T,{href:route("admin.news.index",{type:h}),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Отмена"}),e.jsx(I,{type:"submit",disabled:C||k,className:"px-4 py-2",children:C?"Сохранение...":i?"Сохранить изменения":(s==null?void 0:s.createLabel)||"Создать запись"}),!i&&e.jsx(I,{type:"button",disabled:C||k,onClick:P,className:"px-4 py-2 bg-green-600 hover:bg-green-700",children:k?"Публикация...":"Сохранить и опубликовать"})]})]})]})})})}export{ae as default};

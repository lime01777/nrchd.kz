import{r as l,j as t,b as F}from"./app-C_HHkXdl.js";const J=({tabs:r=[],defaultTab:N=0,folder:f="",api:w=!1})=>{var C,M,A,B;const[x,m]=l.useState(N),[S,p]=l.useState(!1),[h,D]=l.useState(null),[c,U]=l.useState(r),[E,y]=l.useState(!1),[T,b]=l.useState(null),[$,u]=l.useState(!1),[I,L]=l.useState(null),[R,k]=l.useState(null);l.useEffect(()=>{(async()=>{if(!w||!f){U(r);return}try{p(!0),console.log("Fetching documents from API, folder:",f);const s=new URLSearchParams,n=f.replace(/\\/g,"/");s.append("folder",n);const a=await F.get(`/api/files?${s.toString()}`);if(console.log("API response:",a.data),a.data&&Array.isArray(a.data)){const i={};a.data.filter(o=>!o.isDirectory&&o.name).forEach(o=>{let g=new Date().getFullYear().toString();const j=o.name&&o.name.match(/^(\d{4})/);j&&(g=j[1]),i[g]||(i[g]={year:`${g} год`,documents:[]}),i[g].documents.push({title:P(o.name),fileType:V(o.name),url:`/storage/documents/${f}/${o.name}`,name:o.name})});const d=[{title:"Документы",years:Object.values(i).sort((o,g)=>{const j=parseInt(o.year);return parseInt(g.year)-j})}];U(d)}else console.error("Invalid API response format:",a.data),D("Получен неверный формат данных от сервера")}catch(s){console.error("Error fetching documents from API:",s),D("Не удалось загрузить документы. Пожалуйста, попробуйте позже.")}finally{p(!1)}})()},[w,f,r]);const P=e=>{if(!e)return"";let s=e.replace(/^\d{4}_/,"");const n=s.split(".");return n.length>1?(n.pop(),n.join(".")):s},V=e=>{if(!e)return"";const s=e.split(".");return s.length>1?s[s.length-1].toLowerCase():""},W=e=>{try{return e?new Date(e).toLocaleDateString("ru-RU"):""}catch{return e}},_=async e=>{try{if(!e||typeof e!="string")return console.warn("Attempt to fetch file info with undefined or invalid URL"),{fileSize:"∼ MB",date:new Date().toLocaleDateString("ru-RU")};let s=e;if(e.includes("C:/xampp/htdocs/public/storage/documents/")||e.includes("C:\\xampp\\htdocs\\public\\storage\\documents\\")){const o=e.split("public/storage/documents/");o.length>1&&(s="/storage/documents/"+o[1])}if(e.includes("C:/xampp/htdocs/public/")||e.includes("C:\\xampp\\htdocs\\public\\")){const o=e.split("public/");o.length>1&&(s="/"+o[1])}if(s.includes("undefined")||s.endsWith("/undefined"))return console.warn("Skip fetching file info for URL containing undefined:",s),{fileSize:"∼ MB",date:new Date().toLocaleDateString("ru-RU")};const n=encodeURI(s);console.log("Fetching file info for URL:",n);const a=await F.head(n);console.log("HEAD response headers:",a.headers);const i=a.headers["content-length"],v=a.headers["last-modified"];let d={};return i?d.fileSize=G(i):d.fileSize="∼ MB",v?d.date=W(v):d.date=new Date().toLocaleDateString("ru-RU"),d}catch(s){return console.error("Ошибка при получении информации о файле:",s,"URL:",e),{fileSize:"∼ MB",date:new Date().toLocaleDateString("ru-RU")}}},G=e=>{if(!e)return"";e=parseInt(e);const s=["B","KB","MB","GB"];let n=e,a=0;for(;n>=1024&&a<s.length-1;)n/=1024,a++;return`${n.toFixed(1)} ${s[a]}`},H=e=>{if(!e)return"/icons/document.svg";switch(e.toLowerCase()){case"pdf":return"/icons/pdf.svg";case"doc":case"docx":return"/icons/word.svg";case"xls":case"xlsx":return"/icons/excel.svg";case"ppt":case"pptx":return"/icons/powerpoint.svg";case"txt":return"/icons/text.svg";case"jpg":case"jpeg":case"png":return"/icons/image.svg";case"mp4":case"avi":case"mov":return"/icons/video.svg";default:return"/icons/document.svg"}},K=e=>{var a;if(!e||!e.url){console.error("Попытка открыть документ с пустым URL");return}u(!0),L(null),k(e);const s=e.url,n=(a=e.fileType)==null?void 0:a.toLowerCase();if(n==="pdf")b(s),y(!0),u(!1);else if(["jpg","jpeg","png","gif"].includes(n))b(s),y(!0),u(!1);else if(["doc","docx","xls","xlsx","ppt","pptx"].includes(n))try{const i=s.startsWith("http")?s:window.location.origin+s,d=`https://docs.google.com/viewer?url=${encodeURIComponent(i)}&embedded=true`;b(d),y(!0),u(!1)}catch(i){console.error("Ошибка при подготовке просмотра документа:",i),L("Не удалось подготовить документ для просмотра"),y(!0),u(!1)}else window.open(s,"_blank"),u(!1)},z=()=>{y(!1),k(null),b(null),u(!1),L(null)};return S?t.jsxs("div",{className:"text-center p-8",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-500"}),t.jsx("p",{className:"mt-2 text-gray-600",children:"Загрузка документов..."})]}):h?t.jsx("div",{className:"text-center p-4 text-red-600",children:h}):!c||c.length===0?t.jsx("div",{className:"text-center p-4 text-gray-600",children:"Документы не найдены"}):t.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-100",children:[t.jsx("div",{className:"flex flex-wrap mb-6",children:c.map((e,s)=>t.jsx("button",{onClick:()=>m(s),className:`py-3 px-6 focus:outline-none transition-colors ${x===s?"bg-white text-gray-800 font-medium border-b-2 border-green-500":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:e.title},s))}),t.jsxs("div",{className:"py-2",children:[(M=(C=c[x])==null?void 0:C.years)==null?void 0:M.map((e,s)=>t.jsxs("div",{className:"mb-8",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-4 px-2",children:e.year}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.documents.map((n,a)=>t.jsx(O,{document:n,openDocument:K,fetchFileInfo:_,getFileTypeIcon:H},a))})]},s)),!((B=(A=c[x])==null?void 0:A.years)!=null&&B.length)&&t.jsx("div",{className:"text-center p-8 text-gray-500",children:"В данной категории нет документов"})]}),E&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",onClick:z,children:t.jsxs("div",{className:"bg-white rounded-lg w-full max-w-6xl p-2 max-h-[90vh]",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex justify-between items-center border-b pb-2 mb-2",children:[t.jsx("h3",{className:"text-lg font-medium",children:R?R.title:"Просмотр документа"}),t.jsx("button",{onClick:z,className:"text-gray-500 hover:text-gray-700",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),$?t.jsx("div",{className:"flex justify-center items-center h-96",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})}):I?t.jsx("div",{className:"text-red-600 p-4 text-center",children:I}):t.jsx("iframe",{src:T,className:"w-full h-[80vh]",title:"Document Viewer"})]})})]})},O=({document:r,openDocument:N,fetchFileInfo:f,getFileTypeIcon:w})=>{var h;const[x,m]=l.useState({fileSize:r.fileSize||"",date:r.date||""}),[S,p]=l.useState(!r.fileSize);return l.useEffect(()=>{!r.fileSize&&r.url&&(async()=>{try{if(p(!0),!r.url||typeof r.url!="string"||r.url.includes("undefined")){console.warn("Skip fetching file info for invalid URL:",r.url),m({fileSize:"∼ MB",date:new Date().toLocaleDateString("ru-RU")}),p(!1);return}const c=await f(r.url);m(c)}catch(c){console.error("Ошибка при получении информации о файле:",c),m({fileSize:"∼ MB",date:new Date().toLocaleDateString("ru-RU")})}finally{p(!1)}})()},[r,f]),t.jsx("div",{className:"w-full",children:t.jsxs("div",{className:"flex flex-col h-[200px] bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 border border-gray-200",children:[t.jsx("div",{className:"flex-grow overflow-hidden",children:t.jsx("h2",{className:"font-medium leading-normal text-gray-800 line-clamp-6 mb-3",children:r.title})}),t.jsxs("div",{className:"flex mt-auto justify-between items-center",children:[t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:()=>N(r),className:"cursor-pointer text-black inline-flex items-center border-gray-300 border rounded-lg px-3 py-2 text-sm hover:bg-gray-50 transition-colors duration-200",children:"Открыть"}),t.jsx("a",{href:r.url,download:!0,className:"cursor-pointer text-black inline-flex items-center border-gray-300 border rounded-lg px-3 py-2 text-sm hover:bg-gray-50 transition-colors duration-200",children:"Скачать"})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("img",{src:w(r.fileType),alt:r.fileType,className:"w-4 h-4 mr-1"}),t.jsx("span",{className:"text-xs text-gray-500",children:(h=r.fileType)==null?void 0:h.toUpperCase()})]}),S?t.jsx("span",{className:"text-xs text-gray-400",children:"Загрузка..."}):t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-xs text-gray-500",children:x.fileSize}),t.jsx("p",{className:"text-xs text-gray-500",children:x.date})]})]})]})]})})};export{J as T};

const h=async s=>{var d;const o=document.createElement("div");o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.zIndex="9999",o.style.background="rgba(0,0,0,0.8)",o.style.color="white",o.style.padding="15px",o.style.fontSize="16px",o.style.textAlign="center",o.innerHTML=`<h3>Перевод страницы на ${s}</h3><div id="debug-status">Инициализация...</div>`,document.body.appendChild(o);const t=n=>{const u=document.getElementById("debug-status");u&&(u.innerHTML+=`<br>${n}`),console.log("[Translator]",n)};try{const n=(d=document.querySelector('meta[name="csrf-token"]'))==null?void 0:d.getAttribute("content");if(!n){t("❌ ОШИБКА: CSRF токен не найден!");return}t("✓ CSRF токен найден"),t("Тестирование API перевода...");const i=await(await fetch("/api/test-translation",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":n},body:JSON.stringify({source:"ru",target:s,text:"Тестовый перевод"})})).json();if(!i.success){t(`❌ ОШИБКА API: ${i.message||"Неизвестная ошибка"}`),t(`Детали API: ${JSON.stringify(i)}`);return}t(`✓ API перевода работает! Тестовый перевод: "${i.translation}"`),t("Поиск текстовых элементов на странице...");const r=[],g=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:e=>{if(!e.textContent.trim()||o.contains(e))return NodeFilter.FILTER_REJECT;const l=e.parentElement;if(!l)return NodeFilter.FILTER_REJECT;const a=l.tagName.toLowerCase();return a==="script"||a==="style"||a==="noscript"?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}});for(;g.nextNode();)g.currentNode.textContent.trim().length>2&&r.push(g.currentNode);t(`Найдено ${r.length} текстовых элементов для перевода`);let y=0;for(let e=0;e<r.length;e++){const l=r[e],a=l.textContent.trim();if(!(a.length<2)){try{t(`Перевод элемента ${e+1}/${r.length}`);const c=await(await fetch("/api/translate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":n},body:JSON.stringify({text:a,source:"ru",target:s})})).json();c.success&&c.translation?(l.textContent=l.textContent.replace(a,c.translation),y++):t(`⚠️ Ошибка перевода элемента: ${c.message||"Неизвестная ошибка"}`)}catch(f){t(`⚠️ Ошибка при переводе элемента ${e+1}: ${f.message}`)}e%5===0&&t(`Прогресс: ${e+1}/${r.length} (${Math.round((e+1)/r.length*100)}%)`)}}localStorage.setItem("preferredLanguage",s),t(`✅ Перевод завершен! Переведено ${y} из ${r.length} элементов`),document.querySelectorAll(".lang-btn").forEach(e=>{e.getAttribute("data-lang")===s?(e.style.backgroundColor="#3b82f6",e.style.color="white"):(e.style.backgroundColor="white",e.style.color="#3b82f6")})}catch(n){t(`❌ КРИТИЧЕСКАЯ ОШИБКА: ${n.message}`)}setTimeout(()=>{document.body.removeChild(o)},8e3)};document.addEventListener("DOMContentLoaded",()=>{const s=localStorage.getItem("preferredLanguage")||"ru";document.querySelectorAll(".lang-btn").forEach(t=>{t.getAttribute("data-lang")===s?(t.style.backgroundColor="#3b82f6",t.style.color="white"):(t.style.backgroundColor="white",t.style.color="#3b82f6")}),console.log("[Translator] Simplified translation system initialized")});export{h as translatePage};

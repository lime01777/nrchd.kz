import{r as i,j as t,b as V}from"./app-BD1vUruF.js";function ne({folder:S,title:j,bgColor:X="bg-white",onVideoClick:D,limit:L,singleColumn:G=!1,hideDownload:R=!1,searchTerm:u="",medicine:x="",mkb:h="",category:p="",year:w="",fileType:v=""}){const[M,O]=i.useState([]),[H,C]=i.useState(!0),[I,K]=i.useState(null),[J,U]=i.useState(!1),[n,E]=i.useState(null),[T,b]=i.useState(!1),[_,$]=i.useState(null),[W,B]=i.useState(null);i.useState(null);const[Y,q]=i.useState({}),y=e=>{if(!e||e==="NaN.NaN.NaN")return"";try{const r=new Date(e);if(isNaN(r.getTime()))return e;const l=String(r.getDate()).padStart(2,"0"),a=String(r.getMonth()+1).padStart(2,"0"),o=r.getFullYear();return`${l}.${a}.${o}`}catch{return e}},P=e=>{if(!e||e===0)return"0 Bytes";if(typeof e=="string"){if(e.includes("KB")||e.includes("MB")||e.includes("GB"))return e;if(e=parseInt(e,10),isNaN(e))return"0 Bytes"}const r=1024,l=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(r));return parseFloat((e/Math.pow(r,a)).toFixed(1))+" "+l[a]};i.useEffect(()=>{(async()=>{try{C(!0);const r=window.location.origin,l=new URLSearchParams;if(S){const s=S.replace(/\\/g,"/");l.append("folder",s)}j&&l.append("title",j);let a=u||"";x&&(a+=` medicine:${x}`),h&&(a+=` mkb:${h}`),p&&(a+=` category:${p}`),a.trim()!==""&&l.append("search",a.trim()),console.log("Fetching files from:",`${r}/api/files?${l.toString()}`),console.log("Search parameters:",{searchTerm:u,medicine:x,mkb:h,category:p,year:w,fileType:v,fullSearchTerm:a});const o=await V.get(`${r}/api/files?${l.toString()}`);console.log("API response:",o.data);let c=[];o.data&&Array.isArray(o.data)?o.data.forEach(s=>{s.files&&(c=[...c,...s.files]),s.documents&&(c=[...c,...s.documents])}):o.data&&o.data.files&&(c=o.data.files),console.log("Processed files data:",c);const F=c.map(s=>{if(!s.name&&s.url){const d=s.url.split("/"),g=d[d.length-1];return{...s,name:g}}return s}),m=L?F.slice(0,L):F;O(m);const z=m.map(s=>s.url&&s.url!=="#"?V.head(s.url).then(d=>{const g=d.headers["content-length"],N=d.headers["last-modified"];return{id:s.id||s.url,size:g?P(g):"0 Bytes",date:y(N?new Date(N):s.date||s.created_at||"")}}).catch(d=>(console.error("Error fetching file info:",d),{id:s.id||s.url,size:P(s.size||0),date:y(s.date||s.created_at||"")})):Promise.resolve({id:s.id||s.url,size:P(s.size||0),date:y(s.date||s.created_at||"")}));Promise.all(z).then(s=>{const d={};s.forEach((g,N)=>{d[m[N].id||m[N].url]=g}),q(d),C(!1)})}catch(r){console.error("Error fetching files:",r),K("Ошибка при загрузке файлов"),C(!1)}})()},[S,j,L,u,x,h]);const Q=e=>{if(console.log("Getting icon for file:",e),!e||typeof e!="string")return"1";const r=e.split(".").pop().toLowerCase();switch(console.log("File extension:",r),r){case"pdf":return"2";case"xls":case"xlsx":return"3";case"txt":return"4";case"ppt":case"pptx":return"5";case"doc":case"docx":return"1";case"mp4":case"avi":case"mov":return"6";case"jpg":case"jpeg":case"png":case"gif":return"7";default:return"1"}},Z=e=>{if(!e||typeof e!="string")return"";const r=e.split(".").pop().toLowerCase();switch(r){case"pdf":return"PDF";case"doc":case"docx":return"DOCX";case"xls":case"xlsx":return"XLSX";case"ppt":case"pptx":return"PPTX";case"txt":return"TXT";case"mp4":case"avi":case"mov":return"MP4";case"jpg":case"jpeg":case"png":return"JPG";default:return r.toUpperCase()}},f=e=>{if(!e||typeof e!="string")return null;const r=e.split(".").pop().toLowerCase();return["pdf"].includes(r)?"pdf":["jpg","jpeg","png","gif","webp"].includes(r)?"image":["doc","docx"].includes(r)?"word":["xls","xlsx"].includes(r)?"excel":["ppt","pptx"].includes(r)?"powerpoint":["txt"].includes(r)?"text":["mp4","avi","mov"].includes(r)?"video":null},ee=e=>!e||e==="#"?"":e.startsWith("http://")||e.startsWith("https://")?e:`${window.location.origin}${e.startsWith("/")?"":"/"}${e}`,te=e=>{try{b(!0),B(null);const r=e.url||"",l=ee(r),o=`https://docs.google.com/viewer?url=${encodeURIComponent(l)}&embedded=true`;return $(o),b(!1),o}catch(r){return console.error("Ошибка при конвертации документа:",r),B("Не удалось подготовить документ для просмотра"),b(!1),null}},re=(e,r)=>{r&&r.preventDefault(),console.log("Opening file:",e),E(e),U(!0),document.body.style.overflow="hidden";const l=e.name||"";console.log("File name for determining type:",l);const a=f(l);console.log("Detected file type:",a),["word","excel","powerpoint"].includes(a)?te(e):a==="video"&&typeof D=="function"?(D(e.url,e.description||e.name||"Видео"),k()):$(null)},k=()=>{U(!1),document.body.style.overflow="auto",E(null),$(null),b(!1),B(null)},A=i.useMemo(()=>(!u||u.trim()==="")&&!x&&!h&&!p&&!w&&!v?M:M.filter(e=>{if(u&&u.trim()!==""){const r=u.toLowerCase().trim(),l=(e.name||"").toLowerCase(),a=(e.description||"").toLowerCase();if(!l.includes(r)&&!a.includes(r))return!1}return!(x&&e.medicine!==x||h&&e.mkb!==h||p&&e.category!==p||w&&e.year!==parseInt(w)||v&&e.filetype!==v.toLowerCase())}),[M,u,x,h,p,w,v]);return H?t.jsxs("div",{className:"py-8 text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-500"}),t.jsx("p",{className:"mt-2","data-translate":!0,children:"Загрузка файлов..."})]}):I?t.jsx("div",{className:"py-8 text-center text-red-500",children:I}):t.jsxs("div",{className:`py-6 ${X}`,children:[j&&t.jsx("h2",{className:"text-2xl font-semibold mb-6 text-gray-800",children:j}),A.length===0?t.jsx("div",{className:"py-8 text-center text-gray-500 bg-white rounded-lg shadow border border-gray-200","data-translate":!0,children:"Нет доступных документов"}):t.jsx("div",{className:`grid ${G?"grid-cols-1":"grid-cols-1 md:grid-cols-2 lg:grid-cols-3"} gap-4`,children:A.map((e,r)=>{const l=e.name||"",a=e.description||e.name||"Файл",o=e.id||e.url,c=Y[o]||{size:"0 Bytes",date:""},F=Z(l),m=Q(l);return console.log("Rendering file:",l,"Icon type:",m),t.jsx("div",{className:"w-full",children:t.jsxs("div",{className:"flex flex-col h-[250px] bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 border border-gray-200",children:[t.jsxs("div",{className:"flex-grow overflow-hidden",children:[t.jsx("h2",{className:"font-medium leading-normal text-gray-800 line-clamp-4 mb-3",children:a}),t.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[e.medicine&&t.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:["Раздел: ",e.medicine]}),e.mkb&&t.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800",children:["МКБ: ",e.mkb]})]})]}),t.jsxs("div",{className:"flex mt-auto justify-between items-center",children:[t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:z=>re(e,z),className:"cursor-pointer text-black inline-flex items-center border-gray-300 border rounded-lg px-3 py-2 text-sm hover:bg-gray-50 transition-colors duration-200",children:t.jsx("span",{"data-translate":!0,children:"Открыть"})}),!R&&t.jsx("a",{href:e.url,download:!0,className:"cursor-pointer text-black inline-flex items-center border-gray-300 border rounded-lg px-3 py-2 text-sm hover:bg-gray-50 transition-colors duration-200",children:t.jsx("span",{"data-translate":!0,children:"Скачать"})})]}),t.jsxs("div",{className:"flex flex-col text-sm",children:[t.jsxs("div",{className:"flex flex-row items-center",children:[t.jsx("img",{src:`/img/FileType/${m}.png`,alt:"",className:"w-4 h-4"}),t.jsxs("p",{className:"ml-1 uppercase text-xs text-gray-600",children:[F,", ",c.size]})]}),t.jsx("p",{className:"text-gray-400 text-xs text-right",children:c.date})]})]})]})},r)})}),J&&n&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:k,children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-800 truncate",children:n.description||n.name||"Файл"}),t.jsx("button",{onClick:k,className:"text-gray-500 hover:text-gray-700 focus:outline-none",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsx("div",{className:"flex-grow p-4 overflow-auto",children:T?t.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-gray-900 mb-4"}),t.jsx("p",{className:"text-gray-600","data-translate":!0,children:"Подготовка документа к просмотру..."})]}):W?t.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[t.jsx("div",{className:"text-red-500 mb-4",children:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t.jsx("p",{className:"text-gray-600 mb-4",children:W}),t.jsx("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Скачать файл"})]}):f(n.name)==="image"?t.jsx("div",{className:"flex items-center justify-center h-[70vh]",children:t.jsx("img",{src:n.url,alt:n.description||n.name,className:"max-w-full max-h-[70vh] object-contain"})}):f(n.name)==="pdf"?t.jsx("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:t.jsx("div",{className:"w-full h-full",children:t.jsx("object",{data:n.url,type:"application/pdf",className:"w-full h-full min-h-[70vh]",children:t.jsxs("p",{children:["Ваш браузер не поддерживает встроенный просмотр PDF.",t.jsx("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",children:"Скачайте PDF"}),"."]})})})}):f(n.name)==="video"?t.jsx("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:t.jsx("div",{className:"w-full h-full",children:t.jsx("video",{src:n.url,className:"max-w-full max-h-[70vh]",controls:!0,autoPlay:!0})})}):["word","excel","powerpoint"].includes(f(n.name))&&_?t.jsx("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:t.jsx("div",{className:"w-full h-full",children:t.jsx("iframe",{src:_,className:"w-full h-full min-h-[70vh]",title:n.description||n.name,frameBorder:"0"})})}):["word","excel","powerpoint"].includes(f(n.name))?t.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[t.jsx("div",{className:"text-blue-500 mb-4",children:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Предпросмотр для этого типа файла недоступен"}),t.jsx("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Скачать файл"})]}):t.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[t.jsx("div",{className:"text-gray-500 mb-4",children:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Предпросмотр для этого типа файла недоступен"}),t.jsx("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Скачать файл"})]})}),t.jsxs("div",{className:"p-4 border-t flex justify-end",children:[t.jsx("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",className:"bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2 rounded-lg mr-2 transition-colors duration-200",children:"Открыть в новой вкладке"}),t.jsx("button",{onClick:k,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Закрыть"})]})]})})]})}export{ne as S};

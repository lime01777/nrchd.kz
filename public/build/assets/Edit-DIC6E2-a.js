import{W as I,r as c,j as e,a as R}from"./app-BxwNkF6T.js";import{A as _}from"./AdminLayout-Cm37Wr-r.js";import{S as L}from"./react-select.esm-v1myikUZ.js";import{I as M,R as O}from"./quill.snow-CTGcErtg.js";import"./transition-jRrr3s2M.js";const y=["Общие","Аккредитация","Обучение","Конференции","Методические материалы","Исследования","Анонсы"];function q({news:t=null}){const n=!!t,{data:s,setData:r,post:j,put:N,processing:u,errors:l}=I({title:(t==null?void 0:t.title)||"",category:Array.isArray(t==null?void 0:t.category)?t.category:t!=null&&t.category?[t.category]:[],content:typeof(t==null?void 0:t.content)=="string"?t.content:"",images:(t==null?void 0:t.images)||[],main_image:(t==null?void 0:t.main_image)||null,status:(t==null?void 0:t.status)||"Черновик",publishDate:(t==null?void 0:t.publishDate)||new Date().toISOString().substr(0,10)}),[m,v]=c.useState(()=>{if(t!=null&&t.category){const a=Array.isArray(t.category)?t.category:[t.category];return Array.from(new Set([...y,...a]))}return y}),[x,g]=c.useState(Array.isArray(s.category)?s.category:s.category?[s.category]:[]),[i,h]=c.useState(""),[p,C]=c.useState(s.images),[b,S]=c.useState(s.main_image),f=m.map(a=>({value:a,label:a})),k=a=>{const o=a?a.map(d=>d.value):[];g(o),r("category",o)},D=()=>{if(i&&!m.includes(i)){v([...m,i]);const a=[...x,i];g(a),r("category",a),h("")}},A=a=>{a.preventDefault();const o=Array.isArray(s.category)?s.category:[s.category].filter(Boolean);if(o.forEach((d,F)=>r(`category[${F}]`,d)),typeof s.content!="string"&&r("content",String(s.content||"")),["Черновик","Опубликовано","Запланировано"].includes(s.status)||r("status","Черновик"),r("images",p),r("main_image",b),!s.content||s.content.replace(/<(.|\n)*?>/g,"").trim().length<10){alert("Содержимое должно содержать минимум 10 символов");return}if(o.length===0){alert("Выберите хотя бы одну категорию");return}n?N(route("admin.news.update",t.id),{forceFormData:!0}):j(route("admin.news.store"),{forceFormData:!0})},E=a=>{r("content",a)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:n?"Редактирование новости":"Создание новости"}),e.jsxs(R,{href:route("admin.news"),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Назад к списку"]})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:e.jsxs("form",{onSubmit:A,children:[e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Заголовок *"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"text",name:"title",id:"title",value:s.title,onChange:a=>r("title",a.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0,placeholder:"Введите заголовок новости"})}),l.title&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:l.title})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Категории *"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start sm:items-center mb-2",children:[e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(L,{isMulti:!0,options:f,value:f.filter(a=>x.includes(a.value)),onChange:k,classNamePrefix:"react-select",placeholder:"Выберите категории...",styles:{control:a=>({...a,minHeight:"42px",borderRadius:"8px",borderColor:"#cbd5e1",boxShadow:"none"}),multiValue:a=>({...a,background:"#e0e7ff",color:"#3730a3"}),option:(a,o)=>({...a,background:o.isFocused?"#f3f4f6":"white",color:"#1e293b"})}})}),e.jsxs("div",{className:"flex gap-2 items-center w-full sm:w-auto",children:[e.jsx("input",{type:"text",value:i,onChange:a=>h(a.target.value),placeholder:"Новая категория",className:"border rounded px-2 py-1 text-sm"}),e.jsx("button",{type:"button",onClick:D,className:"px-2 py-1 bg-blue-500 text-white rounded text-sm",children:"Добавить"})]})]}),l.category&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:l.category})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Статус *"}),e.jsx("div",{className:"mt-1",children:e.jsxs("select",{id:"status",name:"status",value:s.status,onChange:a=>r("status",a.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0,children:[e.jsx("option",{value:"Черновик",children:"Черновик"}),e.jsx("option",{value:"Опубликовано",children:"Опубликовано"}),e.jsx("option",{value:"Запланировано",children:"Запланировано"})]})}),l.status&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:l.status})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"publishDate",className:"block text-sm font-medium text-gray-700",children:"Дата публикации"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"date",name:"publishDate",id:"publishDate",value:s.publishDate,onChange:a=>r("publishDate",a.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md"})}),l.publishDate&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:l.publishDate})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Галерея изображений (до 18)"}),e.jsx(M,{images:p,setImages:C,mainImage:b,setMainImage:S,max:18})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Содержимое *"}),e.jsx("div",{className:"bg-white border-2 border-blue-200 rounded-lg shadow-sm p-2 min-h-[220px] focus-within:ring-2 focus-within:ring-blue-400 transition-all",children:e.jsx(O,{value:s.content,onChange:E,theme:"snow",placeholder:"Введите текст новости...",className:"min-h-[180px]"})}),l.content&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:l.content}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Минимум 10 символов"})]})]})}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 text-right sm:px-6",children:e.jsx("button",{type:"submit",className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:u,children:u?"Сохранение...":n?"Сохранить изменения":"Создать новость"})})]})})]})}q.layout=t=>e.jsx(_,{title:"Редактирование новости",children:t});export{q as default};

import{r as l,R as L,j as t,a as W}from"./app-ixJk8rcS.js";import{S as I}from"./SafeImage-zu6_9vCJ.js";import{i as z}from"./mediaUtils-oRnee45q.js";import{t as E}from"./TranslationService-BAsqNMh3.js";function M({images:f=[],className:x="",height:g="160px",showDots:b=!0,showCounter:u=!1,autoPlay:j=!0,interval:v=3e3}){const[a,c]=l.useState(0),[d,w]=l.useState(new Set),[i,y]=l.useState(new Set),[m,h]=l.useState(!0),p="news-slider:go-to",o=l.useCallback(r=>{if(!r||typeof r!="string")return r;const e=r.trim();return e.startsWith("http")||e.startsWith("/storage/")||e.startsWith("/img/news/")?e:e.startsWith("/")&&!e.startsWith("/storage/")&&!e.startsWith("/img/")?`/img/news${e}`:e.startsWith("/")?e:`/img/news/${e}`},[]),s=L.useMemo(()=>!Array.isArray(f)||f.length===0?[]:f.filter(e=>e?typeof e=="string"?e.trim()!==""&&(e.startsWith("http")||e.startsWith("blob:")||e.startsWith("/")):e instanceof File?e.size>0&&e.type.startsWith("image/"):!1:!1).map(e=>o(e)).filter(e=>e&&e.trim()!==""),[f,o]),N=l.useCallback(r=>{w(e=>{const n=new Set(e);return n.add(r),n.size>=s.length&&h(!1),n})},[s.length]),k=l.useCallback(r=>{console.warn("Ошибка загрузки изображения:",s[r]),y(e=>{const n=new Set(e);return n.add(r),n}),w(e=>{const n=new Set(e);return n.add(r),n.size>=s.length&&h(!1),n})},[s.length]);if(l.useEffect(()=>{w(new Set),y(new Set),h(!0),c(0)},[s]),l.useEffect(()=>{if(!j||s.length<=1||!d.has(0)&&!i.has(0))return;const r=setInterval(()=>{c(e=>(e+1)%s.length)},v);return()=>clearInterval(r)},[s.length,j,v,d,i]),l.useEffect(()=>{const r=e=>{const n=Number(e.detail);!Number.isNaN(n)&&n>=0&&n<s.length&&c(n)};return window.addEventListener(p,r),()=>{window.removeEventListener(p,r)}},[s.length]),!Array.isArray(s)||s.length===0)return t.jsx("div",{className:`relative overflow-hidden rounded-lg bg-gray-200 flex items-center justify-center ${x}`,style:{height:g},children:t.jsxs("div",{className:"text-gray-400 text-center",children:[t.jsx("svg",{className:"w-12 h-12 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),t.jsx("p",{className:"text-sm",children:"Нет изображений"})]})});if(s.length===1)return t.jsxs("div",{className:`relative overflow-hidden rounded-lg ${x}`,style:{height:g},children:[m&&t.jsx("div",{className:"absolute inset-0 bg-gray-200 flex items-center justify-center z-10",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),t.jsx(I,{src:s[0],alt:"Изображение новости",className:`w-full h-full object-cover transition-opacity duration-300 ${d.has(0)?"opacity-100":"opacity-0"}`,fallbackSrc:"",onLoad:()=>N(0),onError:()=>k(0)}),u&&!m&&t.jsx("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded",children:"1 / 1"}),b&&!m&&t.jsx("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1",children:t.jsx("div",{className:"w-2 h-2 bg-white rounded-full opacity-100"})})]});const S=r=>{c(r)};return t.jsxs("div",{className:`relative overflow-hidden rounded-lg ${x}`,style:{height:g},children:[t.jsxs("div",{className:"relative w-full h-full bg-gray-200",children:[a>0&&d.has(a-1)&&!i.has(a-1)&&!d.has(a)&&t.jsx(I,{src:s[a-1],alt:"Предыдущее изображение",className:"absolute inset-0 w-full h-full object-cover opacity-30",fallbackSrc:"",style:{minHeight:"100%",minWidth:"100%",objectFit:"cover"}}),i.has(a)?t.jsx("div",{className:"absolute inset-0 bg-gray-200 flex items-center justify-center z-20",children:t.jsxs("div",{className:"text-center text-gray-400",children:[t.jsx("svg",{className:"w-12 h-12 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),t.jsx("p",{className:"text-xs",children:"Изображение недоступно"})]})}):t.jsx(I,{src:s[a],alt:`Изображение ${a+1}`,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ${d.has(a)?"opacity-100 z-10":"opacity-0 z-0"}`,fallbackSrc:"",onLoad:()=>N(a),onError:()=>k(a),style:{minHeight:"100%",minWidth:"100%",objectFit:"cover"}}),s.map((r,e)=>e!==a&&t.jsx("img",{src:r,alt:"",className:"hidden",onLoad:()=>N(e),onError:()=>k(e)},e)),!d.has(a)&&!i.has(a)&&t.jsx("div",{className:"absolute inset-0 bg-gray-200 flex items-center justify-center z-10",children:t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})})]}),u&&s.length>1&&t.jsxs("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded z-10",children:[a+1," / ",s.length]}),b&&s.length>1&&t.jsx("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1 z-10",children:s.map((r,e)=>t.jsx("button",{onClick:()=>S(e),className:`w-2 h-2 rounded-full transition-all duration-200 ${e===a?"bg-white opacity-100":"bg-white opacity-50 hover:opacity-75"}`,"aria-label":`Перейти к изображению ${e+1}`},e))})]})}const C=L.memo(({date:f,description:x,slug:g,image:b,images:u=[],external_url:j,type:v})=>{const a=(h,p="")=>E.t(h,p),c=l.useMemo(()=>(u&&u.length>0?u:b?[b]:[]).map(o=>o?typeof o=="string"?o:typeof o=="object"&&(o.url||o.path)||null:null).filter(Boolean).filter(o=>!z(o)),[u,b]),d=l.useMemo(()=>c.join("|"),[c]),w=v==="media"&&j,i=w?j:g?route("news.show",g):null,y=()=>{const h=t.jsxs("span",{className:"mt-auto text-black inline-flex items-center border-gray-300 border rounded-lg px-4 py-2 text-sm hover:bg-gray-50 transition-colors duration-200 pointer-events-none",children:[a("common.readNews","Читать новость"),t.jsx("svg",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"w-4 h-4 ml-2",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})]});return h},m=t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"h-40 overflow-hidden rounded-t-lg bg-gray-100",children:c.length>0?t.jsx(M,{images:c,className:"h-40",height:"160px",showDots:!0,showCounter:!1,autoPlay:!0,interval:3e3},d):t.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-200",children:t.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),t.jsx("div",{className:"flex flex-col p-6 h-full",children:t.jsxs("div",{className:"flex-grow",children:[t.jsx("p",{className:"text-gray-500 text-sm mb-2",children:f}),t.jsx("h2",{className:"text-gray-900 text-lg font-medium mb-4 line-clamp-3 h-[4.5rem]",title:x,children:x}),t.jsx(y,{})]})})]});return i?w?t.jsx("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 h-full block cursor-pointer",children:m}):t.jsx(W,{href:i,className:"bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 h-full block",children:m}):t.jsx("div",{className:"bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 h-full",children:m})});C.displayName="News_chlank";export{C as N};

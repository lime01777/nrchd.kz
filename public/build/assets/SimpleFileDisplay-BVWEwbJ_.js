import{r as c,j as e,b as D}from"./app-BRX8V-8x.js";function Y({folder:w,title:h,bgColor:$="bg-white",onVideoClick:S,limit:y,singleColumn:I=!1,hideDownload:U=!1}){const[M,T]=c.useState([]),[E,b]=c.useState(!0),[L,_]=c.useState(null),[W,B]=c.useState(!1),[n,P]=c.useState(null),[A,f]=c.useState(!1),[C,N]=c.useState(null),[z,k]=c.useState(null),[V,X]=c.useState({}),g=r=>{if(!r||r==="NaN.NaN.NaN")return"";try{const s=new Date(r);if(isNaN(s.getTime()))return r;const o=String(s.getDate()).padStart(2,"0"),l=String(s.getMonth()+1).padStart(2,"0"),a=s.getFullYear();return`${o}.${l}.${a}`}catch{return r}},F=r=>{if(!r||r===0)return"0 Bytes";if(typeof r=="string"){if(r.includes("KB")||r.includes("MB")||r.includes("GB"))return r;if(r=parseInt(r,10),isNaN(r))return"0 Bytes"}const s=1024,o=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(r)/Math.log(s));return parseFloat((r/Math.pow(s,l)).toFixed(1))+" "+o[l]};c.useEffect(()=>{(async()=>{try{b(!0);const s=window.location.origin,o=new URLSearchParams;if(w){const t=w.replace(/\\/g,"/");o.append("folder",t)}h&&o.append("title",h),console.log("Fetching files from:",`${s}/api/files?${o.toString()}`);const l=await D.get(`${s}/api/files?${o.toString()}`);console.log("API response:",l.data);let a=[];l.data&&Array.isArray(l.data)?l.data.forEach(t=>{t.files&&(a=[...a,...t.files]),t.documents&&(a=[...a,...t.documents])}):l.data&&l.data.files&&(a=l.data.files),console.log("Processed files data:",a);const m=a.map(t=>{if(!t.name&&t.url){const i=t.url.split("/"),x=i[i.length-1];return{...t,name:x}}return t}),u=y?m.slice(0,y):m;T(u);const v=u.map(t=>t.url&&t.url!=="#"?D.head(t.url).then(i=>{const x=i.headers["content-length"],p=i.headers["last-modified"];return{id:t.id||t.url,size:x?F(x):"0 Bytes",date:g(p?new Date(p):t.date||t.created_at||"")}}).catch(i=>(console.error("Error fetching file info:",i),{id:t.id||t.url,size:F(t.size||0),date:g(t.date||t.created_at||"")})):Promise.resolve({id:t.id||t.url,size:F(t.size||0),date:g(t.date||t.created_at||"")}));Promise.all(v).then(t=>{const i={};t.forEach((x,p)=>{i[u[p].id||u[p].url]=x}),X(i),b(!1)})}catch(s){console.error("Error fetching files:",s),_("Ошибка при загрузке файлов"),b(!1)}})()},[w,h,y]);const G=r=>{if(console.log("Getting icon for file:",r),!r||typeof r!="string")return"1";const s=r.split(".").pop().toLowerCase();switch(console.log("File extension:",s),s){case"pdf":return"2";case"xls":case"xlsx":return"3";case"txt":return"4";case"ppt":case"pptx":return"5";case"doc":case"docx":return"1";case"mp4":case"avi":case"mov":return"6";case"jpg":case"jpeg":case"png":case"gif":return"7";default:return"1"}},R=r=>{if(!r||typeof r!="string")return"";const s=r.split(".").pop().toLowerCase();switch(s){case"pdf":return"PDF";case"doc":case"docx":return"DOCX";case"xls":case"xlsx":return"XLSX";case"ppt":case"pptx":return"PPTX";case"txt":return"TXT";case"mp4":case"avi":case"mov":return"MP4";case"jpg":case"jpeg":case"png":return"JPG";default:return s.toUpperCase()}},d=r=>{if(!r||typeof r!="string")return null;const s=r.split(".").pop().toLowerCase();return["pdf"].includes(s)?"pdf":["jpg","jpeg","png","gif","webp"].includes(s)?"image":["doc","docx"].includes(s)?"word":["xls","xlsx"].includes(s)?"excel":["ppt","pptx"].includes(s)?"powerpoint":["txt"].includes(s)?"text":["mp4","avi","mov"].includes(s)?"video":null},O=r=>!r||r==="#"?"":r.startsWith("http://")||r.startsWith("https://")?r:`${window.location.origin}${r.startsWith("/")?"":"/"}${r}`,H=r=>{try{f(!0),k(null);const s=r.url||"",o=O(s),a=`https://docs.google.com/viewer?url=${encodeURIComponent(o)}&embedded=true`;return N(a),f(!1),a}catch(s){return console.error("Ошибка при конвертации документа:",s),k("Не удалось подготовить документ для просмотра"),f(!1),null}},K=(r,s)=>{s&&s.preventDefault(),console.log("Opening file:",r),P(r),B(!0),document.body.style.overflow="hidden";const o=r.name||"";console.log("File name for determining type:",o);const l=d(o);console.log("Detected file type:",l),["word","excel","powerpoint"].includes(l)?H(r):l==="video"&&typeof S=="function"?(S(r.url,r.description||r.name||"Видео"),j()):N(null)},j=()=>{B(!1),document.body.style.overflow="auto",P(null),N(null),f(!1),k(null)};return E?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-500"}),e.jsx("p",{className:"mt-2",children:"Загрузка файлов..."})]}):L?e.jsx("div",{className:"py-8 text-center text-red-500",children:L}):e.jsxs("div",{className:`py-6 ${$}`,children:[h&&e.jsx("h2",{className:"text-2xl font-semibold mb-6 text-gray-800",children:h}),M.length===0?e.jsx("div",{className:"py-8 text-center text-gray-500 bg-white rounded-lg shadow border border-gray-200",children:"Нет доступных документов"}):e.jsx("div",{className:`grid ${I?"grid-cols-1":"grid-cols-1 md:grid-cols-2 lg:grid-cols-3"} gap-4`,children:M.map((r,s)=>{const o=r.name||"",l=r.description||r.name||"Файл",a=r.id||r.url,m=V[a]||{size:"0 Bytes",date:""},u=R(o),v=G(o);return console.log("Rendering file:",o,"Icon type:",v),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex flex-col h-[200px] bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 border border-gray-200",children:[e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsx("h2",{className:"font-medium leading-normal text-gray-800 line-clamp-6 mb-3",children:l})}),e.jsxs("div",{className:"flex mt-auto justify-between items-center",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:t=>K(r,t),className:"cursor-pointer text-black inline-flex items-center border-gray-300 border rounded-lg px-3 py-2 text-sm hover:bg-gray-50 transition-colors duration-200",children:"Открыть"}),!U&&e.jsx("a",{href:r.url,download:!0,className:"cursor-pointer text-black inline-flex items-center border-gray-300 border rounded-lg px-3 py-2 text-sm hover:bg-gray-50 transition-colors duration-200",children:"Скачать"})]}),e.jsxs("div",{className:"flex flex-col text-sm",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx("img",{src:`/img/FileType/${v}.png`,alt:"",className:"w-4 h-4"}),e.jsxs("p",{className:"ml-1 uppercase text-xs text-gray-600",children:[u,", ",m.size]})]}),e.jsx("p",{className:"text-gray-400 text-xs text-right",children:m.date})]})]})]})},s)})}),W&&n&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:j,children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] flex flex-col",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 truncate",children:n.description||n.name||"Файл"}),e.jsx("button",{onClick:j,className:"text-gray-500 hover:text-gray-700 focus:outline-none",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-grow p-4 overflow-auto",children:A?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-gray-900 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Подготовка документа к просмотру..."})]}):z?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("p",{className:"text-gray-600 mb-4",children:z}),e.jsx("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Скачать файл"})]}):d(n.name)==="image"?e.jsx("div",{className:"flex items-center justify-center h-[70vh]",children:e.jsx("img",{src:n.url,alt:n.description||n.name,className:"max-w-full max-h-[70vh] object-contain"})}):d(n.name)==="pdf"?e.jsx("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:e.jsx("div",{className:"w-full h-full",children:e.jsx("object",{data:n.url,type:"application/pdf",className:"w-full h-full min-h-[70vh]",children:e.jsxs("p",{children:["Ваш браузер не поддерживает встроенный просмотр PDF.",e.jsx("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",children:"Скачайте PDF"}),"."]})})})}):d(n.name)==="video"?e.jsx("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:e.jsx("div",{className:"w-full h-full",children:e.jsx("video",{src:n.url,className:"max-w-full max-h-[70vh]",controls:!0,autoPlay:!0})})}):["word","excel","powerpoint"].includes(d(n.name))&&C?e.jsx("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:e.jsx("div",{className:"w-full h-full",children:e.jsx("iframe",{src:C,className:"w-full h-full min-h-[70vh]",title:n.description||n.name,frameBorder:"0"})})}):["word","excel","powerpoint"].includes(d(n.name))?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[e.jsx("div",{className:"text-blue-500 mb-4",children:e.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Предпросмотр для этого типа файла недоступен"}),e.jsx("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Скачать файл"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:e.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Предпросмотр для этого типа файла недоступен"}),e.jsx("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Скачать файл"})]})}),e.jsxs("div",{className:"p-4 border-t flex justify-end",children:[e.jsx("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",className:"bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2 rounded-lg mr-2 transition-colors duration-200",children:"Открыть в новой вкладке"}),e.jsx("button",{onClick:j,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:"Закрыть"})]})]})})]})}export{Y as S};

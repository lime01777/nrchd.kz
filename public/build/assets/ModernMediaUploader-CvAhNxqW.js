import{r as d,j as t}from"./app-Bg9C1goP.js";function D({existingMedia:n=[],onMediaUploaded:m,onMediaRemoved:y,maxFiles:c=20,className:k=""}){const[U,v]=d.useState(!1),[h,w]=d.useState(""),[g,b]=d.useState(""),E=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`external-${Date.now()}-${Math.random().toString(16).slice(2)}`,j=d.useCallback(e=>{if(!e||typeof e!="string")return{error:"Укажите ссылку на внешний ресурс"};const i=e.trim();let l;try{l=new URL(i)}catch{return{error:"Некорректная ссылка. Проверьте адрес."}}const r=l.toString(),s=r.toLowerCase(),u=r.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/|shorts\/))([\w-]{6,})/i);if(u){const o=u[1];return{type:"video",provider:"youtube",url:r,embedUrl:`https://www.youtube.com/embed/${o}`,thumbnail:`https://img.youtube.com/vi/${o}/hqdefault.jpg`,name:"YouTube видео"}}const a=r.match(/instagram\.com\/(p|reel|tv)\/([^/?&]+)/i);if(a){const o=a[1],p=a[2];return{type:"video",provider:"instagram",url:r,embedUrl:`https://www.instagram.com/${o}/${p}/embed/`,name:"Instagram видео"}}return s.includes("aitube.kz")||s.includes("aitube.com")||s.includes("aitu.kz")?{type:"video",provider:"aitube",url:r,embedUrl:r,name:"Aitu видео"}:s.match(/\.(jpg|jpeg|png|gif|webp|avif)(\?|$)/)?{type:"image",provider:"external",url:r,embedUrl:null,name:"Внешнее изображение"}:{type:"video",provider:"external",url:r,embedUrl:r,name:"Внешнее видео"}},[]),S=d.useCallback(async e=>{const i=Array.from(e.target.files);if(i.length===0)return;const l=Math.max(0,c-n.length);if(l<=0){alert(`Достигнут лимит файлов (${c}). Удалите лишние медиа, чтобы загрузить новые.`),e.target.value="";return}const r=i.slice(0,l);if(r.length===0){e.target.value="";return}v(!0);try{const s=new FormData;r.forEach((o,p)=>{s.append(`media_files[${p}]`,o)});const u=await fetch("/admin/news/upload-media",{method:"POST",body:s,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}});if(!u.ok)throw new Error("Ошибка загрузки файлов");const a=await u.json();m&&a.success&&a.media&&m(a.media)}catch(s){console.error("Ошибка загрузки медиа:",s),alert("Ошибка загрузки файлов: "+s.message)}finally{v(!1),e.target.value=""}},[n.length,c,m]),f=d.useCallback(()=>{if(n.length>=c){b(`Достигнут лимит файлов (${c}). Удалите лишние медиа, чтобы добавить новые ссылки.`);return}const e=j(h);if(e.error){b(e.error);return}const i={id:E(),type:e.type==="image"?"image":"video",path:e.url,url:e.url,embed_url:e.embedUrl,provider:e.provider,source:"external",is_external:!0,is_embed:!!(e.embedUrl&&e.embedUrl!==e.url),name:e.name||"Внешний ресурс",position:n.length,thumbnail:e.thumbnail||null};m&&m([i]),w(""),b("")},[j,n.length,h,c,m]),C=d.useCallback(e=>{e.key==="Enter"&&(e.preventDefault(),f())},[f]),N=Math.max(0,c-n.length),x=U||N<=0,$=e=>{y&&y(e)};return t.jsxs("div",{className:k,children:[t.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${x?"cursor-not-allowed opacity-60 border-gray-200":"cursor-pointer border-gray-300 hover:border-gray-400"}`,children:[t.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:S,className:"hidden",id:"media-upload",disabled:x}),t.jsxs("label",{htmlFor:"media-upload",className:x?"cursor-not-allowed":"cursor-pointer",children:[t.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:t.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),t.jsxs("div",{className:"mt-4",children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Нажмите для выбора файлов"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Поддерживаются изображения и видео до 50MB"}),t.jsxs("p",{className:"mt-2 text-xs text-gray-400",children:["Осталось ",N," из ",c," файлов"]})]})]})]}),t.jsxs("div",{className:"mt-3 rounded-lg border border-gray-200 bg-gray-50 p-4",children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Или вставьте ссылку на внешнее видео: поддерживаются YouTube, Instagram, Aitube и прямые ссылки на файлы."}),t.jsxs("div",{className:"mt-3 flex flex-col gap-2 sm:flex-row",children:[t.jsx("input",{type:"url",value:h,onChange:e=>{w(e.target.value),g&&b("")},onKeyDown:C,placeholder:"https://www.youtube.com/watch?v=...",className:"flex-1 rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200"}),t.jsx("button",{type:"button",onClick:f,disabled:x||h.trim()==="",className:"inline-flex items-center justify-center rounded-md bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-60",children:"Добавить ссылку"})]}),g&&t.jsx("p",{className:"mt-2 text-xs text-red-500",children:g})]}),n.length>0&&t.jsxs("div",{className:"mt-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Загруженные файлы:"}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:n.map((e,i)=>{const l=e.name||e.provider||"Медиа",r=e.embed_url||e.url||e.path,s=e.url||e.path,u=e.thumbnail||(e.type==="image"?r:null),a=!!e.is_external,o=!!(e.is_embed&&e.embed_url),p=e.provider?e.provider.toUpperCase():null;return t.jsxs("div",{className:"relative group",children:[t.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden",children:e.type==="video"?o?t.jsx("iframe",{src:e.embed_url||r,title:l,className:"h-full w-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0}):t.jsx("video",{src:r,poster:u||void 0,className:"w-full h-full object-cover",muted:!0,controls:!0}):t.jsx("img",{src:u||s,alt:l,className:"w-full h-full object-cover"})}),p&&t.jsx("span",{className:"absolute left-1.5 top-1.5 rounded bg-black/60 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-white",children:p}),a&&!o&&e.type==="video"&&t.jsx("span",{className:"absolute left-1.5 bottom-1.5 rounded bg-blue-600 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-white",children:"Ссылка"}),e.isUploading&&t.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:t.jsx("div",{className:"text-white text-sm",children:"Загрузка..."})}),t.jsx("button",{type:"button",onClick:()=>$(e.id),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity",children:"×"}),t.jsx("div",{className:"mt-1 text-xs text-gray-600 truncate",children:l})]},e.id||`media-${i}`)})})]})]})}export{D as M};

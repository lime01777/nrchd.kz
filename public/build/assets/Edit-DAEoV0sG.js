import{r as u,W as M,j as e,a as T}from"./app-PWNA6cAJ.js";import{A as $}from"./AdminLayout-C-XpKtcA.js";import{S as q}from"./react-select.esm-BkvGmbLP.js";import{I as z,S as G}from"./SimpleRichEditor-hHKetcLy.js";import"./transition-DBI0-6oe.js";const k=["Общие","Аккредитация","Обучение","Конференции","Методические материалы","Исследования","Анонсы"];function H({news:t=null}){const h=!!t,[f,m]=u.useState(!1),{data:s,setData:l,post:A,put:F,processing:b,errors:i}=M({title:(t==null?void 0:t.title)||"",category:Array.isArray(t==null?void 0:t.category)?t.category:t!=null&&t.category?[t.category]:[],content:typeof(t==null?void 0:t.content)=="string"?t.content:"",images:(t==null?void 0:t.images)||[],main_image:(t==null?void 0:t.main_image)||null,status:(t==null?void 0:t.status)||"Черновик",publishDate:(t==null?void 0:t.publishDate)||new Date().toISOString().substr(0,10)}),[p,E]=u.useState(()=>{if(t!=null&&t.category){const a=Array.isArray(t.category)?t.category:[t.category];return Array.from(new Set([...k,...a]))}return k}),[y,j]=u.useState(Array.isArray(s.category)?s.category:s.category?[s.category]:[]),[g,v]=u.useState(""),[N,I]=u.useState(s.images),[n,S]=u.useState(s.main_image),C=p.map(a=>({value:a,label:a})),_=a=>{const c=a?a.map(d=>d.value):[];j(c),l("category",c)},O=()=>{if(g&&!p.includes(g)){E([...p,g]);const a=[...y,g];j(a),l("category",a),v("")}},R=a=>{a.preventDefault(),m(!0);try{const c=s.category||[];if(!s.title||s.title.trim().length===0){alert("Заполните заголовок"),m(!1);return}Array.isArray(s.category)||l("category",typeof s.category=="string"?[s.category]:[]),typeof s.content!="string"&&l("content",String(s.content||"")),["Черновик","Опубликовано","Запланировано"].includes(s.status)||l("status","Черновик");const d=N.filter(r=>r&&(typeof r=="string"||r instanceof File&&r.size>0));if(l("images",d),n&&(typeof n=="string"||n instanceof File&&n.size>0)?l("main_image",n):d.length>0?(l("main_image",d[0]),S(d[0])):l("main_image",null),!s.content||s.content.replace(/<[^>]*?>/g,"").trim().length<10){alert("Содержимое должно содержать минимум 10 символов"),m(!1);return}if(c.length===0){alert("Выберите хотя бы одну категорию"),m(!1);return}const o=new FormData;o.append("title",s.title),o.append("content",s.content),o.append("status",s.status),o.append("publishDate",s.publishDate||""),c.forEach((r,x)=>{o.append(`category[${x}]`,r)}),d.forEach((r,x)=>{r instanceof File?o.append(`images[${x}]`,r):typeof r=="string"&&o.append(`images[${x}]`,r)}),(n instanceof File||typeof n=="string")&&o.append("main_image",n),fetch("/admin/news/debug",{method:"POST",body:o,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(r=>r.json()).then(r=>console.log("Отладочные данные:",r)).catch(r=>console.error("Ошибка отладки:",r));const D={forceFormData:!0,preserveScroll:!0,onSuccess:()=>{m(!1)},onError:r=>{console.error("Ошибки валидации:",r),m(!1)},onFinish:()=>{m(!1)}};h?F(route("admin.news.update",t.id),o,D):A(route("admin.news.store"),o,D)}catch(c){console.error("Ошибка при отправке формы:",c),m(!1),alert("Произошла ошибка при отправке формы")}},L=a=>{l("content",a)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:h?"Редактирование новости":"Создание новости"}),e.jsxs(T,{href:route("admin.news"),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Назад к списку"]})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:e.jsxs("form",{onSubmit:R,children:[e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Заголовок *"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"text",name:"title",id:"title",value:s.title,onChange:a=>l("title",a.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0,placeholder:"Введите заголовок новости"})}),i.title&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:i.title})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Категории *"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start sm:items-center mb-2",children:[e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(q,{isMulti:!0,options:C,value:C.filter(a=>y.includes(a.value)),onChange:_,classNamePrefix:"react-select",placeholder:"Выберите категории...",styles:{control:a=>({...a,minHeight:"42px",borderRadius:"8px",borderColor:"#cbd5e1",boxShadow:"none"}),multiValue:a=>({...a,background:"#e0e7ff",color:"#3730a3"}),option:(a,c)=>({...a,background:c.isFocused?"#f3f4f6":"white",color:"#1e293b"})}})}),e.jsxs("div",{className:"flex gap-2 items-center w-full sm:w-auto",children:[e.jsx("input",{type:"text",value:g,onChange:a=>v(a.target.value),placeholder:"Новая категория",className:"border rounded px-2 py-1 text-sm"}),e.jsx("button",{type:"button",onClick:O,className:"px-2 py-1 bg-blue-500 text-white rounded text-sm",children:"Добавить"})]})]}),i.category&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:i.category})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Статус *"}),e.jsx("div",{className:"mt-1",children:e.jsxs("select",{id:"status",name:"status",value:s.status,onChange:a=>l("status",a.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0,children:[e.jsx("option",{value:"Черновик",children:"Черновик"}),e.jsx("option",{value:"Опубликовано",children:"Опубликовано"}),e.jsx("option",{value:"Запланировано",children:"Запланировано"})]})}),i.status&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:i.status})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"publishDate",className:"block text-sm font-medium text-gray-700",children:"Дата публикации"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"date",name:"publishDate",id:"publishDate",value:s.publishDate,onChange:a=>l("publishDate",a.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md"})}),i.publishDate&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:i.publishDate})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Галерея изображений (до 18)"}),e.jsx(z,{images:N,setImages:I,mainImage:n,setMainImage:S,max:18})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Содержимое *"}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm min-h-[220px] transition-all",children:e.jsx(G,{value:s.content,onChange:L,placeholder:"Введите текст новости...",minHeight:"180px"})}),i.content&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:i.content}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Минимум 10 символов"})]})]})}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 text-right sm:px-6",children:e.jsx("button",{type:"submit",className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-blue-300 disabled:cursor-not-allowed",disabled:b||f,children:b||f?"Сохранение...":h?"Сохранить изменения":"Создать новость"})})]})})]})}H.layout=t=>e.jsx($,{title:"Редактирование новости",children:t});export{H as default};

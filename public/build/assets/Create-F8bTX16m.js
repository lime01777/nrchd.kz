import{r as d,W as I,j as e,a as _}from"./app-yYR0FjU0.js";import{A}from"./AdminLayout-Df0d4tIF.js";import{S as L}from"./react-select.esm-BrEP7GLZ.js";import{I as M,S as R}from"./SimpleRichEditor-Zpt40p1-.js";import"./transition-DSO618DS.js";const $=["Общие","Аккредитация","Обучение","Конференции","Методические материалы","Исследования","Анонсы"];function O(){const[x,c]=d.useState(!1),{data:s,setData:l,post:w,processing:g,errors:n}=I({title:"",category:[],content:"",images:[],main_image:null,status:"Черновик",publishDate:new Date().toISOString().substr(0,10)}),[p,S]=d.useState($),[f,b]=d.useState([]),[u,j]=d.useState(""),[y,C]=d.useState([]),[r,v]=d.useState(null),N=p.map(t=>({value:t,label:t})),D=t=>{const o=t?t.map(m=>m.value):[];b(o),l("category",o)},k=()=>{if(u&&!p.includes(u)){S([...p,u]);const t=[...f,u];b(t),l("category",t),j("")}},F=t=>{t.preventDefault(),c(!0);try{const o=s.category||[];if(!s.title||s.title.trim().length===0){alert("Заполните заголовок"),c(!1);return}typeof s.content!="string"&&l("content",String(s.content||"")),["Черновик","Опубликовано","Запланировано"].includes(s.status)||l("status","Черновик");const m=y.filter(a=>a&&(typeof a=="string"||a instanceof File&&a.size>0));if(l("images",m),r&&(typeof r=="string"||r instanceof File&&r.size>0)?l("main_image",r):m.length>0?(l("main_image",m[0]),v(m[0])):l("main_image",null),!s.content||s.content.replace(/<[^>]*?>/g,"").trim().length<10){alert("Содержимое должно содержать минимум 10 символов"),c(!1);return}if(o.length===0){alert("Выберите хотя бы одну категорию"),c(!1);return}const i=new FormData;i.append("title",s.title),i.append("content",s.content),i.append("status",s.status),i.append("publishDate",s.publishDate||""),o.forEach((a,h)=>{i.append(`category[${h}]`,a)}),m.forEach((a,h)=>{a instanceof File?i.append(`images[${h}]`,a):typeof a=="string"&&i.append(`images[${h}]`,a)}),(r instanceof File||typeof r=="string")&&i.append("main_image",r),w(route("admin.news.store"),i,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{c(!1)},onError:a=>{console.error("Ошибки валидации:",a),c(!1)},onFinish:()=>{c(!1)}})}catch(o){console.error("Ошибка при отправке формы:",o),c(!1)}},E=t=>{l("content",t)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Создание новости"}),e.jsxs(_,{href:route("admin.news"),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Назад к списку"]})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:e.jsxs("form",{onSubmit:F,children:[e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Заголовок *"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"text",name:"title",id:"title",value:s.title,onChange:t=>l("title",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0,placeholder:"Введите заголовок новости"})}),n.title&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.title})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Категории *"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start sm:items-center mb-2",children:[e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(L,{isMulti:!0,options:N,value:N.filter(t=>f.includes(t.value)),onChange:D,classNamePrefix:"react-select",placeholder:"Выберите категории...",styles:{control:t=>({...t,minHeight:"42px",borderRadius:"8px",borderColor:"#cbd5e1",boxShadow:"none"}),multiValue:t=>({...t,background:"#e0e7ff",color:"#3730a3"}),option:(t,o)=>({...t,background:o.isFocused?"#f3f4f6":"white",color:"#1e293b"})}})}),e.jsxs("div",{className:"flex gap-2 items-center w-full sm:w-auto",children:[e.jsx("input",{type:"text",value:u,onChange:t=>j(t.target.value),placeholder:"Новая категория",className:"border rounded px-2 py-1 text-sm"}),e.jsx("button",{type:"button",onClick:k,className:"px-2 py-1 bg-blue-500 text-white rounded text-sm",children:"Добавить"})]})]}),n.category&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.category})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Статус *"}),e.jsx("div",{className:"mt-1",children:e.jsxs("select",{id:"status",name:"status",value:s.status,onChange:t=>l("status",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0,children:[e.jsx("option",{value:"Черновик",children:"Черновик"}),e.jsx("option",{value:"Опубликовано",children:"Опубликовано"}),e.jsx("option",{value:"Запланировано",children:"Запланировано"})]})}),n.status&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.status})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"publishDate",className:"block text-sm font-medium text-gray-700",children:"Дата публикации"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"date",name:"publishDate",id:"publishDate",value:s.publishDate,onChange:t=>l("publishDate",t.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md"})}),n.publishDate&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.publishDate})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Галерея изображений (до 18)"}),e.jsx(M,{images:y,setImages:C,mainImage:r,setMainImage:v,max:18})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Содержимое *"}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm min-h-[220px] transition-all",children:e.jsx(R,{value:s.content,onChange:E,placeholder:"Введите текст новости...",minHeight:"180px"})}),n.content&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.content}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Минимум 10 символов"})]})]})}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 text-right sm:px-6",children:e.jsx("button",{type:"submit",className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:g||x,children:g||x?"Создание...":"Создать новость"})})]})})]})}O.layout=x=>e.jsx(A,{title:"Создание новости",children:x});export{O as default};

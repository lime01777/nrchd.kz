# Система управления заявками ОТЗ

## Обзор

Система управления заявками ОТЗ (Оценка технологий здравоохранения) позволяет создавать, редактировать и отслеживать статус заявок на оценку медицинских технологий. Система включает в себя как публичную часть для просмотра заявок, так и административную панель для управления.

## Функциональность

### Публичная часть
- **Карточки заявок**: Отображение заявок в виде карточек с основной информацией
- **Фильтрация**: Поиск по названию/ID, фильтрация по категории и этапу
- **Пагинация**: Постраничное отображение результатов
- **Модальные окна**: Детальная информация о заявке с roadmap этапов
- **Адаптивный дизайн**: Корректное отображение на всех устройствах

### Административная часть
- **CRUD операции**: Создание, чтение, обновление, удаление заявок
- **Управление этапами**: Автоматическое обновление прогресса по этапам
- **Загрузка документов**: Прикрепление документов к этапам
- **Фильтрация и поиск**: Расширенные возможности фильтрации
- **Статистика**: Отображение статистики по заявкам

## Структура базы данных

### Таблица `otz_applications`

| Поле | Тип | Описание |
|------|-----|----------|
| `id` | bigint | Первичный ключ |
| `application_id` | string | Уникальный ID заявки (OT3-2025-XXXX) |
| `title` | string | Название проекта |
| `category` | enum | Категория (Комплексная/Простая) |
| `current_stage` | enum | Текущий этап |
| `description` | text | Описание проекта |
| `responsible_person` | string | Ответственное лицо |
| `phone` | string | Телефон |
| `email` | string | Email |
| `stage_start_date` | date | Дата начала этапа |
| `stage_end_date` | date | Дата окончания этапа |
| `stage_documents` | json | Документы по этапу |
| `stage_progress` | json | Прогресс по этапам |
| `is_active` | boolean | Активна ли заявка |
| `created_at` | timestamp | Дата создания |
| `updated_at` | timestamp | Дата обновления |

## Этапы процесса

1. **Подача заявки** - Начальный этап
2. **Проверка документов** - Проверка предоставленных документов
3. **Проведение ОТЗ** - Основная оценка технологии
4. **Рассмотрение комиссиями** - Рассмотрение комиссиями
5. **Бюджетное одобрение** - Утверждение бюджета
6. **Формирование тарифов** - Финальный этап

## Компоненты

### Frontend компоненты

#### `OtzApplicationCard.jsx`
Компонент карточки заявки для публичной части
- Отображает основную информацию о заявке
- Показывает статус и категорию
- Обрабатывает клик для открытия модального окна

#### `OtzApplicationModal.jsx`
Модальное окно с детальной информацией
- Отображает roadmap этапов
- Показывает прогресс по этапам
- Отображает контактную информацию и документы

#### Страницы админки
- `Index.jsx` - Список всех заявок с фильтрацией
- `Create.jsx` - Создание новой заявки
- `Edit.jsx` - Редактирование существующей заявки
- `Show.jsx` - Детальный просмотр заявки

### Backend компоненты

#### Модель `OtzApplication`
- Генерация уникальных ID заявок
- Управление этапами и прогрессом
- Валидация данных

#### Контроллеры
- `OtzApplicationController` - Публичная часть
- `Admin\OtzApplicationController` - Административная часть

## Маршруты

### Публичные маршруты
```
GET /health-rate/otz-applications - Список заявок
GET /health-rate/otz-applications/{id} - Детальная информация
GET /health-rate/otz-applications/{id}/data - Данные для модального окна
```

### Административные маршруты
```
GET /admin/otz-applications - Список заявок (админка)
GET /admin/otz-applications/create - Создание заявки
POST /admin/otz-applications - Сохранение заявки
GET /admin/otz-applications/{id} - Просмотр заявки
GET /admin/otz-applications/{id}/edit - Редактирование заявки
PUT /admin/otz-applications/{id} - Обновление заявки
DELETE /admin/otz-applications/{id} - Удаление заявки
POST /admin/otz-applications/{id}/upload-documents - Загрузка документов
DELETE /admin/otz-applications/{id}/delete-document - Удаление документа
```

## Использование

### Создание заявки
1. Перейти в админ-панель → "Заявки ОТЗ"
2. Нажать "Создать заявку"
3. Заполнить обязательные поля (название, категория, этап)
4. Добавить дополнительную информацию
5. Сохранить заявку

### Редактирование заявки
1. Найти заявку в списке
2. Нажать "Редактировать"
3. Внести изменения
4. Сохранить изменения

### Просмотр заявок на сайте
1. Перейти на страницу "Отчеты ОТЗ"
2. Использовать фильтры для поиска нужных заявок
3. Нажать на карточку заявки для просмотра деталей

## Особенности реализации

### Автоматическая генерация ID
ID заявок генерируются автоматически в формате `OT3-YYYY-XXXX`, где:
- `OT3` - префикс для заявок ОТЗ
- `YYYY` - текущий год
- `XXXX` - порядковый номер (с ведущими нулями)

### Управление этапами
- При изменении текущего этапа автоматически обновляется прогресс
- Предыдущие этапы отмечаются как завершенные
- Система поддерживает только последовательное прохождение этапов

### Загрузка документов
- Документы привязываются к конкретным этапам
- Поддерживаются форматы: PDF, DOC, DOCX, XLS, XLSX
- Максимальный размер файла: 10 МБ
- Файлы хранятся в `storage/app/public/otz-documents/`

## Безопасность

- Все административные функции защищены middleware `auth`
- Валидация данных на стороне сервера
- Проверка прав доступа для всех операций
- Безопасная загрузка файлов с проверкой типов

## Производительность

- Пагинация для больших списков заявок
- Оптимизированные запросы к базе данных
- Кэширование статических данных
- Ленивая загрузка компонентов

## Расширение функциональности

### Добавление новых этапов
1. Обновить массив этапов в модели `OtzApplication`
2. Добавить новые этапы в миграцию
3. Обновить компоненты отображения

### Добавление новых полей
1. Создать миграцию для добавления полей
2. Обновить модель и контроллеры
3. Обновить формы и компоненты отображения

### Интеграция с внешними системами
- API для интеграции с другими системами
- Webhook для уведомлений об изменениях
- Экспорт данных в различные форматы

## Поддержка и обслуживание

### Логирование
- Все операции с заявками логируются
- Ошибки валидации записываются в лог
- Отслеживание действий пользователей

### Резервное копирование
- Регулярное резервное копирование базы данных
- Сохранение загруженных документов
- Восстановление данных при необходимости

### Мониторинг
- Отслеживание производительности системы
- Мониторинг ошибок и исключений
- Алерты при критических проблемах

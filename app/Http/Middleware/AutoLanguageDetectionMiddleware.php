<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\App;
use Illuminate\Support\Facades\Session;
use Illuminate\Support\Facades\Log;
use Symfony\Component\HttpFoundation\Response;

class AutoLanguageDetectionMiddleware
{
    /**
     * Доступные языки на сайте
     */
    protected $availableLanguages = ['kz', 'ru', 'en'];
    
    /**
     * Язык по умолчанию (казахский)
     */
    protected $defaultLanguage = 'kz';
    
    /**
     * IP адреса Казахстана (основные диапазоны)
     */
    protected $kazakhstanIPRanges = [
        '37.18.0.0/16',
        '37.19.0.0/16',
        '37.20.0.0/16',
        '37.21.0.0/16',
        '37.22.0.0/16',
        '37.23.0.0/16',
        '37.24.0.0/16',
        '37.25.0.0/16',
        '37.26.0.0/16',
        '37.27.0.0/16',
        '37.28.0.0/16',
        '37.29.0.0/16',
        '37.30.0.0/16',
        '37.31.0.0/16',
        '37.32.0.0/16',
        '37.33.0.0/16',
        '37.34.0.0/16',
        '37.35.0.0/16',
        '37.36.0.0/16',
        '37.37.0.0/16',
        '37.38.0.0/16',
        '37.39.0.0/16',
        '37.40.0.0/16',
        '37.41.0.0/16',
        '37.42.0.0/16',
        '37.43.0.0/16',
        '37.44.0.0/16',
        '37.45.0.0/16',
        '37.46.0.0/16',
        '37.47.0.0/16',
        '37.48.0.0/16',
        '37.49.0.0/16',
        '37.50.0.0/16',
        '37.51.0.0/16',
        '37.52.0.0/16',
        '37.53.0.0/16',
        '37.54.0.0/16',
        '37.55.0.0/16',
        '37.56.0.0/16',
        '37.57.0.0/16',
        '37.58.0.0/16',
        '37.59.0.0/16',
        '37.60.0.0/16',
        '37.61.0.0/16',
        '37.62.0.0/16',
        '37.63.0.0/16',
        '37.64.0.0/16',
        '37.65.0.0/16',
        '37.66.0.0/16',
        '37.67.0.0/16',
        '37.68.0.0/16',
        '37.69.0.0/16',
        '37.70.0.0/16',
        '37.71.0.0/16',
        '37.72.0.0/16',
        '37.73.0.0/16',
        '37.74.0.0/16',
        '37.75.0.0/16',
        '37.76.0.0/16',
        '37.77.0.0/16',
        '37.78.0.0/16',
        '37.79.0.0/16',
        '37.80.0.0/16',
        '37.81.0.0/16',
        '37.82.0.0/16',
        '37.83.0.0/16',
        '37.84.0.0/16',
        '37.85.0.0/16',
        '37.86.0.0/16',
        '37.87.0.0/16',
        '37.88.0.0/16',
        '37.89.0.0/16',
        '37.90.0.0/16',
        '37.91.0.0/16',
        '37.92.0.0/16',
        '37.93.0.0/16',
        '37.94.0.0/16',
        '37.95.0.0/16',
        '37.96.0.0/16',
        '37.97.0.0/16',
        '37.98.0.0/16',
        '37.99.0.0/16',
        '37.100.0.0/16',
        '37.101.0.0/16',
        '37.102.0.0/16',
        '37.103.0.0/16',
        '37.104.0.0/16',
        '37.105.0.0/16',
        '37.106.0.0/16',
        '37.107.0.0/16',
        '37.108.0.0/16',
        '37.109.0.0/16',
        '37.110.0.0/16',
        '37.111.0.0/16',
        '37.112.0.0/16',
        '37.113.0.0/16',
        '37.114.0.0/16',
        '37.115.0.0/16',
        '37.116.0.0/16',
        '37.117.0.0/16',
        '37.118.0.0/16',
        '37.119.0.0/16',
        '37.120.0.0/16',
        '37.121.0.0/16',
        '37.122.0.0/16',
        '37.123.0.0/16',
        '37.124.0.0/16',
        '37.125.0.0/16',
        '37.126.0.0/16',
        '37.127.0.0/16',
        '37.128.0.0/16',
        '37.129.0.0/16',
        '37.130.0.0/16',
        '37.131.0.0/16',
        '37.132.0.0/16',
        '37.133.0.0/16',
        '37.134.0.0/16',
        '37.135.0.0/16',
        '37.136.0.0/16',
        '37.137.0.0/16',
        '37.138.0.0/16',
        '37.139.0.0/16',
        '37.140.0.0/16',
        '37.141.0.0/16',
        '37.142.0.0/16',
        '37.143.0.0/16',
        '37.144.0.0/16',
        '37.145.0.0/16',
        '37.146.0.0/16',
        '37.147.0.0/16',
        '37.148.0.0/16',
        '37.149.0.0/16',
        '37.150.0.0/16',
        '37.151.0.0/16',
        '37.152.0.0/16',
        '37.153.0.0/16',
        '37.154.0.0/16',
        '37.155.0.0/16',
        '37.156.0.0/16',
        '37.157.0.0/16',
        '37.158.0.0/16',
        '37.159.0.0/16',
        '37.160.0.0/16',
        '37.161.0.0/16',
        '37.162.0.0/16',
        '37.163.0.0/16',
        '37.164.0.0/16',
        '37.165.0.0/16',
        '37.166.0.0/16',
        '37.167.0.0/16',
        '37.168.0.0/16',
        '37.169.0.0/16',
        '37.170.0.0/16',
        '37.171.0.0/16',
        '37.172.0.0/16',
        '37.173.0.0/16',
        '37.174.0.0/16',
        '37.175.0.0/16',
        '37.176.0.0/16',
        '37.177.0.0/16',
        '37.178.0.0/16',
        '37.179.0.0/16',
        '37.180.0.0/16',
        '37.181.0.0/16',
        '37.182.0.0/16',
        '37.183.0.0/16',
        '37.184.0.0/16',
        '37.185.0.0/16',
        '37.186.0.0/16',
        '37.187.0.0/16',
        '37.188.0.0/16',
        '37.189.0.0/16',
        '37.190.0.0/16',
        '37.191.0.0/16',
        '37.192.0.0/16',
        '37.193.0.0/16',
        '37.194.0.0/16',
        '37.195.0.0/16',
        '37.196.0.0/16',
        '37.197.0.0/16',
        '37.198.0.0/16',
        '37.199.0.0/16',
        '37.200.0.0/16',
        '37.201.0.0/16',
        '37.202.0.0/16',
        '37.203.0.0/16',
        '37.204.0.0/16',
        '37.205.0.0/16',
        '37.206.0.0/16',
        '37.207.0.0/16',
        '37.208.0.0/16',
        '37.209.0.0/16',
        '37.210.0.0/16',
        '37.211.0.0/16',
        '37.212.0.0/16',
        '37.213.0.0/16',
        '37.214.0.0/16',
        '37.215.0.0/16',
        '37.216.0.0/16',
        '37.217.0.0/16',
        '37.218.0.0/16',
        '37.219.0.0/16',
        '37.220.0.0/16',
        '37.221.0.0/16',
        '37.222.0.0/16',
        '37.223.0.0/16',
        '37.224.0.0/16',
        '37.225.0.0/16',
        '37.226.0.0/16',
        '37.227.0.0/16',
        '37.228.0.0/16',
        '37.229.0.0/16',
        '37.230.0.0/16',
        '37.231.0.0/16',
        '37.232.0.0/16',
        '37.233.0.0/16',
        '37.234.0.0/16',
        '37.235.0.0/16',
        '37.236.0.0/16',
        '37.237.0.0/16',
        '37.238.0.0/16',
        '37.239.0.0/16',
        '37.240.0.0/16',
        '37.241.0.0/16',
        '37.242.0.0/16',
        '37.243.0.0/16',
        '37.244.0.0/16',
        '37.245.0.0/16',
        '37.246.0.0/16',
        '37.247.0.0/16',
        '37.248.0.0/16',
        '37.249.0.0/16',
        '37.250.0.0/16',
        '37.251.0.0/16',
        '37.252.0.0/16',
        '37.253.0.0/16',
        '37.254.0.0/16',
        '37.255.0.0/16',
        // Дополнительные диапазоны Казахстана
        '46.8.0.0/16',
        '46.9.0.0/16',
        '46.10.0.0/16',
        '46.11.0.0/16',
        '46.12.0.0/16',
        '46.13.0.0/16',
        '46.14.0.0/16',
        '46.15.0.0/16',
        '46.16.0.0/16',
        '46.17.0.0/16',
        '46.18.0.0/16',
        '46.19.0.0/16',
        '46.20.0.0/16',
        '46.21.0.0/16',
        '46.22.0.0/16',
        '46.23.0.0/16',
        '46.24.0.0/16',
        '46.25.0.0/16',
        '46.26.0.0/16',
        '46.27.0.0/16',
        '46.28.0.0/16',
        '46.29.0.0/16',
        '46.30.0.0/16',
        '46.31.0.0/16',
        '46.32.0.0/16',
        '46.33.0.0/16',
        '46.34.0.0/16',
        '46.35.0.0/16',
        '46.36.0.0/16',
        '46.37.0.0/16',
        '46.38.0.0/16',
        '46.39.0.0/16',
        '46.40.0.0/16',
        '46.41.0.0/16',
        '46.42.0.0/16',
        '46.43.0.0/16',
        '46.44.0.0/16',
        '46.45.0.0/16',
        '46.46.0.0/16',
        '46.47.0.0/16',
        '46.48.0.0/16',
        '46.49.0.0/16',
        '46.50.0.0/16',
        '46.51.0.0/16',
        '46.52.0.0/16',
        '46.53.0.0/16',
        '46.54.0.0/16',
        '46.55.0.0/16',
        '46.56.0.0/16',
        '46.57.0.0/16',
        '46.58.0.0/16',
        '46.59.0.0/16',
        '46.60.0.0/16',
        '46.61.0.0/16',
        '46.62.0.0/16',
        '46.63.0.0/16',
        '46.64.0.0/16',
        '46.65.0.0/16',
        '46.66.0.0/16',
        '46.67.0.0/16',
        '46.68.0.0/16',
        '46.69.0.0/16',
        '46.70.0.0/16',
        '46.71.0.0/16',
        '46.72.0.0/16',
        '46.73.0.0/16',
        '46.74.0.0/16',
        '46.75.0.0/16',
        '46.76.0.0/16',
        '46.77.0.0/16',
        '46.78.0.0/16',
        '46.79.0.0/16',
        '46.80.0.0/16',
        '46.81.0.0/16',
        '46.82.0.0/16',
        '46.83.0.0/16',
        '46.84.0.0/16',
        '46.85.0.0/16',
        '46.86.0.0/16',
        '46.87.0.0/16',
        '46.88.0.0/16',
        '46.89.0.0/16',
        '46.90.0.0/16',
        '46.91.0.0/16',
        '46.92.0.0/16',
        '46.93.0.0/16',
        '46.94.0.0/16',
        '46.95.0.0/16',
        '46.96.0.0/16',
        '46.97.0.0/16',
        '46.98.0.0/16',
        '46.99.0.0/16',
        '46.100.0.0/16',
        '46.101.0.0/16',
        '46.102.0.0/16',
        '46.103.0.0/16',
        '46.104.0.0/16',
        '46.105.0.0/16',
        '46.106.0.0/16',
        '46.107.0.0/16',
        '46.108.0.0/16',
        '46.109.0.0/16',
        '46.110.0.0/16',
        '46.111.0.0/16',
        '46.112.0.0/16',
        '46.113.0.0/16',
        '46.114.0.0/16',
        '46.115.0.0/16',
        '46.116.0.0/16',
        '46.117.0.0/16',
        '46.118.0.0/16',
        '46.119.0.0/16',
        '46.120.0.0/16',
        '46.121.0.0/16',
        '46.122.0.0/16',
        '46.123.0.0/16',
        '46.124.0.0/16',
        '46.125.0.0/16',
        '46.126.0.0/16',
        '46.127.0.0/16',
        '46.128.0.0/16',
        '46.129.0.0/16',
        '46.130.0.0/16',
        '46.131.0.0/16',
        '46.132.0.0/16',
        '46.133.0.0/16',
        '46.134.0.0/16',
        '46.135.0.0/16',
        '46.136.0.0/16',
        '46.137.0.0/16',
        '46.138.0.0/16',
        '46.139.0.0/16',
        '46.140.0.0/16',
        '46.141.0.0/16',
        '46.142.0.0/16',
        '46.143.0.0/16',
        '46.144.0.0/16',
        '46.145.0.0/16',
        '46.146.0.0/16',
        '46.147.0.0/16',
        '46.148.0.0/16',
        '46.149.0.0/16',
        '46.150.0.0/16',
        '46.151.0.0/16',
        '46.152.0.0/16',
        '46.153.0.0/16',
        '46.154.0.0/16',
        '46.155.0.0/16',
        '46.156.0.0/16',
        '46.157.0.0/16',
        '46.158.0.0/16',
        '46.159.0.0/16',
        '46.160.0.0/16',
        '46.161.0.0/16',
        '46.162.0.0/16',
        '46.163.0.0/16',
        '46.164.0.0/16',
        '46.165.0.0/16',
        '46.166.0.0/16',
        '46.167.0.0/16',
        '46.168.0.0/16',
        '46.169.0.0/16',
        '46.170.0.0/16',
        '46.171.0.0/16',
        '46.172.0.0/16',
        '46.173.0.0/16',
        '46.174.0.0/16',
        '46.175.0.0/16',
        '46.176.0.0/16',
        '46.177.0.0/16',
        '46.178.0.0/16',
        '46.179.0.0/16',
        '46.180.0.0/16',
        '46.181.0.0/16',
        '46.182.0.0/16',
        '46.183.0.0/16',
        '46.184.0.0/16',
        '46.185.0.0/16',
        '46.186.0.0/16',
        '46.187.0.0/16',
        '46.188.0.0/16',
        '46.189.0.0/16',
        '46.190.0.0/16',
        '46.191.0.0/16',
        '46.192.0.0/16',
        '46.193.0.0/16',
        '46.194.0.0/16',
        '46.195.0.0/16',
        '46.196.0.0/16',
        '46.197.0.0/16',
        '46.198.0.0/16',
        '46.199.0.0/16',
        '46.200.0.0/16',
        '46.201.0.0/16',
        '46.202.0.0/16',
        '46.203.0.0/16',
        '46.204.0.0/16',
        '46.205.0.0/16',
        '46.206.0.0/16',
        '46.207.0.0/16',
        '46.208.0.0/16',
        '46.209.0.0/16',
        '46.210.0.0/16',
        '46.211.0.0/16',
        '46.212.0.0/16',
        '46.213.0.0/16',
        '46.214.0.0/16',
        '46.215.0.0/16',
        '46.216.0.0/16',
        '46.217.0.0/16',
        '46.218.0.0/16',
        '46.219.0.0/16',
        '46.220.0.0/16',
        '46.221.0.0/16',
        '46.222.0.0/16',
        '46.223.0.0/16',
        '46.224.0.0/16',
        '46.225.0.0/16',
        '46.226.0.0/16',
        '46.227.0.0/16',
        '46.228.0.0/16',
        '46.229.0.0/16',
        '46.230.0.0/16',
        '46.231.0.0/16',
        '46.232.0.0/16',
        '46.233.0.0/16',
        '46.234.0.0/16',
        '46.235.0.0/16',
        '46.236.0.0/16',
        '46.237.0.0/16',
        '46.238.0.0/16',
        '46.239.0.0/16',
        '46.240.0.0/16',
        '46.241.0.0/16',
        '46.242.0.0/16',
        '46.243.0.0/16',
        '46.244.0.0/16',
        '46.245.0.0/16',
        '46.246.0.0/16',
        '46.247.0.0/16',
        '46.248.0.0/16',
        '46.249.0.0/16',
        '46.250.0.0/16',
        '46.251.0.0/16',
        '46.252.0.0/16',
        '46.253.0.0/16',
        '46.254.0.0/16',
        '46.255.0.0/16',
        // Дополнительные диапазоны
        '77.88.0.0/16',
        '77.89.0.0/16',
        '77.90.0.0/16',
        '77.91.0.0/16',
        '77.92.0.0/16',
        '77.93.0.0/16',
        '77.94.0.0/16',
        '77.95.0.0/16',
        '77.96.0.0/16',
        '77.97.0.0/16',
        '77.98.0.0/16',
        '77.99.0.0/16',
        '77.100.0.0/16',
        '77.101.0.0/16',
        '77.102.0.0/16',
        '77.103.0.0/16',
        '77.104.0.0/16',
        '77.105.0.0/16',
        '77.106.0.0/16',
        '77.107.0.0/16',
        '77.108.0.0/16',
        '77.109.0.0/16',
        '77.110.0.0/16',
        '77.111.0.0/16',
        '77.112.0.0/16',
        '77.113.0.0/16',
        '77.114.0.0/16',
        '77.115.0.0/16',
        '77.116.0.0/16',
        '77.117.0.0/16',
        '77.118.0.0/16',
        '77.119.0.0/16',
        '77.120.0.0/16',
        '77.121.0.0/16',
        '77.122.0.0/16',
        '77.123.0.0/16',
        '77.124.0.0/16',
        '77.125.0.0/16',
        '77.126.0.0/16',
        '77.127.0.0/16',
        '77.128.0.0/16',
        '77.129.0.0/16',
        '77.130.0.0/16',
        '77.131.0.0/16',
        '77.132.0.0/16',
        '77.133.0.0/16',
        '77.134.0.0/16',
        '77.135.0.0/16',
        '77.136.0.0/16',
        '77.137.0.0/16',
        '77.138.0.0/16',
        '77.139.0.0/16',
        '77.140.0.0/16',
        '77.141.0.0/16',
        '77.142.0.0/16',
        '77.143.0.0/16',
        '77.144.0.0/16',
        '77.145.0.0/16',
        '77.146.0.0/16',
        '77.147.0.0/16',
        '77.148.0.0/16',
        '77.149.0.0/16',
        '77.150.0.0/16',
        '77.151.0.0/16',
        '77.152.0.0/16',
        '77.153.0.0/16',
        '77.154.0.0/16',
        '77.155.0.0/16',
        '77.156.0.0/16',
        '77.157.0.0/16',
        '77.158.0.0/16',
        '77.159.0.0/16',
        '77.160.0.0/16',
        '77.161.0.0/16',
        '77.162.0.0/16',
        '77.163.0.0/16',
        '77.164.0.0/16',
        '77.165.0.0/16',
        '77.166.0.0/16',
        '77.167.0.0/16',
        '77.168.0.0/16',
        '77.169.0.0/16',
        '77.170.0.0/16',
        '77.171.0.0/16',
        '77.172.0.0/16',
        '77.173.0.0/16',
        '77.174.0.0/16',
        '77.175.0.0/16',
        '77.176.0.0/16',
        '77.177.0.0/16',
        '77.178.0.0/16',
        '77.179.0.0/16',
        '77.180.0.0/16',
        '77.181.0.0/16',
        '77.182.0.0/16',
        '77.183.0.0/16',
        '77.184.0.0/16',
        '77.185.0.0/16',
        '77.186.0.0/16',
        '77.187.0.0/16',
        '77.188.0.0/16',
        '77.189.0.0/16',
        '77.190.0.0/16',
        '77.191.0.0/16',
        '77.192.0.0/16',
        '77.193.0.0/16',
        '77.194.0.0/16',
        '77.195.0.0/16',
        '77.196.0.0/16',
        '77.197.0.0/16',
        '77.198.0.0/16',
        '77.199.0.0/16',
        '77.200.0.0/16',
        '77.201.0.0/16',
        '77.202.0.0/16',
        '77.203.0.0/16',
        '77.204.0.0/16',
        '77.205.0.0/16',
        '77.206.0.0/16',
        '77.207.0.0/16',
        '77.208.0.0/16',
        '77.209.0.0/16',
        '77.210.0.0/16',
        '77.211.0.0/16',
        '77.212.0.0/16',
        '77.213.0.0/16',
        '77.214.0.0/16',
        '77.215.0.0/16',
        '77.216.0.0/16',
        '77.217.0.0/16',
        '77.218.0.0/16',
        '77.219.0.0/16',
        '77.220.0.0/16',
        '77.221.0.0/16',
        '77.222.0.0/16',
        '77.223.0.0/16',
        '77.224.0.0/16',
        '77.225.0.0/16',
        '77.226.0.0/16',
        '77.227.0.0/16',
        '77.228.0.0/16',
        '77.229.0.0/16',
        '77.230.0.0/16',
        '77.231.0.0/16',
        '77.232.0.0/16',
        '77.233.0.0/16',
        '77.234.0.0/16',
        '77.235.0.0/16',
        '77.236.0.0/16',
        '77.237.0.0/16',
        '77.238.0.0/16',
        '77.239.0.0/16',
        '77.240.0.0/16',
        '77.241.0.0/16',
        '77.242.0.0/16',
        '77.243.0.0/16',
        '77.244.0.0/16',
        '77.245.0.0/16',
        '77.246.0.0/16',
        '77.247.0.0/16',
        '77.248.0.0/16',
        '77.249.0.0/16',
        '77.250.0.0/16',
        '77.251.0.0/16',
        '77.252.0.0/16',
        '77.253.0.0/16',
        '77.254.0.0/16',
        '77.255.0.0/16',
    ];

    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next): Response
    {
        // Проверяем, если в URL есть параметр lang
        if ($request->has('lang')) {
            $requestedLang = $request->get('lang');
            
            // Проверяем, что такой язык поддерживается
            if (in_array($requestedLang, $this->availableLanguages)) {
                // Запоминаем выбранный язык в сессии
                Session::put('language', $requestedLang);
                App::setLocale($requestedLang);
                
                Log::info('Language set from URL parameter', [
                    'language' => $requestedLang,
                    'ip' => $request->ip()
                ]);
                
                return $next($request);
            }
        }
        
        // Проверяем язык в сессии
        $sessionLanguage = Session::get('language');
        if ($sessionLanguage && in_array($sessionLanguage, $this->availableLanguages)) {
            App::setLocale($sessionLanguage);
            
            Log::debug('Language set from session', [
                'language' => $sessionLanguage,
                'ip' => $request->ip()
            ]);
            
            return $next($request);
        }
        
        // Определяем язык по IP адресу
        $detectedLanguage = $this->detectLanguageByIP($request->ip());
        
        // Если пользователь из Казахстана, устанавливаем казахский язык
        if ($detectedLanguage === 'kz') {
            Session::put('language', 'kz');
            App::setLocale('kz');
            
            Log::info('Language auto-detected for Kazakhstan user', [
                'language' => 'kz',
                'ip' => $request->ip()
            ]);
        } else {
            // Для остальных пользователей используем язык по умолчанию
            Session::put('language', $this->defaultLanguage);
            App::setLocale($this->defaultLanguage);
            
            Log::info('Language set to default for non-Kazakhstan user', [
                'language' => $this->defaultLanguage,
                'ip' => $request->ip(),
                'detected_country' => $detectedLanguage
            ]);
        }
        
        return $next($request);
    }
    
    /**
     * Определяет язык по IP адресу
     *
     * @param string $ip
     * @return string
     */
    protected function detectLanguageByIP(string $ip): string
    {
        // Проверяем, является ли IP адресом Казахстана
        if ($this->isKazakhstanIP($ip)) {
            return 'kz';
        }
        
        // Для остальных IP возвращаем язык по умолчанию
        return $this->defaultLanguage;
    }
    
    /**
     * Проверяет, принадлежит ли IP адрес Казахстану
     *
     * @param string $ip
     * @return bool
     */
    protected function isKazakhstanIP(string $ip): bool
    {
        // Локальные IP адреса считаем как казахстанские для разработки
        if (in_array($ip, ['127.0.0.1', '::1', 'localhost'])) {
            return true;
        }
        
        // Проверяем IP адрес по диапазонам Казахстана
        foreach ($this->kazakhstanIPRanges as $range) {
            if ($this->ipInRange($ip, $range)) {
                return true;
            }
        }
        
        return false;
    }
    
    /**
     * Проверяет, находится ли IP в указанном диапазоне
     *
     * @param string $ip
     * @param string $range
     * @return bool
     */
    protected function ipInRange(string $ip, string $range): bool
    {
        list($range, $netmask) = explode('/', $range, 2);
        $rangeDecimal = ip2long($range);
        $ipDecimal = ip2long($ip);
        $wildcardDecimal = pow(2, (32 - $netmask)) - 1;
        $netmaskDecimal = ~$wildcardDecimal;
        
        return (($ipDecimal & $netmaskDecimal) == ($rangeDecimal & $netmaskDecimal));
    }
}
